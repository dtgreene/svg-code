(function(){"use strict";var z=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ve(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function et(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}),r}var xe={},be=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,tt=/\n/g,rt=/^\s*/,nt=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,it=/^:\s*/,st=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,ot=/^[;\s]*/,at=/^\s+|\s+$/g,ut=`
`,Ne="/",ye="*",U="",ft="comment",ht="declaration",lt=function(e,t){if(typeof e!="string")throw new TypeError("First argument must be a string");if(!e)return[];t=t||{};var r=1,n=1;function s(m){var g=m.match(tt);g&&(r+=g.length);var N=m.lastIndexOf(ut);n=~N?m.length-N:n+m.length}function i(){var m={line:r,column:n};return function(g){return g.position=new o(m),h(),g}}function o(m){this.start=m,this.end={line:r,column:n},this.source=t.source}o.prototype.content=e;function u(m){var g=new Error(t.source+":"+r+":"+n+": "+m);if(g.reason=m,g.filename=t.source,g.line=r,g.column=n,g.source=e,!t.silent)throw g}function a(m){var g=m.exec(e);if(g){var N=g[0];return s(N),e=e.slice(N.length),g}}function h(){a(rt)}function l(m){var g;for(m=m||[];g=p();)g!==!1&&m.push(g);return m}function p(){var m=i();if(!(Ne!=e.charAt(0)||ye!=e.charAt(1))){for(var g=2;U!=e.charAt(g)&&(ye!=e.charAt(g)||Ne!=e.charAt(g+1));)++g;if(g+=2,U===e.charAt(g-1))return u("End of comment missing");var N=e.slice(2,g-2);return n+=2,s(N),e=e.slice(g),n+=2,m({type:ft,comment:N})}}function d(){var m=i(),g=a(nt);if(g){if(p(),!a(it))return u("property missing ':'");var N=a(st),w=m({type:ht,property:Ee(g[0].replace(be,U)),value:N?Ee(N[0].replace(be,U)):U});return a(ot),w}}function x(){var m=[];l(m);for(var g;g=d();)g!==!1&&(m.push(g),l(m));return m}return h(),x()};function Ee(e){return e?e.replace(at,U):U}var ct=z&&z.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(xe,"__esModule",{value:!0});var _e=xe.default=pt,dt=ct(lt);function pt(e,t){var r=null;if(!e||typeof e!="string")return r;var n=(0,dt.default)(e),s=typeof t=="function";return n.forEach(function(i){if(i.type==="declaration"){var o=i.property,u=i.value;s?t(o,u,i):u&&(r=r||{},r[o]=u)}}),r}var we=_e.default||_e,le={},oe={};(function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",r=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",n="["+t+"]["+r+"]*",s=new RegExp("^"+n+"$"),i=function(u,a){const h=[];let l=a.exec(u);for(;l;){const p=[];p.startIndex=a.lastIndex-l[0].length;const d=l.length;for(let x=0;x<d;x++)p.push(l[x]);h.push(p),l=a.exec(u)}return h},o=function(u){const a=s.exec(u);return!(a===null||typeof a>"u")};e.isExist=function(u){return typeof u<"u"},e.isEmptyObject=function(u){return Object.keys(u).length===0},e.merge=function(u,a,h){if(a){const l=Object.keys(a),p=l.length;for(let d=0;d<p;d++)h==="strict"?u[l[d]]=[a[l[d]]]:u[l[d]]=a[l[d]]}},e.getValue=function(u){return e.isExist(u)?u:""},e.isName=o,e.getAllMatches=i,e.nameRegexp=n})(oe);const ce=oe,gt={allowBooleanAttributes:!1,unpairedTags:[]};le.validate=function(e,t){t=Object.assign({},gt,t);const r=[];let n=!1,s=!1;e[0]==="\uFEFF"&&(e=e.substr(1));for(let i=0;i<e.length;i++)if(e[i]==="<"&&e[i+1]==="?"){if(i+=2,i=Pe(e,i),i.err)return i}else if(e[i]==="<"){let o=i;if(i++,e[i]==="!"){i=Te(e,i);continue}else{let u=!1;e[i]==="/"&&(u=!0,i++);let a="";for(;i<e.length&&e[i]!==">"&&e[i]!==" "&&e[i]!=="	"&&e[i]!==`
`&&e[i]!=="\r";i++)a+=e[i];if(a=a.trim(),a[a.length-1]==="/"&&(a=a.substring(0,a.length-1),i--),!_t(a)){let p;return a.trim().length===0?p="Invalid space after '<'.":p="Tag '"+a+"' is an invalid name.",S("InvalidTag",p,L(e,i))}const h=xt(e,i);if(h===!1)return S("InvalidAttr","Attributes for '"+a+"' have open quote.",L(e,i));let l=h.value;if(i=h.index,l[l.length-1]==="/"){const p=i-l.length;l=l.substring(0,l.length-1);const d=Ae(l,t);if(d===!0)n=!0;else return S(d.err.code,d.err.msg,L(e,p+d.err.line))}else if(u)if(h.tagClosed){if(l.trim().length>0)return S("InvalidTag","Closing tag '"+a+"' can't have attributes or invalid starting.",L(e,o));if(r.length===0)return S("InvalidTag","Closing tag '"+a+"' has not been opened.",L(e,o));{const p=r.pop();if(a!==p.tagName){let d=L(e,p.tagStartPos);return S("InvalidTag","Expected closing tag '"+p.tagName+"' (opened in line "+d.line+", col "+d.col+") instead of closing tag '"+a+"'.",L(e,o))}r.length==0&&(s=!0)}}else return S("InvalidTag","Closing tag '"+a+"' doesn't have proper closing.",L(e,i));else{const p=Ae(l,t);if(p!==!0)return S(p.err.code,p.err.msg,L(e,i-l.length+p.err.line));if(s===!0)return S("InvalidXml","Multiple possible root nodes found.",L(e,i));t.unpairedTags.indexOf(a)!==-1||r.push({tagName:a,tagStartPos:o}),n=!0}for(i++;i<e.length;i++)if(e[i]==="<")if(e[i+1]==="!"){i++,i=Te(e,i);continue}else if(e[i+1]==="?"){if(i=Pe(e,++i),i.err)return i}else break;else if(e[i]==="&"){const p=yt(e,i);if(p==-1)return S("InvalidChar","char '&' is not expected.",L(e,i));i=p}else if(s===!0&&!Me(e[i]))return S("InvalidXml","Extra text at the end",L(e,i));e[i]==="<"&&i--}}else{if(Me(e[i]))continue;return S("InvalidChar","char '"+e[i]+"' is not expected.",L(e,i))}if(n){if(r.length==1)return S("InvalidTag","Unclosed tag '"+r[0].tagName+"'.",L(e,r[0].tagStartPos));if(r.length>0)return S("InvalidXml","Invalid '"+JSON.stringify(r.map(i=>i.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return S("InvalidXml","Start tag expected.",1);return!0};function Me(e){return e===" "||e==="	"||e===`
`||e==="\r"}function Pe(e,t){const r=t;for(;t<e.length;t++)if(e[t]=="?"||e[t]==" "){const n=e.substr(r,t-r);if(t>5&&n==="xml")return S("InvalidXml","XML declaration allowed only at the start of the document.",L(e,t));if(e[t]=="?"&&e[t+1]==">"){t++;break}else continue}return t}function Te(e,t){if(e.length>t+5&&e[t+1]==="-"&&e[t+2]==="-"){for(t+=3;t<e.length;t++)if(e[t]==="-"&&e[t+1]==="-"&&e[t+2]===">"){t+=2;break}}else if(e.length>t+8&&e[t+1]==="D"&&e[t+2]==="O"&&e[t+3]==="C"&&e[t+4]==="T"&&e[t+5]==="Y"&&e[t+6]==="P"&&e[t+7]==="E"){let r=1;for(t+=8;t<e.length;t++)if(e[t]==="<")r++;else if(e[t]===">"&&(r--,r===0))break}else if(e.length>t+9&&e[t+1]==="["&&e[t+2]==="C"&&e[t+3]==="D"&&e[t+4]==="A"&&e[t+5]==="T"&&e[t+6]==="A"&&e[t+7]==="["){for(t+=8;t<e.length;t++)if(e[t]==="]"&&e[t+1]==="]"&&e[t+2]===">"){t+=2;break}}return t}const mt='"',vt="'";function xt(e,t){let r="",n="",s=!1;for(;t<e.length;t++){if(e[t]===mt||e[t]===vt)n===""?n=e[t]:n!==e[t]||(n="");else if(e[t]===">"&&n===""){s=!0;break}r+=e[t]}return n!==""?!1:{value:r,index:t,tagClosed:s}}const bt=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function Ae(e,t){const r=ce.getAllMatches(e,bt),n={};for(let s=0;s<r.length;s++){if(r[s][1].length===0)return S("InvalidAttr","Attribute '"+r[s][2]+"' has no space in starting.",ee(r[s]));if(r[s][3]!==void 0&&r[s][4]===void 0)return S("InvalidAttr","Attribute '"+r[s][2]+"' is without value.",ee(r[s]));if(r[s][3]===void 0&&!t.allowBooleanAttributes)return S("InvalidAttr","boolean attribute '"+r[s][2]+"' is not allowed.",ee(r[s]));const i=r[s][2];if(!Et(i))return S("InvalidAttr","Attribute '"+i+"' is an invalid name.",ee(r[s]));if(!n.hasOwnProperty(i))n[i]=1;else return S("InvalidAttr","Attribute '"+i+"' is repeated.",ee(r[s]))}return!0}function Nt(e,t){let r=/\d/;for(e[t]==="x"&&(t++,r=/[\da-fA-F]/);t<e.length;t++){if(e[t]===";")return t;if(!e[t].match(r))break}return-1}function yt(e,t){if(t++,e[t]===";")return-1;if(e[t]==="#")return t++,Nt(e,t);let r=0;for(;t<e.length;t++,r++)if(!(e[t].match(/\w/)&&r<20)){if(e[t]===";")break;return-1}return t}function S(e,t,r){return{err:{code:e,msg:t,line:r.line||r,col:r.col}}}function Et(e){return ce.isName(e)}function _t(e){return ce.isName(e)}function L(e,t){const r=e.substring(0,t).split(/\r?\n/);return{line:r.length,col:r[r.length-1].length+1}}function ee(e){return e.startIndex+e[1].length}var de={};const Ce={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,r){return e}},wt=function(e){return Object.assign({},Ce,e)};de.buildOptions=wt,de.defaultOptions=Ce;class Mt{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,r){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:r})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}var Pt=Mt;const Tt=oe;function At(e,t){const r={};if(e[t+3]==="O"&&e[t+4]==="C"&&e[t+5]==="T"&&e[t+6]==="Y"&&e[t+7]==="P"&&e[t+8]==="E"){t=t+9;let n=1,s=!1,i=!1,o="";for(;t<e.length;t++)if(e[t]==="<"&&!i){if(s&&It(e,t))t+=7,[entityName,val,t]=Ct(e,t+1),val.indexOf("&")===-1&&(r[$t(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(s&&Xt(e,t))t+=8;else if(s&&St(e,t))t+=8;else if(s&&Yt(e,t))t+=9;else if(Ot)i=!0;else throw new Error("Invalid DOCTYPE");n++,o=""}else if(e[t]===">"){if(i?e[t-1]==="-"&&e[t-2]==="-"&&(i=!1,n--):n--,n===0)break}else e[t]==="["?s=!0:o+=e[t];if(n!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:r,i:t}}function Ct(e,t){let r="";for(;t<e.length&&e[t]!=="'"&&e[t]!=='"';t++)r+=e[t];if(r=r.trim(),r.indexOf(" ")!==-1)throw new Error("External entites are not supported");const n=e[t++];let s="";for(;t<e.length&&e[t]!==n;t++)s+=e[t];return[r,s,t]}function Ot(e,t){return e[t+1]==="!"&&e[t+2]==="-"&&e[t+3]==="-"}function It(e,t){return e[t+1]==="!"&&e[t+2]==="E"&&e[t+3]==="N"&&e[t+4]==="T"&&e[t+5]==="I"&&e[t+6]==="T"&&e[t+7]==="Y"}function Xt(e,t){return e[t+1]==="!"&&e[t+2]==="E"&&e[t+3]==="L"&&e[t+4]==="E"&&e[t+5]==="M"&&e[t+6]==="E"&&e[t+7]==="N"&&e[t+8]==="T"}function St(e,t){return e[t+1]==="!"&&e[t+2]==="A"&&e[t+3]==="T"&&e[t+4]==="T"&&e[t+5]==="L"&&e[t+6]==="I"&&e[t+7]==="S"&&e[t+8]==="T"}function Yt(e,t){return e[t+1]==="!"&&e[t+2]==="N"&&e[t+3]==="O"&&e[t+4]==="T"&&e[t+5]==="A"&&e[t+6]==="T"&&e[t+7]==="I"&&e[t+8]==="O"&&e[t+9]==="N"}function $t(e){if(Tt.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}var Lt=At;const Bt=/^[-+]?0x[a-fA-F0-9]+$/,kt=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const Ft={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function Rt(e,t={}){if(t=Object.assign({},Ft,t),!e||typeof e!="string")return e;let r=e.trim();if(t.skipLike!==void 0&&t.skipLike.test(r))return e;if(t.hex&&Bt.test(r))return Number.parseInt(r,16);{const n=kt.exec(r);if(n){const s=n[1],i=n[2];let o=Vt(n[3]);const u=n[4]||n[6];if(!t.leadingZeros&&i.length>0&&s&&r[2]!==".")return e;if(!t.leadingZeros&&i.length>0&&!s&&r[1]!==".")return e;{const a=Number(r),h=""+a;return h.search(/[eE]/)!==-1||u?t.eNotation?a:e:r.indexOf(".")!==-1?h==="0"&&o===""||h===o||s&&h==="-"+o?a:e:i?o===h||s+o===h?a:e:r===h||r===s+h?a:e}}else return e}}function Vt(e){return e&&e.indexOf(".")!==-1&&(e=e.replace(/0+$/,""),e==="."?e="0":e[0]==="."?e="0"+e:e[e.length-1]==="."&&(e=e.substr(0,e.length-1))),e}var qt=Rt;function Gt(e){return typeof e=="function"?e:Array.isArray(e)?t=>{for(const r of e)if(typeof r=="string"&&t===r||r instanceof RegExp&&r.test(t))return!0}:()=>!1}var Oe=Gt;const Ie=oe,te=Pt,Wt=Lt,jt=qt,Ht=Oe;let zt=class{constructor(t){this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(r,n)=>String.fromCharCode(Number.parseInt(n,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(r,n)=>String.fromCharCode(Number.parseInt(n,16))}},this.addExternalEntities=Ut,this.parseXml=Dt,this.parseTextData=Zt,this.resolveNameSpace=Jt,this.buildAttributesMap=Kt,this.isItStopNode=nr,this.replaceEntitiesValue=tr,this.readStopNodeData=sr,this.saveTextToParentTag=rr,this.addChild=er,this.ignoreAttributesFn=Ht(this.options.ignoreAttributes)}};function Ut(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];this.lastEntities[n]={regex:new RegExp("&"+n+";","g"),val:e[n]}}}function Zt(e,t,r,n,s,i,o){if(e!==void 0&&(this.options.trimValues&&!n&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e));const u=this.options.tagValueProcessor(t,e,r,s,i);return u==null?e:typeof u!=typeof e||u!==e?u:this.options.trimValues?ge(e,this.options.parseTagValue,this.options.numberParseOptions):e.trim()===e?ge(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function Jt(e){if(this.options.removeNSPrefix){const t=e.split(":"),r=e.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(e=r+t[1])}return e}const Qt=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function Kt(e,t,r){if(this.options.ignoreAttributes!==!0&&typeof e=="string"){const n=Ie.getAllMatches(e,Qt),s=n.length,i={};for(let o=0;o<s;o++){const u=this.resolveNameSpace(n[o][1]);if(this.ignoreAttributesFn(u,t))continue;let a=n[o][4],h=this.options.attributeNamePrefix+u;if(u.length)if(this.options.transformAttributeName&&(h=this.options.transformAttributeName(h)),h==="__proto__"&&(h="#__proto__"),a!==void 0){this.options.trimValues&&(a=a.trim()),a=this.replaceEntitiesValue(a);const l=this.options.attributeValueProcessor(u,a,t);l==null?i[h]=a:typeof l!=typeof a||l!==a?i[h]=l:i[h]=ge(a,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[h]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){const o={};return o[this.options.attributesGroupName]=i,o}return i}}const Dt=function(e){e=e.replace(/\r\n?/g,`
`);const t=new te("!xml");let r=t,n="",s="";for(let i=0;i<e.length;i++)if(e[i]==="<")if(e[i+1]==="/"){const u=Z(e,">",i,"Closing Tag is not closed.");let a=e.substring(i+2,u).trim();if(this.options.removeNSPrefix){const p=a.indexOf(":");p!==-1&&(a=a.substr(p+1))}this.options.transformTagName&&(a=this.options.transformTagName(a)),r&&(n=this.saveTextToParentTag(n,r,s));const h=s.substring(s.lastIndexOf(".")+1);if(a&&this.options.unpairedTags.indexOf(a)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${a}>`);let l=0;h&&this.options.unpairedTags.indexOf(h)!==-1?(l=s.lastIndexOf(".",s.lastIndexOf(".")-1),this.tagsNodeStack.pop()):l=s.lastIndexOf("."),s=s.substring(0,l),r=this.tagsNodeStack.pop(),n="",i=u}else if(e[i+1]==="?"){let u=pe(e,i,!1,"?>");if(!u)throw new Error("Pi Tag is not closed.");if(n=this.saveTextToParentTag(n,r,s),!(this.options.ignoreDeclaration&&u.tagName==="?xml"||this.options.ignorePiTags)){const a=new te(u.tagName);a.add(this.options.textNodeName,""),u.tagName!==u.tagExp&&u.attrExpPresent&&(a[":@"]=this.buildAttributesMap(u.tagExp,s,u.tagName)),this.addChild(r,a,s)}i=u.closeIndex+1}else if(e.substr(i+1,3)==="!--"){const u=Z(e,"-->",i+4,"Comment is not closed.");if(this.options.commentPropName){const a=e.substring(i+4,u-2);n=this.saveTextToParentTag(n,r,s),r.add(this.options.commentPropName,[{[this.options.textNodeName]:a}])}i=u}else if(e.substr(i+1,2)==="!D"){const u=Wt(e,i);this.docTypeEntities=u.entities,i=u.i}else if(e.substr(i+1,2)==="!["){const u=Z(e,"]]>",i,"CDATA is not closed.")-2,a=e.substring(i+9,u);n=this.saveTextToParentTag(n,r,s);let h=this.parseTextData(a,r.tagname,s,!0,!1,!0,!0);h==null&&(h=""),this.options.cdataPropName?r.add(this.options.cdataPropName,[{[this.options.textNodeName]:a}]):r.add(this.options.textNodeName,h),i=u+2}else{let u=pe(e,i,this.options.removeNSPrefix),a=u.tagName;const h=u.rawTagName;let l=u.tagExp,p=u.attrExpPresent,d=u.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),r&&n&&r.tagname!=="!xml"&&(n=this.saveTextToParentTag(n,r,s,!1));const x=r;if(x&&this.options.unpairedTags.indexOf(x.tagname)!==-1&&(r=this.tagsNodeStack.pop(),s=s.substring(0,s.lastIndexOf("."))),a!==t.tagname&&(s+=s?"."+a:a),this.isItStopNode(this.options.stopNodes,s,a)){let m="";if(l.length>0&&l.lastIndexOf("/")===l.length-1)a[a.length-1]==="/"?(a=a.substr(0,a.length-1),s=s.substr(0,s.length-1),l=a):l=l.substr(0,l.length-1),i=u.closeIndex;else if(this.options.unpairedTags.indexOf(a)!==-1)i=u.closeIndex;else{const N=this.readStopNodeData(e,h,d+1);if(!N)throw new Error(`Unexpected end of ${h}`);i=N.i,m=N.tagContent}const g=new te(a);a!==l&&p&&(g[":@"]=this.buildAttributesMap(l,s,a)),m&&(m=this.parseTextData(m,a,s,!0,p,!0,!0)),s=s.substr(0,s.lastIndexOf(".")),g.add(this.options.textNodeName,m),this.addChild(r,g,s)}else{if(l.length>0&&l.lastIndexOf("/")===l.length-1){a[a.length-1]==="/"?(a=a.substr(0,a.length-1),s=s.substr(0,s.length-1),l=a):l=l.substr(0,l.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));const m=new te(a);a!==l&&p&&(m[":@"]=this.buildAttributesMap(l,s,a)),this.addChild(r,m,s),s=s.substr(0,s.lastIndexOf("."))}else{const m=new te(a);this.tagsNodeStack.push(r),a!==l&&p&&(m[":@"]=this.buildAttributesMap(l,s,a)),this.addChild(r,m,s),r=m}n="",i=d}}else n+=e[i];return t.child};function er(e,t,r){const n=this.options.updateTag(t.tagname,r,t[":@"]);n===!1||(typeof n=="string"&&(t.tagname=n),e.addChild(t))}const tr=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const r=this.docTypeEntities[t];e=e.replace(r.regx,r.val)}for(let t in this.lastEntities){const r=this.lastEntities[t];e=e.replace(r.regex,r.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const r=this.htmlEntities[t];e=e.replace(r.regex,r.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function rr(e,t,r,n){return e&&(n===void 0&&(n=Object.keys(t.child).length===0),e=this.parseTextData(e,t.tagname,r,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,n),e!==void 0&&e!==""&&t.add(this.options.textNodeName,e),e=""),e}function nr(e,t,r){const n="*."+r;for(const s in e){const i=e[s];if(n===i||t===i)return!0}return!1}function ir(e,t,r=">"){let n,s="";for(let i=t;i<e.length;i++){let o=e[i];if(n)o===n&&(n="");else if(o==='"'||o==="'")n=o;else if(o===r[0])if(r[1]){if(e[i+1]===r[1])return{data:s,index:i}}else return{data:s,index:i};else o==="	"&&(o=" ");s+=o}}function Z(e,t,r,n){const s=e.indexOf(t,r);if(s===-1)throw new Error(n);return s+t.length-1}function pe(e,t,r,n=">"){const s=ir(e,t+1,n);if(!s)return;let i=s.data;const o=s.index,u=i.search(/\s/);let a=i,h=!0;u!==-1&&(a=i.substring(0,u),i=i.substring(u+1).trimStart());const l=a;if(r){const p=a.indexOf(":");p!==-1&&(a=a.substr(p+1),h=a!==s.data.substr(p+1))}return{tagName:a,tagExp:i,closeIndex:o,attrExpPresent:h,rawTagName:l}}function sr(e,t,r){const n=r;let s=1;for(;r<e.length;r++)if(e[r]==="<")if(e[r+1]==="/"){const i=Z(e,">",r,`${t} is not closed`);if(e.substring(r+2,i).trim()===t&&(s--,s===0))return{tagContent:e.substring(n,r),i};r=i}else if(e[r+1]==="?")r=Z(e,"?>",r+1,"StopNode is not closed.");else if(e.substr(r+1,3)==="!--")r=Z(e,"-->",r+3,"StopNode is not closed.");else if(e.substr(r+1,2)==="![")r=Z(e,"]]>",r,"StopNode is not closed.")-2;else{const i=pe(e,r,">");i&&((i&&i.tagName)===t&&i.tagExp[i.tagExp.length-1]!=="/"&&s++,r=i.closeIndex)}}function ge(e,t,r){if(t&&typeof e=="string"){const n=e.trim();return n==="true"?!0:n==="false"?!1:jt(e,r)}else return Ie.isExist(e)?e:""}var or=zt,Xe={};function ar(e,t){return Se(e,t)}function Se(e,t,r){let n;const s={};for(let i=0;i<e.length;i++){const o=e[i],u=ur(o);let a="";if(r===void 0?a=u:a=r+"."+u,u===t.textNodeName)n===void 0?n=o[u]:n+=""+o[u];else{if(u===void 0)continue;if(o[u]){let h=Se(o[u],t,a);const l=hr(h,t);o[":@"]?fr(h,o[":@"],a,t):Object.keys(h).length===1&&h[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?h=h[t.textNodeName]:Object.keys(h).length===0&&(t.alwaysCreateTextNode?h[t.textNodeName]="":h=""),s[u]!==void 0&&s.hasOwnProperty(u)?(Array.isArray(s[u])||(s[u]=[s[u]]),s[u].push(h)):t.isArray(u,a,l)?s[u]=[h]:s[u]=h}}}return typeof n=="string"?n.length>0&&(s[t.textNodeName]=n):n!==void 0&&(s[t.textNodeName]=n),s}function ur(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];if(n!==":@")return n}}function fr(e,t,r,n){if(t){const s=Object.keys(t),i=s.length;for(let o=0;o<i;o++){const u=s[o];n.isArray(u,r+"."+u,!0,!0)?e[u]=[t[u]]:e[u]=t[u]}}}function hr(e,t){const{textNodeName:r}=t,n=Object.keys(e).length;return!!(n===0||n===1&&(e[r]||typeof e[r]=="boolean"||e[r]===0))}Xe.prettify=ar;const{buildOptions:lr}=de,cr=or,{prettify:dr}=Xe,pr=le;var gr=class{constructor(t){this.externalEntities={},this.options=lr(t)}parse(t,r){if(typeof t!="string")if(t.toString)t=t.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(r){r===!0&&(r={});const i=pr.validate(t,r);if(i!==!0)throw Error(`${i.err.msg}:${i.err.line}:${i.err.col}`)}const n=new cr(this.options);n.addExternalEntities(this.externalEntities);const s=n.parseXml(t);return this.options.preserveOrder||s===void 0?s:dr(s,this.options)}addEntity(t,r){if(r.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(t.indexOf("&")!==-1||t.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(r==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[t]=r}};const mr=`
`;function vr(e,t){let r="";return t.format&&t.indentBy.length>0&&(r=mr),Ye(e,t,"",r)}function Ye(e,t,r,n){let s="",i=!1;for(let o=0;o<e.length;o++){const u=e[o],a=xr(u);if(a===void 0)continue;let h="";if(r.length===0?h=a:h=`${r}.${a}`,a===t.textNodeName){let m=u[a];br(h,t)||(m=t.tagValueProcessor(a,m),m=Le(m,t)),i&&(s+=n),s+=m,i=!1;continue}else if(a===t.cdataPropName){i&&(s+=n),s+=`<![CDATA[${u[a][0][t.textNodeName]}]]>`,i=!1;continue}else if(a===t.commentPropName){s+=n+`<!--${u[a][0][t.textNodeName]}-->`,i=!0;continue}else if(a[0]==="?"){const m=$e(u[":@"],t),g=a==="?xml"?"":n;let N=u[a][0][t.textNodeName];N=N.length!==0?" "+N:"",s+=g+`<${a}${N}${m}?>`,i=!0;continue}let l=n;l!==""&&(l+=t.indentBy);const p=$e(u[":@"],t),d=n+`<${a}${p}`,x=Ye(u[a],t,h,l);t.unpairedTags.indexOf(a)!==-1?t.suppressUnpairedNode?s+=d+">":s+=d+"/>":(!x||x.length===0)&&t.suppressEmptyNode?s+=d+"/>":x&&x.endsWith(">")?s+=d+`>${x}${n}</${a}>`:(s+=d+">",x&&n!==""&&(x.includes("/>")||x.includes("</"))?s+=n+t.indentBy+x+n:s+=x,s+=`</${a}>`),i=!0}return s}function xr(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];if(e.hasOwnProperty(n)&&n!==":@")return n}}function $e(e,t){let r="";if(e&&!t.ignoreAttributes)for(let n in e){if(!e.hasOwnProperty(n))continue;let s=t.attributeValueProcessor(n,e[n]);s=Le(s,t),s===!0&&t.suppressBooleanAttributes?r+=` ${n.substr(t.attributeNamePrefix.length)}`:r+=` ${n.substr(t.attributeNamePrefix.length)}="${s}"`}return r}function br(e,t){e=e.substr(0,e.length-t.textNodeName.length-1);let r=e.substr(e.lastIndexOf(".")+1);for(let n in t.stopNodes)if(t.stopNodes[n]===e||t.stopNodes[n]==="*."+r)return!0;return!1}function Le(e,t){if(e&&e.length>0&&t.processEntities)for(let r=0;r<t.entities.length;r++){const n=t.entities[r];e=e.replace(n.regex,n.val)}return e}var Nr=vr;const yr=Nr,Er=Oe,_r={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function W(e){this.options=Object.assign({},_r,e),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=Er(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=Pr),this.processTextOrObjNode=wr,this.options.format?(this.indentate=Mr,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}W.prototype.build=function(e){return this.options.preserveOrder?yr(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0,[]).val)},W.prototype.j2x=function(e,t,r){let n="",s="";const i=r.join(".");for(let o in e)if(Object.prototype.hasOwnProperty.call(e,o))if(typeof e[o]>"u")this.isAttribute(o)&&(s+="");else if(e[o]===null)this.isAttribute(o)?s+="":o[0]==="?"?s+=this.indentate(t)+"<"+o+"?"+this.tagEndChar:s+=this.indentate(t)+"<"+o+"/"+this.tagEndChar;else if(e[o]instanceof Date)s+=this.buildTextValNode(e[o],o,"",t);else if(typeof e[o]!="object"){const u=this.isAttribute(o);if(u&&!this.ignoreAttributesFn(u,i))n+=this.buildAttrPairStr(u,""+e[o]);else if(!u)if(o===this.options.textNodeName){let a=this.options.tagValueProcessor(o,""+e[o]);s+=this.replaceEntitiesValue(a)}else s+=this.buildTextValNode(e[o],o,"",t)}else if(Array.isArray(e[o])){const u=e[o].length;let a="",h="";for(let l=0;l<u;l++){const p=e[o][l];if(!(typeof p>"u"))if(p===null)o[0]==="?"?s+=this.indentate(t)+"<"+o+"?"+this.tagEndChar:s+=this.indentate(t)+"<"+o+"/"+this.tagEndChar;else if(typeof p=="object")if(this.options.oneListGroup){const d=this.j2x(p,t+1,r.concat(o));a+=d.val,this.options.attributesGroupName&&p.hasOwnProperty(this.options.attributesGroupName)&&(h+=d.attrStr)}else a+=this.processTextOrObjNode(p,o,t,r);else if(this.options.oneListGroup){let d=this.options.tagValueProcessor(o,p);d=this.replaceEntitiesValue(d),a+=d}else a+=this.buildTextValNode(p,o,"",t)}this.options.oneListGroup&&(a=this.buildObjectNode(a,o,h,t)),s+=a}else if(this.options.attributesGroupName&&o===this.options.attributesGroupName){const u=Object.keys(e[o]),a=u.length;for(let h=0;h<a;h++)n+=this.buildAttrPairStr(u[h],""+e[o][u[h]])}else s+=this.processTextOrObjNode(e[o],o,t,r);return{attrStr:n,val:s}},W.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&t==="true"?" "+e:" "+e+'="'+t+'"'};function wr(e,t,r,n){const s=this.j2x(e,r+1,n.concat(t));return e[this.options.textNodeName]!==void 0&&Object.keys(e).length===1?this.buildTextValNode(e[this.options.textNodeName],t,s.attrStr,r):this.buildObjectNode(s.val,t,s.attrStr,r)}W.prototype.buildObjectNode=function(e,t,r,n){if(e==="")return t[0]==="?"?this.indentate(n)+"<"+t+r+"?"+this.tagEndChar:this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar;{let s="</"+t+this.tagEndChar,i="";return t[0]==="?"&&(i="?",s=""),(r||r==="")&&e.indexOf("<")===-1?this.indentate(n)+"<"+t+r+i+">"+e+s:this.options.commentPropName!==!1&&t===this.options.commentPropName&&i.length===0?this.indentate(n)+`<!--${e}-->`+this.newLine:this.indentate(n)+"<"+t+r+i+this.tagEndChar+e+this.indentate(n)+s}},W.prototype.closeTag=function(e){let t="";return this.options.unpairedTags.indexOf(e)!==-1?this.options.suppressUnpairedNode||(t="/"):this.options.suppressEmptyNode?t="/":t=`></${e}`,t},W.prototype.buildTextValNode=function(e,t,r,n){if(this.options.cdataPropName!==!1&&t===this.options.cdataPropName)return this.indentate(n)+`<![CDATA[${e}]]>`+this.newLine;if(this.options.commentPropName!==!1&&t===this.options.commentPropName)return this.indentate(n)+`<!--${e}-->`+this.newLine;if(t[0]==="?")return this.indentate(n)+"<"+t+r+"?"+this.tagEndChar;{let s=this.options.tagValueProcessor(t,e);return s=this.replaceEntitiesValue(s),s===""?this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar:this.indentate(n)+"<"+t+r+">"+s+"</"+t+this.tagEndChar}},W.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const r=this.options.entities[t];e=e.replace(r.regex,r.val)}return e};function Mr(e){return this.options.indentBy.repeat(e)}function Pr(e){return e.startsWith(this.options.attributeNamePrefix)&&e!==this.options.textNodeName?e.substr(this.attrPrefixLen):!1}var Tr=W,Ar={XMLParser:gr,XMLValidator:le,XMLBuilder:Tr},J={},j={};Object.defineProperty(j,"__esModule",{value:!0}),j.vsub=j.vlen=j.vlen2=void 0;function Be(e){return e.x*e.x+e.y*e.y}j.vlen2=Be;function Cr(e){return Math.sqrt(Be(e))}j.vlen=Cr;function Or(e,t){return{x:e.x-t.x,y:e.y-t.y}}j.vsub=Or;var ae={};class Ir{constructor(t=[],r=Xr){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:n}=this,s=r[t];for(;t>0;){const i=t-1>>1,o=r[i];if(n(s,o)>=0)break;r[t]=o,t=i}r[t]=s}_down(t){const{data:r,compare:n}=this,s=this.length>>1,i=r[t];for(;t<s;){let o=(t<<1)+1,u=r[o];const a=o+1;if(a<this.length&&n(r[a],u)<0&&(o=a,u=r[a]),n(u,i)>=0)break;r[t]=u,t=o}r[t]=i}}function Xr(e,t){return e<t?-1:e>t?1:0}var Sr=Object.freeze({__proto__:null,default:Ir}),Yr=et(Sr),$r=z&&z.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ae,"__esModule",{value:!0}),ae.knn=void 0;const Lr=$r(Yr);function Br(e,t,r,n,s,i){let o=e.data,u=[],a=e.toBBox,h,l,p,d,x=new Lr.default(void 0,kr);for(;o;){for(h=0;h<o.children.length;h++)l=o.children[h],p=Fr(t,r,o.leaf?a(l):l),(!i||p<=i*i)&&x.push({node:l,isItem:o.leaf,dist:p});for(;x.length&&x.peek().isItem;)if(d=x.pop().node,(!s||s(d))&&u.push(d),n&&u.length===n)return u;o=x.pop(),o&&(o=o.node)}return u}ae.knn=Br;function kr(e,t){return e.dist-t.dist}function Fr(e,t,r){var n=ke(e,r.minX,r.maxX),s=ke(t,r.minY,r.maxY);return n*n+s*s}function ke(e,t,r){return e<t?t-e:e<=r?0:e-r}var Fe={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(z,function(){function r(f,c,v,E,b){(function y(_,P,M,T,O){for(;T>M;){if(T-M>600){var A=T-M+1,I=P-M+1,q=Math.log(A),Y=.5*Math.exp(2*q/3),B=.5*Math.sqrt(q*Y*(A-Y)/A)*(I-A/2<0?-1:1),$=Math.max(M,Math.floor(P-I*Y/A+B)),F=Math.min(T,Math.floor(P+(A-I)*Y/A+B));y(_,P,$,F,O)}var G=_[P],R=M,C=T;for(n(_,M,P),O(_[T],G)>0&&n(_,M,T);R<C;){for(n(_,R,C),R++,C--;O(_[R],G)<0;)R++;for(;O(_[C],G)>0;)C--}O(_[M],G)===0?n(_,M,C):n(_,++C,T),C<=P&&(M=C+1),P<=C&&(T=C-1)}})(f,c,v||0,E||f.length-1,b||s)}function n(f,c,v){var E=f[c];f[c]=f[v],f[v]=E}function s(f,c){return f<c?-1:f>c?1:0}var i=function(f){f===void 0&&(f=9),this._maxEntries=Math.max(4,f),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function o(f,c,v){if(!v)return c.indexOf(f);for(var E=0;E<c.length;E++)if(v(f,c[E]))return E;return-1}function u(f,c){a(f,0,f.children.length,c,f)}function a(f,c,v,E,b){b||(b=N(null)),b.minX=1/0,b.minY=1/0,b.maxX=-1/0,b.maxY=-1/0;for(var y=c;y<v;y++){var _=f.children[y];h(b,f.leaf?E(_):_)}return b}function h(f,c){return f.minX=Math.min(f.minX,c.minX),f.minY=Math.min(f.minY,c.minY),f.maxX=Math.max(f.maxX,c.maxX),f.maxY=Math.max(f.maxY,c.maxY),f}function l(f,c){return f.minX-c.minX}function p(f,c){return f.minY-c.minY}function d(f){return(f.maxX-f.minX)*(f.maxY-f.minY)}function x(f){return f.maxX-f.minX+(f.maxY-f.minY)}function m(f,c){return f.minX<=c.minX&&f.minY<=c.minY&&c.maxX<=f.maxX&&c.maxY<=f.maxY}function g(f,c){return c.minX<=f.maxX&&c.minY<=f.maxY&&c.maxX>=f.minX&&c.maxY>=f.minY}function N(f){return{children:f,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function w(f,c,v,E,b){for(var y=[c,v];y.length;)if(!((v=y.pop())-(c=y.pop())<=E)){var _=c+Math.ceil((v-c)/E/2)*E;r(f,_,c,v,b),y.push(c,_,_,v)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(f){var c=this.data,v=[];if(!g(f,c))return v;for(var E=this.toBBox,b=[];c;){for(var y=0;y<c.children.length;y++){var _=c.children[y],P=c.leaf?E(_):_;g(f,P)&&(c.leaf?v.push(_):m(f,P)?this._all(_,v):b.push(_))}c=b.pop()}return v},i.prototype.collides=function(f){var c=this.data;if(!g(f,c))return!1;for(var v=[];c;){for(var E=0;E<c.children.length;E++){var b=c.children[E],y=c.leaf?this.toBBox(b):b;if(g(f,y)){if(c.leaf||m(f,y))return!0;v.push(b)}}c=v.pop()}return!1},i.prototype.load=function(f){if(!f||!f.length)return this;if(f.length<this._minEntries){for(var c=0;c<f.length;c++)this.insert(f[c]);return this}var v=this._build(f.slice(),0,f.length-1,0);if(this.data.children.length)if(this.data.height===v.height)this._splitRoot(this.data,v);else{if(this.data.height<v.height){var E=this.data;this.data=v,v=E}this._insert(v,this.data.height-v.height-1,!0)}else this.data=v;return this},i.prototype.insert=function(f){return f&&this._insert(f,this.data.height-1),this},i.prototype.clear=function(){return this.data=N([]),this},i.prototype.remove=function(f,c){if(!f)return this;for(var v,E,b,y=this.data,_=this.toBBox(f),P=[],M=[];y||P.length;){if(y||(y=P.pop(),E=P[P.length-1],v=M.pop(),b=!0),y.leaf){var T=o(f,y.children,c);if(T!==-1)return y.children.splice(T,1),P.push(y),this._condense(P),this}b||y.leaf||!m(y,_)?E?(v++,y=E.children[v],b=!1):y=null:(P.push(y),M.push(v),v=0,E=y,y=y.children[0])}return this},i.prototype.toBBox=function(f){return f},i.prototype.compareMinX=function(f,c){return f.minX-c.minX},i.prototype.compareMinY=function(f,c){return f.minY-c.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(f){return this.data=f,this},i.prototype._all=function(f,c){for(var v=[];f;)f.leaf?c.push.apply(c,f.children):v.push.apply(v,f.children),f=v.pop();return c},i.prototype._build=function(f,c,v,E){var b,y=v-c+1,_=this._maxEntries;if(y<=_)return u(b=N(f.slice(c,v+1)),this.toBBox),b;E||(E=Math.ceil(Math.log(y)/Math.log(_)),_=Math.ceil(y/Math.pow(_,E-1))),(b=N([])).leaf=!1,b.height=E;var P=Math.ceil(y/_),M=P*Math.ceil(Math.sqrt(_));w(f,c,v,M,this.compareMinX);for(var T=c;T<=v;T+=M){var O=Math.min(T+M-1,v);w(f,T,O,P,this.compareMinY);for(var A=T;A<=O;A+=P){var I=Math.min(A+P-1,O);b.children.push(this._build(f,A,I,E-1))}}return u(b,this.toBBox),b},i.prototype._chooseSubtree=function(f,c,v,E){for(;E.push(c),!c.leaf&&E.length-1!==v;){for(var b=1/0,y=1/0,_=void 0,P=0;P<c.children.length;P++){var M=c.children[P],T=d(M),O=(A=f,I=M,(Math.max(I.maxX,A.maxX)-Math.min(I.minX,A.minX))*(Math.max(I.maxY,A.maxY)-Math.min(I.minY,A.minY))-T);O<y?(y=O,b=T<b?T:b,_=M):O===y&&T<b&&(b=T,_=M)}c=_||c.children[0]}var A,I;return c},i.prototype._insert=function(f,c,v){var E=v?f:this.toBBox(f),b=[],y=this._chooseSubtree(E,this.data,c,b);for(y.children.push(f),h(y,E);c>=0&&b[c].children.length>this._maxEntries;)this._split(b,c),c--;this._adjustParentBBoxes(E,b,c)},i.prototype._split=function(f,c){var v=f[c],E=v.children.length,b=this._minEntries;this._chooseSplitAxis(v,b,E);var y=this._chooseSplitIndex(v,b,E),_=N(v.children.splice(y,v.children.length-y));_.height=v.height,_.leaf=v.leaf,u(v,this.toBBox),u(_,this.toBBox),c?f[c-1].children.push(_):this._splitRoot(v,_)},i.prototype._splitRoot=function(f,c){this.data=N([f,c]),this.data.height=f.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(f,c,v){for(var E,b,y,_,P,M,T,O=1/0,A=1/0,I=c;I<=v-c;I++){var q=a(f,0,I,this.toBBox),Y=a(f,I,v,this.toBBox),B=(b=q,y=Y,_=void 0,P=void 0,M=void 0,T=void 0,_=Math.max(b.minX,y.minX),P=Math.max(b.minY,y.minY),M=Math.min(b.maxX,y.maxX),T=Math.min(b.maxY,y.maxY),Math.max(0,M-_)*Math.max(0,T-P)),$=d(q)+d(Y);B<O?(O=B,E=I,A=$<A?$:A):B===O&&$<A&&(A=$,E=I)}return E||v-c},i.prototype._chooseSplitAxis=function(f,c,v){var E=f.leaf?this.compareMinX:l,b=f.leaf?this.compareMinY:p;this._allDistMargin(f,c,v,E)<this._allDistMargin(f,c,v,b)&&f.children.sort(E)},i.prototype._allDistMargin=function(f,c,v,E){f.children.sort(E);for(var b=this.toBBox,y=a(f,0,c,b),_=a(f,v-c,v,b),P=x(y)+x(_),M=c;M<v-c;M++){var T=f.children[M];h(y,f.leaf?b(T):T),P+=x(y)}for(var O=v-c-1;O>=c;O--){var A=f.children[O];h(_,f.leaf?b(A):A),P+=x(_)}return P},i.prototype._adjustParentBBoxes=function(f,c,v){for(var E=v;E>=0;E--)h(c[E],f)},i.prototype._condense=function(f){for(var c=f.length-1,v=void 0;c>=0;c--)f[c].children.length===0?c>0?(v=f[c-1].children).splice(v.indexOf(f[c]),1):this.clear():u(f[c],this.toBBox)},i})})(Fe);var Rr=Fe.exports,Vr=z&&z.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(J,"__esModule",{value:!0});var Re=J.reorder=Ge=J.elideShorterThan=qe=J.merge=void 0;const Ve=j,qr=ae,Gr=Vr(Rr);function Wr(e,t){return e.slice(e.findIndex(r=>!t(r)))}function jr(e,t=.5){if(e.length===0)return[];const r=t*t,n=e.slice(),s=[n.shift()];for(;n.length;){const i=s[s.length-1],o=n.shift(),u=i[i.length-1],a=o[0],h=u.x-a.x,l=u.y-a.y;h*h+l*l<=r?s[s.length-1]=s[s.length-1].concat(Wr(o,d=>{const x=u.x-d.x,m=u.y-d.y;return x*x+m*m<=r})):s.push(o)}return s}var qe=J.merge=jr;function Hr(e){if(e.length<=1)return 0;let t=0,r=e[0];for(let n=1;n<e.length;n++)t+=Ve.vlen(Ve.vsub(r,e[n])),r=e[n];return t}function zr(e,t){return e.filter(r=>Hr(r)>=t)}var Ge=J.elideShorterThan=zr;function*Ur(e,t){for(let r=e;r<t;r++)yield r}function Zr(e){if(e.length===0)return e;const t=u=>u%2===0?e[u/2|0][0]:e[u/2|0][e[u/2|0].length-1];class r extends Gr.default{toBBox(a){const{x:h,y:l}=t(a);return{minX:h,minY:l,maxX:h,maxY:l}}compareMinX(a,h){return t(a).x-t(h).x}compareMinY(a,h){return t(a).y-t(h).y}}const n=new r;n.load([...Ur(2,e.length*2)]);const s=[];s.push(e[0]);let i=t(1),o=e.length*2-2;for(;o;){const[u]=qr.knn(n,i.x,i.y,1),a=u/2|0;n.remove(a*2),n.remove(a*2+1),s.push(u%2===0?e[a]:e[a].slice().reverse()),i=t(u%2===0?u+1:u-1),o-=2}return s}Re=J.reorder=Zr;var ue={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},Jr=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279];function Qr(e){return e===10||e===13||e===8232||e===8233||e===32||e===9||e===11||e===12||e===160||e>=5760&&Jr.indexOf(e)>=0}function Kr(e){switch(e|32){case 109:case 122:case 108:case 104:case 118:case 99:case 115:case 113:case 116:case 97:case 114:return!0}return!1}function Dr(e){return(e|32)===97}function Q(e){return e>=48&&e<=57}function en(e){return e>=48&&e<=57||e===43||e===45||e===46}function tn(e){this.index=0,this.path=e,this.max=e.length,this.result=[],this.param=0,this.err="",this.segmentStart=0,this.data=[]}function fe(e){for(;e.index<e.max&&Qr(e.path.charCodeAt(e.index));)e.index++}function rn(e){var t=e.path.charCodeAt(e.index);if(t===48){e.param=0,e.index++;return}if(t===49){e.param=1,e.index++;return}e.err="SvgPath: arc flag can be 0 or 1 only (at pos "+e.index+")"}function nn(e){var t=e.index,r=t,n=e.max,s=!1,i=!1,o=!1,u=!1,a;if(r>=n){e.err="SvgPath: missed param (at pos "+r+")";return}if(a=e.path.charCodeAt(r),(a===43||a===45)&&(r++,a=r<n?e.path.charCodeAt(r):0),!Q(a)&&a!==46){e.err="SvgPath: param should start with 0..9 or `.` (at pos "+r+")";return}if(a!==46){if(s=a===48,r++,a=r<n?e.path.charCodeAt(r):0,s&&r<n&&a&&Q(a)){e.err="SvgPath: numbers started with `0` such as `09` are illegal (at pos "+t+")";return}for(;r<n&&Q(e.path.charCodeAt(r));)r++,i=!0;a=r<n?e.path.charCodeAt(r):0}if(a===46){for(u=!0,r++;Q(e.path.charCodeAt(r));)r++,o=!0;a=r<n?e.path.charCodeAt(r):0}if(a===101||a===69){if(u&&!i&&!o){e.err="SvgPath: invalid float exponent (at pos "+r+")";return}if(r++,a=r<n?e.path.charCodeAt(r):0,(a===43||a===45)&&r++,r<n&&Q(e.path.charCodeAt(r)))for(;r<n&&Q(e.path.charCodeAt(r));)r++;else{e.err="SvgPath: invalid float exponent (at pos "+r+")";return}}e.index=r,e.param=parseFloat(e.path.slice(t,r))+0}function me(e){var t,r;t=e.path[e.segmentStart],r=t.toLowerCase();var n=e.data;if(r==="m"&&n.length>2&&(e.result.push([t,n[0],n[1]]),n=n.slice(2),r="l",t=t==="m"?"l":"L"),r==="r")e.result.push([t].concat(n));else for(;n.length>=ue[r]&&(e.result.push([t].concat(n.splice(0,ue[r]))),!!ue[r]););}function sn(e){var t=e.max,r,n,s,i,o;if(e.segmentStart=e.index,r=e.path.charCodeAt(e.index),n=Dr(r),!Kr(r)){e.err="SvgPath: bad command "+e.path[e.index]+" (at pos "+e.index+")";return}if(i=ue[e.path[e.index].toLowerCase()],e.index++,fe(e),e.data=[],!i){me(e);return}for(s=!1;;){for(o=i;o>0;o--){if(n&&(o===3||o===4)?rn(e):nn(e),e.err.length){me(e);return}e.data.push(e.param),fe(e),s=!1,e.index<t&&e.path.charCodeAt(e.index)===44&&(e.index++,fe(e),s=!0)}if(!s&&(e.index>=e.max||!en(e.path.charCodeAt(e.index))))break}me(e)}var on=function(t){var r=new tn(t),n=r.max;for(fe(r);r.index<n&&!r.err.length;)sn(r);return r.result.length&&("mM".indexOf(r.result[0][0])<0?(r.err="SvgPath: string should start with `M` or `m`",r.result=[]):r.result[0][0]="M"),{err:r.err,segments:r.result}};function an(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}function V(){if(!(this instanceof V))return new V;this.queue=[],this.cache=null}V.prototype.matrix=function(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===1&&e[4]===0&&e[5]===0?this:(this.cache=null,this.queue.push(e),this)},V.prototype.translate=function(e,t){return(e!==0||t!==0)&&(this.cache=null,this.queue.push([1,0,0,1,e,t])),this},V.prototype.scale=function(e,t){return(e!==1||t!==1)&&(this.cache=null,this.queue.push([e,0,0,t,0,0])),this},V.prototype.rotate=function(e,t,r){var n,s,i;return e!==0&&(this.translate(t,r),n=e*Math.PI/180,s=Math.cos(n),i=Math.sin(n),this.queue.push([s,i,-i,s,0,0]),this.cache=null,this.translate(-t,-r)),this},V.prototype.skewX=function(e){return e!==0&&(this.cache=null,this.queue.push([1,0,Math.tan(e*Math.PI/180),1,0,0])),this},V.prototype.skewY=function(e){return e!==0&&(this.cache=null,this.queue.push([1,Math.tan(e*Math.PI/180),0,1,0,0])),this},V.prototype.toArray=function(){if(this.cache)return this.cache;if(!this.queue.length)return this.cache=[1,0,0,1,0,0],this.cache;if(this.cache=this.queue[0],this.queue.length===1)return this.cache;for(var e=1;e<this.queue.length;e++)this.cache=an(this.cache,this.queue[e]);return this.cache},V.prototype.calc=function(e,t,r){var n;return this.queue.length?(this.cache||(this.cache=this.toArray()),n=this.cache,[e*n[0]+t*n[2]+(r?0:n[4]),e*n[1]+t*n[3]+(r?0:n[5])]):[e,t]};var We=V,un=We,fn={matrix:!0,scale:!0,rotate:!0,translate:!0,skewX:!0,skewY:!0},hn=/\s*(matrix|translate|scale|rotate|skewX|skewY)\s*\(\s*(.+?)\s*\)[\s,]*/,ln=/[\s,]+/,cn=function(t){var r=new un,n,s;return t.split(hn).forEach(function(i){if(i.length){if(typeof fn[i]<"u"){n=i;return}switch(s=i.split(ln).map(function(o){return+o||0}),n){case"matrix":s.length===6&&r.matrix(s);return;case"scale":s.length===1?r.scale(s[0],s[0]):s.length===2&&r.scale(s[0],s[1]);return;case"rotate":s.length===1?r.rotate(s[0],0,0):s.length===3&&r.rotate(s[0],s[1],s[2]);return;case"translate":s.length===1?r.translate(s[0],0):s.length===2&&r.translate(s[0],s[1]);return;case"skewX":s.length===1&&r.skewX(s[0]);return;case"skewY":s.length===1&&r.skewY(s[0]);return}}}),r},re=Math.PI*2;function je(e,t,r,n){var s=e*n-t*r<0?-1:1,i=e*r+t*n;return i>1&&(i=1),i<-1&&(i=-1),s*Math.acos(i)}function dn(e,t,r,n,s,i,o,u,a,h){var l=h*(e-r)/2+a*(t-n)/2,p=-a*(e-r)/2+h*(t-n)/2,d=o*o,x=u*u,m=l*l,g=p*p,N=d*x-d*g-x*m;N<0&&(N=0),N/=d*g+x*m,N=Math.sqrt(N)*(s===i?-1:1);var w=N*o/u*p,f=N*-u/o*l,c=h*w-a*f+(e+r)/2,v=a*w+h*f+(t+n)/2,E=(l-w)/o,b=(p-f)/u,y=(-l-w)/o,_=(-p-f)/u,P=je(1,0,E,b),M=je(E,b,y,_);return i===0&&M>0&&(M-=re),i===1&&M<0&&(M+=re),[c,v,P,M]}function pn(e,t){var r=1.3333333333333333*Math.tan(t/4),n=Math.cos(e),s=Math.sin(e),i=Math.cos(e+t),o=Math.sin(e+t);return[n,s,n-s*r,s+n*r,i+o*r,o-i*r,i,o]}var gn=function(t,r,n,s,i,o,u,a,h){var l=Math.sin(h*re/360),p=Math.cos(h*re/360),d=p*(t-n)/2+l*(r-s)/2,x=-l*(t-n)/2+p*(r-s)/2;if(d===0&&x===0)return[];if(u===0||a===0)return[];u=Math.abs(u),a=Math.abs(a);var m=d*d/(u*u)+x*x/(a*a);m>1&&(u*=Math.sqrt(m),a*=Math.sqrt(m));var g=dn(t,r,n,s,i,o,u,a,l,p),N=[],w=g[2],f=g[3],c=Math.max(Math.ceil(Math.abs(f)/(re/4)),1);f/=c;for(var v=0;v<c;v++)N.push(pn(w,f)),w+=f;return N.map(function(E){for(var b=0;b<E.length;b+=2){var y=E[b+0],_=E[b+1];y*=u,_*=a;var P=p*y-l*_,M=l*y+p*_;E[b+0]=P+g[0],E[b+1]=M+g[1]}return E})},ne=1e-10,He=Math.PI/180;function ie(e,t,r){if(!(this instanceof ie))return new ie(e,t,r);this.rx=e,this.ry=t,this.ax=r}ie.prototype.transform=function(e){var t=Math.cos(this.ax*He),r=Math.sin(this.ax*He),n=[this.rx*(e[0]*t+e[2]*r),this.rx*(e[1]*t+e[3]*r),this.ry*(-e[0]*r+e[2]*t),this.ry*(-e[1]*r+e[3]*t)],s=n[0]*n[0]+n[2]*n[2],i=n[1]*n[1]+n[3]*n[3],o=((n[0]-n[3])*(n[0]-n[3])+(n[2]+n[1])*(n[2]+n[1]))*((n[0]+n[3])*(n[0]+n[3])+(n[2]-n[1])*(n[2]-n[1])),u=(s+i)/2;if(o<ne*u)return this.rx=this.ry=Math.sqrt(u),this.ax=0,this;var a=n[0]*n[1]+n[2]*n[3];o=Math.sqrt(o);var h=u+o/2,l=u-o/2;return this.ax=Math.abs(a)<ne&&Math.abs(h-i)<ne?90:Math.atan(Math.abs(a)>Math.abs(h-i)?(h-s)/a:a/(h-i))*180/Math.PI,this.ax>=0?(this.rx=Math.sqrt(h),this.ry=Math.sqrt(l)):(this.ax+=90,this.rx=Math.sqrt(l),this.ry=Math.sqrt(h)),this},ie.prototype.isDegenerate=function(){return this.rx<ne*this.ry||this.ry<ne*this.rx};var mn=ie,vn=on,xn=cn,H=We,bn=gn,Nn=mn;function X(e){if(!(this instanceof X))return new X(e);var t=vn(e);this.segments=t.segments,this.err=t.err,this.__stack=[]}X.from=function(e){if(typeof e=="string")return new X(e);if(e instanceof X){var t=new X("");return t.err=e.err,t.segments=e.segments.map(function(r){return r.slice()}),t.__stack=e.__stack.map(function(r){return H().matrix(r.toArray())}),t}throw new Error("SvgPath.from: invalid param type "+e)},X.prototype.__matrix=function(e){var t=this,r;e.queue.length&&this.iterate(function(n,s,i,o){var u,a,h,l;switch(n[0]){case"v":u=e.calc(0,n[1],!0),a=u[0]===0?["v",u[1]]:["l",u[0],u[1]];break;case"V":u=e.calc(i,n[1],!1),a=u[0]===e.calc(i,o,!1)[0]?["V",u[1]]:["L",u[0],u[1]];break;case"h":u=e.calc(n[1],0,!0),a=u[1]===0?["h",u[0]]:["l",u[0],u[1]];break;case"H":u=e.calc(n[1],o,!1),a=u[1]===e.calc(i,o,!1)[1]?["H",u[0]]:["L",u[0],u[1]];break;case"a":case"A":var p=e.toArray(),d=Nn(n[1],n[2],n[3]).transform(p);if(p[0]*p[3]-p[1]*p[2]<0&&(n[5]=n[5]?"0":"1"),u=e.calc(n[6],n[7],n[0]==="a"),n[0]==="A"&&n[6]===i&&n[7]===o||n[0]==="a"&&n[6]===0&&n[7]===0){a=[n[0]==="a"?"l":"L",u[0],u[1]];break}d.isDegenerate()?a=[n[0]==="a"?"l":"L",u[0],u[1]]:a=[n[0],d.rx,d.ry,d.ax,n[4],n[5],u[0],u[1]];break;case"m":l=s>0,u=e.calc(n[1],n[2],l),a=["m",u[0],u[1]];break;default:for(h=n[0],a=[h],l=h.toLowerCase()===h,r=1;r<n.length;r+=2)u=e.calc(n[r],n[r+1],l),a.push(u[0],u[1])}t.segments[s]=a},!0)},X.prototype.__evaluateStack=function(){var e,t;if(this.__stack.length){if(this.__stack.length===1){this.__matrix(this.__stack[0]),this.__stack=[];return}for(e=H(),t=this.__stack.length;--t>=0;)e.matrix(this.__stack[t].toArray());this.__matrix(e),this.__stack=[]}},X.prototype.toString=function(){var e="",t="",r=!1;this.__evaluateStack();for(var n=0,s=this.segments.length;n<s;n++){var i=this.segments[n],o=i[0];o!==t||o==="m"||o==="M"?(o==="m"&&t==="z"&&(e+=" "),e+=o,r=!1):r=!0;for(var u=1;u<i.length;u++){var a=i[u];u===1?r&&a>=0&&(e+=" "):a>=0&&(e+=" "),e+=a}t=o}return e},X.prototype.translate=function(e,t){return this.__stack.push(H().translate(e,t||0)),this},X.prototype.scale=function(e,t){return this.__stack.push(H().scale(e,!t&&t!==0?e:t)),this},X.prototype.rotate=function(e,t,r){return this.__stack.push(H().rotate(e,t||0,r||0)),this},X.prototype.skewX=function(e){return this.__stack.push(H().skewX(e)),this},X.prototype.skewY=function(e){return this.__stack.push(H().skewY(e)),this},X.prototype.matrix=function(e){return this.__stack.push(H().matrix(e)),this},X.prototype.transform=function(e){return e.trim()?(this.__stack.push(xn(e)),this):this},X.prototype.round=function(e){var t=0,r=0,n=0,s=0,i;return e=e||0,this.__evaluateStack(),this.segments.forEach(function(o){var u=o[0].toLowerCase()===o[0];switch(o[0]){case"H":case"h":u&&(o[1]+=n),n=o[1]-o[1].toFixed(e),o[1]=+o[1].toFixed(e);return;case"V":case"v":u&&(o[1]+=s),s=o[1]-o[1].toFixed(e),o[1]=+o[1].toFixed(e);return;case"Z":case"z":n=t,s=r;return;case"M":case"m":u&&(o[1]+=n,o[2]+=s),n=o[1]-o[1].toFixed(e),s=o[2]-o[2].toFixed(e),t=n,r=s,o[1]=+o[1].toFixed(e),o[2]=+o[2].toFixed(e);return;case"A":case"a":u&&(o[6]+=n,o[7]+=s),n=o[6]-o[6].toFixed(e),s=o[7]-o[7].toFixed(e),o[1]=+o[1].toFixed(e),o[2]=+o[2].toFixed(e),o[3]=+o[3].toFixed(e+2),o[6]=+o[6].toFixed(e),o[7]=+o[7].toFixed(e);return;default:i=o.length,u&&(o[i-2]+=n,o[i-1]+=s),n=o[i-2]-o[i-2].toFixed(e),s=o[i-1]-o[i-1].toFixed(e),o.forEach(function(a,h){h&&(o[h]=+o[h].toFixed(e))});return}}),this},X.prototype.iterate=function(e,t){var r=this.segments,n={},s=!1,i=0,o=0,u=0,a=0,h,l,p;if(t||this.__evaluateStack(),r.forEach(function(d,x){var m=e(d,x,i,o);Array.isArray(m)&&(n[x]=m,s=!0);var g=d[0]===d[0].toLowerCase();switch(d[0]){case"m":case"M":i=d[1]+(g?i:0),o=d[2]+(g?o:0),u=i,a=o;return;case"h":case"H":i=d[1]+(g?i:0);return;case"v":case"V":o=d[1]+(g?o:0);return;case"z":case"Z":i=u,o=a;return;default:i=d[d.length-2]+(g?i:0),o=d[d.length-1]+(g?o:0)}}),!s)return this;for(p=[],h=0;h<r.length;h++)if(typeof n[h]<"u")for(l=0;l<n[h].length;l++)p.push(n[h][l]);else p.push(r[h]);return this.segments=p,this},X.prototype.abs=function(){return this.iterate(function(e,t,r,n){var s=e[0],i=s.toUpperCase(),o;if(s!==i)switch(e[0]=i,s){case"v":e[1]+=n;return;case"a":e[6]+=r,e[7]+=n;return;default:for(o=1;o<e.length;o++)e[o]+=o%2?r:n}},!0),this},X.prototype.rel=function(){return this.iterate(function(e,t,r,n){var s=e[0],i=s.toLowerCase(),o;if(s!==i&&!(t===0&&s==="M"))switch(e[0]=i,s){case"V":e[1]-=n;return;case"A":e[6]-=r,e[7]-=n;return;default:for(o=1;o<e.length;o++)e[o]-=o%2?r:n}},!0),this},X.prototype.unarc=function(){return this.iterate(function(e,t,r,n){var s,i,o,u=[],a=e[0];return a!=="A"&&a!=="a"?null:(a==="a"?(i=r+e[6],o=n+e[7]):(i=e[6],o=e[7]),s=bn(r,n,i,o,e[4],e[5],e[1],e[2],e[3]),s.length===0?[[e[0]==="a"?"l":"L",e[6],e[7]]]:(s.forEach(function(h){u.push(["C",h[2],h[3],h[4],h[5],h[6],h[7]])}),u))}),this},X.prototype.unshort=function(){var e=this.segments,t,r,n,s,i;return this.iterate(function(o,u,a,h){var l=o[0],p=l.toUpperCase(),d;u&&(p==="T"?(d=l==="t",n=e[u-1],n[0]==="Q"?(t=n[1]-a,r=n[2]-h):n[0]==="q"?(t=n[1]-n[3],r=n[2]-n[4]):(t=0,r=0),s=-t,i=-r,d||(s+=a,i+=h),e[u]=[d?"q":"Q",s,i,o[1],o[2]]):p==="S"&&(d=l==="s",n=e[u-1],n[0]==="C"?(t=n[3]-a,r=n[4]-h):n[0]==="c"?(t=n[3]-n[5],r=n[4]-n[6]):(t=0,r=0),s=-t,i=-r,d||(s+=a,i+=h),e[u]=[d?"c":"C",s,i,o[1],o[2],o[3],o[4]]))}),this};var yn=X,En=yn,_n=ve(En);function ze(e){return[e[0],e[1]]}function k(e,t){return[e,t]}var wn=function(t){t=t||{};var r=typeof t.recursion=="number"?t.recursion:8,n=typeof t.epsilon=="number"?t.epsilon:11920929e-14,s=typeof t.pathEpsilon=="number"?t.pathEpsilon:1,i=typeof t.angleEpsilon=="number"?t.angleEpsilon:.01,o=t.angleTolerance||0,u=t.cuspLimit||0;return function(p,d,x,m,g,N){N||(N=[]),g=typeof g=="number"?g:1;var w=s/g;return w*=w,a(p,d,x,m,N,w),N};function a(l,p,d,x,m,g){m.push(ze(l));var N=l[0],w=l[1],f=p[0],c=p[1],v=d[0],E=d[1],b=x[0],y=x[1];h(N,w,f,c,v,E,b,y,m,g,0),m.push(ze(x))}function h(l,p,d,x,m,g,N,w,f,c,v){if(!(v>r)){var E=Math.PI,b=(l+d)/2,y=(p+x)/2,_=(d+m)/2,P=(x+g)/2,M=(m+N)/2,T=(g+w)/2,O=(b+_)/2,A=(y+P)/2,I=(_+M)/2,q=(P+T)/2,Y=(O+I)/2,B=(A+q)/2;if(v>0){var $=N-l,F=w-p,G=Math.abs((d-N)*F-(x-w)*$),R=Math.abs((m-N)*F-(g-w)*$),C,D;if(G>n&&R>n){if((G+R)*(G+R)<=c*($*$+F*F)){if(o<i){f.push(k(Y,B));return}var De=Math.atan2(g-x,m-d);if(C=Math.abs(De-Math.atan2(x-p,d-l)),D=Math.abs(Math.atan2(w-g,N-m)-De),C>=E&&(C=2*E-C),D>=E&&(D=2*E-D),C+D<o){f.push(k(Y,B));return}if(u!==0){if(C>u){f.push(k(d,x));return}if(D>u){f.push(k(m,g));return}}}}else if(G>n){if(G*G<=c*($*$+F*F)){if(o<i){f.push(k(Y,B));return}if(C=Math.abs(Math.atan2(g-x,m-d)-Math.atan2(x-p,d-l)),C>=E&&(C=2*E-C),C<o){f.push(k(d,x)),f.push(k(m,g));return}if(u!==0&&C>u){f.push(k(d,x));return}}}else if(R>n){if(R*R<=c*($*$+F*F)){if(o<i){f.push(k(Y,B));return}if(C=Math.abs(Math.atan2(w-g,N-m)-Math.atan2(g-x,m-d)),C>=E&&(C=2*E-C),C<o){f.push(k(d,x)),f.push(k(m,g));return}if(u!==0&&C>u){f.push(k(m,g));return}}}else if($=Y-(l+N)/2,F=B-(p+w)/2,$*$+F*F<=c){f.push(k(Y,B));return}}h(l,p,b,y,O,A,Y,B,f,c,v+1),h(Y,B,I,q,M,T,N,w,f,c,v+1)}}},Mn=ve(wn);const Pn=Mn({recursion:8,pathEpsilon:.1});function Tn(e,t){const{grid:r}=t;if(r.enabled){const{pathList:n}=Ue(e,{...t,width:r.totalWidth,height:r.totalHeight,marginX:0,marginY:0}),s=t.width-t.marginX*2,i=t.height-t.marginY*2,o=Math.ceil(r.totalWidth/s),u=Math.ceil(r.totalHeight/i),a=Cn(n,{cellWidth:s,cellHeight:i,cols:o,rows:u,marginX:t.marginX,marginY:t.marginY}),h={minX:t.marginX,maxX:t.width-t.marginX,minY:t.marginY,maxY:t.height-t.marginY};return{pathGrid:a.map(l=>({pathList:l,bounds:h})),cols:o,rows:u}}else return{pathGrid:[Ue(e,t)],cols:1,rows:1}}function An(e,t){const{parentWidth:r,parentHeight:n,rotation:s}=t;let i=[];return e.forEach(o=>{const u=In(o);if(u){const a=_n.from(u).unarc().unshort().abs().iterate((x,m,g,N)=>{switch(x[0]){case"H":return[["L",x[1],N]];case"V":return[["L",g,x[1]]];case"Q":{const[f,c,v,E]=x.slice(1),b=g+2*(f-g)/3,y=N+2*(c-N)/3,_=v+2*(f-v)/3,P=E+2*(c-E)/3;return[["C",b,y,_,P,v,E]]}default:return[x]}}).transform(o.transform);s!==0&&a.rotate(s,r*.5,n*.5);const h=[];let l=[],p=null,d=null;a.iterate((x,m,g,N)=>{const w=x[0];switch(w){case"M":{l.length>0&&h.push(l),l=[x[1],x[2]],p=[x[1],x[2]];break}case"L":{l.push(x[1],x[2]);break}case"C":{const[f,c,v,E,b,y]=x.slice(1),_=Pn([g,N],[f,c],[v,E],[b,y]).flat();d==="M"?l=[..._]:l.push(..._);break}case"Z":{p&&l.push(p[0],p[1]);break}default:console.warn("Encountered unknown command during path parsing:",w)}d=w}),l.length>0&&h.push(l),h.forEach(x=>{const m=[];for(let g=0;g<x.length;g+=2)m.push({x:x[g],y:x[g+1]});i.push(m)})}}),i}function Ue(e,t){const r=structuredClone(e),{parentWidth:n,parentHeight:s,width:i,height:o,marginX:u,marginY:a,alignment:h,rotation:l,useBoundingBox:p}=t,d={minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0};r.forEach(b=>{b.forEach(y=>{d.minX=Math.min(y.x,d.minX),d.maxX=Math.max(y.x,d.maxX),d.minY=Math.min(y.y,d.minY),d.maxY=Math.max(y.y,d.maxY)})});let x=0,m=0,g=0,N=0;if(p)x=d.maxX-d.minX,m=d.maxY-d.minY,g=-d.minX,N=-d.minY;else{const b=l*Math.PI/180,y=Math.abs(Math.sin(b)),_=Math.abs(Math.cos(b));x=n*_+s*y,m=n*y+s*_,g=(x-n)*.5,N=(m-s)*.5}if(x===0||m===0)throw new Error("Could not determine SVG dimensions");const w=i-u*2,f=o-a*2,c=Math.min(w/x,f/m),v=(w-x*c)*.5*h,E=(f-m*c)*.5*h;return r.forEach(b=>{b.forEach(y=>{y.x=(y.x+g)*c+v+u,y.y=(y.y+N)*c+E+a})}),d.minX=(d.minX+g)*c+v+u,d.minY=(d.minY+N)*c+E+a,d.maxX=(d.maxX+g)*c+v+u,d.maxY=(d.maxY+N)*c+E+a,{pathList:r,bounds:d}}function Cn(e,t){const{cellWidth:r,cellHeight:n,cols:s,rows:i,marginX:o,marginY:u}=t,a=r*s,h=n*i;let l=structuredClone(e),p=[];for(let d=0;d<i;d++)for(let x=0;x<s;x++){let m=[],g=[],N=l.shift();const w=x*r,f=d*n,c=w+r,v=f+n,E={minX:w,minY:f,maxX:c,maxY:v};for(;N;){let b=!1,y=0,_=null;N.forEach((M,T)=>{if(M.x<0||M.x>a||M.y<0||M.y>h)throw new Error(`Invalid point found during path division: ${M.x}, ${M.y}`);const O=M.x>=w&&M.x<c&&M.y>=f&&M.y<v;if(O!==b){if(T>0){let A,I;O?(A=M,I=N[T-1]):(A=N[T-1],I=M);const q=On(A,I,E),Y=N.slice(y,T).concat(q);_&&Y.unshift(_),O?g.push(Y):m.push(Y),_={...q}}b=O,y=T}});const P=N.slice(y);_&&P.unshift(_),b?m.push(P):g.push(P),N=l.shift()}m.forEach(b=>{b.forEach(y=>{y.x=y.x-w+o,y.y=y.y-f+u})}),p.push(m),l=g}return p}function On(e,t,r){const{minX:n,minY:s,maxX:i,maxY:o}=r,{x:u,y:a}=e,{x:h,y:l}=t,p=h-u,d=l-a;let x=0,m=1,g,N,w;for(let f=0;f<4;f++){if(f===0&&(g=-p,N=-(n-u)),f===1&&(g=p,N=i-u),f===2&&(g=-d,N=-(s-a)),f===3&&(g=d,N=o-a),w=N/g,g===0&&N<0)return null;if(g<0){if(w>m)return null;w>x&&(x=w)}else if(g>0){if(w<x)return null;w<m&&(m=w)}}return{x:u+m*p,y:a+m*d}}function In(e){switch(e.tag){case"path":return e.d;case"rect":return Xn(e);case"circle":return Sn(e);case"ellipse":return Yn(e);case"line":return $n(e);case"polygon":return Ln(e);case"polyline":return Bn(e);default:return null}}function he(e,t){return t.map(r=>Number(e[r]))}function K(e){return e.join(" ")}function Xn(e){const[t,r,n,s,i,o]=he(e,["x","y","width","height","rx","ry"]);if(i||o){let u=i||o,a=o||i;return u*2>n&&(u-=(u*2-n)/2),a*2>s&&(a-=(a*2-s)/2),K(["M",t+u,r,"h",n-u*2,"s",u,0,u,a,"v",s-a*2,"s",0,a,-u,a,"h",-n+u*2,"s",-u,0,-u,-a,"v",-s+a*2,"s",0,-a,u,-a])}else return K(["M",t,r,"h",n,"v",s,"H",t,"Z"])}function Sn(e){const[t,r,n]=he(e,["cx","cy","r"]);return K(["M",t-n,r,"a",n,n,0,1,0,2*n,0,"a",n,n,0,1,0,-2*n,0])}function Yn(e){const[t,r,n,s]=he(e,["cx","cy","rx","ry"]);return K(["M",t-n,r,"a",n,s,0,1,0,2*n,0,"a",n,s,0,1,0,-2*n,0])}function $n(e){const[t,r,n,s]=he(e,["x1","x2","y1","y2"]);return K(["M",t,n,"L",r,s])}function Ln(e){return Ze(e).concat("Z")}function Bn(e){return Ze(e)}function Ze(e){const{points:t=""}=e,r=t.trim().split(/[ ,]+/),n=[];for(let s=0;s<r.length;s+=2)n.push(s===0?"M":"L",[Number(r[s]),Number(r[s+1])]);return K(n)}const kn=["svg","g","a"],Fn=["rect","circle","ellipse","path","line","polyline","polygon"],Rn=new Ar.XMLParser({ignoreDeclaration:!0,ignoreAttributes:!1,attributeNamePrefix:""});function Vn(e,t){const{width:r,height:n,marginX:s,marginY:i,grid:o,alignment:u,rotation:a,useBoundingBox:h,postProcessing:l}=t,{svg:p}=Rn.parse(e);if(!p)throw new Error("Root SVG node not found");const{viewBox:d,translation:x}=Ke(p),m=Je(p,x),g=d.width,N=d.height,w={parentWidth:g,parentHeight:N,width:r,height:n,marginX:s,marginY:i,grid:o,alignment:u,rotation:a,useBoundingBox:h},f=An(m,w),{pathGrid:c,cols:v,rows:E}=Tn(f,w);return c.forEach(b=>{l.merge&&(b.pathList=qe(b.pathList,l.mergeTolerance)),l.filterShort&&(b.pathList=Ge(b.pathList,l.filterShortLength)),l.reorder&&(b.pathList=Re(b.pathList)),l.randomizeStart&&(b.pathList=qn(b.pathList,l.randomizeStartTolerance))}),{pathGrid:c,cols:v,rows:E}}function Je(e,t=""){const r=we(e.style)??{},n=se(r.transform,e.transform);return Qe(e,r)?[]:Object.entries(e).reduce((s,[i,o])=>{const u=kn.includes(i),a=Fn.includes(i);if(u||a){const h=Array.isArray(o)?o:[o];if(u){let l="";if(e.tag==="svg"){const{translation:p}=Ke(e);l=se(t,p,n)}else l=se(t,n);h.forEach(p=>{s.push(...Je(p,l))})}else h.forEach(l=>{const p=we(l.style)??{},d=se(p.transform,l.transform),x=se(t,n,d);Qe(l,p)||s.push({...l,tag:i,transform:x})})}return s},[])}function se(...e){return e.filter(Boolean).join(" ")}function Qe(e,t){return e.display==="none"||e.visibility==="hidden"||t.display==="none"||t.visibility==="hidden"}function Ke(e){let t=0,r=0,n=NaN,s=NaN,i="";if(!e.viewBox)e.width&&e.height&&(n=Number(e.width.match(/\d*/)),s=Number(e.height.match(/\d*/)));else{const o=e.viewBox.split(" ").map(u=>Number(u));t=o[0],r=o[1],n=o[2],s=o[3]}if(isNaN(n)||isNaN(s))throw new Error("Could not determine view box dimensions.");return(t!==0||r!==0)&&!isNaN(t)&&!isNaN(r)&&(i=`translate(${t}, ${r})`),{viewBox:{minX:t,minY:r,width:n,height:s},translation:i}}function qn(e,t){return e.map(r=>{const n=r.length;if(Gn(r[0].x,r[0].y,r[n-1].x,r[n-1].y)<t){let i=Math.floor(Math.random()*n);if(i%2!==0&&i++,i>0&&i<n-1){const o=r[i];return r.slice(i).concat(r.slice(0,i)).concat(o)}}return r})}function Gn(e,t,r,n){return Math.hypot(e-r,t-n)}const Wn="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let jn=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=Wn[r[e]&63];return t};function Hn(e,t,r){const{width:n,height:s,marginX:i,marginY:o}=r;let u="",a="",h={x:0,y:s};e.length>0&&(e.forEach(N=>{a+=` M${h.x},${h.y} L${N[0].x},${N[0].y}`,u+=` M${N[0].x},${N[0].y}`;for(let w=1;w<N.length;w++)u+=` L${N[w].x},${N[w].y}`;h.x=N[N.length-1].x,h.y=N[N.length-1].y}),u=u.trim(),a=a.trim());const l=[`M${i},${o}`,`L${n-i},${o}`,`L${n-i},${s-o}`,`L${i},${s-o}`,`L${i},${o}`].join(""),{minX:p,minY:d,maxX:x,maxY:m}=t,g=[`M${p},${d}`,`L${x},${d}`,`L${x},${m}`,`L${p},${m}`,`L${p},${d}`].join("");return{downPath:u,upPath:a,marginsPath:l,boundsPath:g,width:n,height:s,id:jn()}}onmessage=e=>{try{const{svg:t,options:r}=JSON.parse(e.data),{pathGrid:n,cols:s,rows:i}=Vn(t,r);postMessage(JSON.stringify({isError:!1,result:{pathGrid:n,previews:n.map(({pathList:o,bounds:u})=>Hn(o,u,r)),options:r,cols:s,rows:i}}))}catch(t){let r="Unknown error";t instanceof Error?r=t.message:typeof t=="string"&&(r=t),console.error(t),postMessage(JSON.stringify({isError:!0,errorMessage:r}))}}})();
