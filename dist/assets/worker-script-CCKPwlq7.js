(function(){"use strict";var z=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ve(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function rt(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}var xe={},be=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,nt=/\n/g,it=/^\s*/,st=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,ot=/^:\s*/,at=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,ut=/^[;\s]*/,ht=/^\s+|\s+$/g,ft=`
`,Ne="/",ye="*",U="",ct="comment",lt="declaration",dt=function(e,t){if(typeof e!="string")throw new TypeError("First argument must be a string");if(!e)return[];t=t||{};var r=1,n=1;function i(m){var p=m.match(nt);p&&(r+=p.length);var y=m.lastIndexOf(ft);n=~y?m.length-y:n+m.length}function s(){var m={line:r,column:n};return function(p){return p.position=new a(m),c(),p}}function a(m){this.start=m,this.end={line:r,column:n},this.source=t.source}a.prototype.content=e;function u(m){var p=new Error(t.source+":"+r+":"+n+": "+m);if(p.reason=m,p.filename=t.source,p.line=r,p.column=n,p.source=e,!t.silent)throw p}function o(m){var p=m.exec(e);if(p){var y=p[0];return i(y),e=e.slice(y.length),p}}function c(){o(it)}function f(m){var p;for(m=m||[];p=g();)p!==!1&&m.push(p);return m}function g(){var m=s();if(!(Ne!=e.charAt(0)||ye!=e.charAt(1))){for(var p=2;U!=e.charAt(p)&&(ye!=e.charAt(p)||Ne!=e.charAt(p+1));)++p;if(p+=2,U===e.charAt(p-1))return u("End of comment missing");var y=e.slice(2,p-2);return n+=2,i(y),e=e.slice(p),n+=2,m({type:ct,comment:y})}}function d(){var m=s(),p=o(st);if(p){if(g(),!o(ot))return u("property missing ':'");var y=o(at),M=m({type:lt,property:Ee(p[0].replace(be,U)),value:y?Ee(y[0].replace(be,U)):U});return o(ut),M}}function v(){var m=[];f(m);for(var p;p=d();)p!==!1&&(m.push(p),f(m));return m}return c(),v()};function Ee(e){return e?e.replace(ht,U):U}var pt=z&&z.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(xe,"__esModule",{value:!0});var _e=xe.default=mt,gt=pt(dt);function mt(e,t){var r=null;if(!e||typeof e!="string")return r;var n=(0,gt.default)(e),i=typeof t=="function";return n.forEach(function(s){if(s.type==="declaration"){var a=s.property,u=s.value;i?t(a,u,s):u&&(r=r||{},r[a]=u)}}),r}var we=_e.default||_e,ce={},oe={};(function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",r=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",n="["+t+"]["+r+"]*",i=new RegExp("^"+n+"$"),s=function(u,o){const c=[];let f=o.exec(u);for(;f;){const g=[];g.startIndex=o.lastIndex-f[0].length;const d=f.length;for(let v=0;v<d;v++)g.push(f[v]);c.push(g),f=o.exec(u)}return c},a=function(u){const o=i.exec(u);return!(o===null||typeof o>"u")};e.isExist=function(u){return typeof u<"u"},e.isEmptyObject=function(u){return Object.keys(u).length===0},e.merge=function(u,o,c){if(o){const f=Object.keys(o),g=f.length;for(let d=0;d<g;d++)c==="strict"?u[f[d]]=[o[f[d]]]:u[f[d]]=o[f[d]]}},e.getValue=function(u){return e.isExist(u)?u:""},e.isName=a,e.getAllMatches=s,e.nameRegexp=n})(oe);const le=oe,vt={allowBooleanAttributes:!1,unpairedTags:[]};ce.validate=function(e,t){t=Object.assign({},vt,t);const r=[];let n=!1,i=!1;e[0]==="\uFEFF"&&(e=e.substr(1));for(let s=0;s<e.length;s++)if(e[s]==="<"&&e[s+1]==="?"){if(s+=2,s=Pe(e,s),s.err)return s}else if(e[s]==="<"){let a=s;if(s++,e[s]==="!"){s=Te(e,s);continue}else{let u=!1;e[s]==="/"&&(u=!0,s++);let o="";for(;s<e.length&&e[s]!==">"&&e[s]!==" "&&e[s]!=="	"&&e[s]!==`
`&&e[s]!=="\r";s++)o+=e[s];if(o=o.trim(),o[o.length-1]==="/"&&(o=o.substring(0,o.length-1),s--),!Mt(o)){let g;return o.trim().length===0?g="Invalid space after '<'.":g="Tag '"+o+"' is an invalid name.",O("InvalidTag",g,L(e,s))}const c=Nt(e,s);if(c===!1)return O("InvalidAttr","Attributes for '"+o+"' have open quote.",L(e,s));let f=c.value;if(s=c.index,f[f.length-1]==="/"){const g=s-f.length;f=f.substring(0,f.length-1);const d=Ae(f,t);if(d===!0)n=!0;else return O(d.err.code,d.err.msg,L(e,g+d.err.line))}else if(u)if(c.tagClosed){if(f.trim().length>0)return O("InvalidTag","Closing tag '"+o+"' can't have attributes or invalid starting.",L(e,a));if(r.length===0)return O("InvalidTag","Closing tag '"+o+"' has not been opened.",L(e,a));{const g=r.pop();if(o!==g.tagName){let d=L(e,g.tagStartPos);return O("InvalidTag","Expected closing tag '"+g.tagName+"' (opened in line "+d.line+", col "+d.col+") instead of closing tag '"+o+"'.",L(e,a))}r.length==0&&(i=!0)}}else return O("InvalidTag","Closing tag '"+o+"' doesn't have proper closing.",L(e,s));else{const g=Ae(f,t);if(g!==!0)return O(g.err.code,g.err.msg,L(e,s-f.length+g.err.line));if(i===!0)return O("InvalidXml","Multiple possible root nodes found.",L(e,s));t.unpairedTags.indexOf(o)!==-1||r.push({tagName:o,tagStartPos:a}),n=!0}for(s++;s<e.length;s++)if(e[s]==="<")if(e[s+1]==="!"){s++,s=Te(e,s);continue}else if(e[s+1]==="?"){if(s=Pe(e,++s),s.err)return s}else break;else if(e[s]==="&"){const g=_t(e,s);if(g==-1)return O("InvalidChar","char '&' is not expected.",L(e,s));s=g}else if(i===!0&&!Me(e[s]))return O("InvalidXml","Extra text at the end",L(e,s));e[s]==="<"&&s--}}else{if(Me(e[s]))continue;return O("InvalidChar","char '"+e[s]+"' is not expected.",L(e,s))}if(n){if(r.length==1)return O("InvalidTag","Unclosed tag '"+r[0].tagName+"'.",L(e,r[0].tagStartPos));if(r.length>0)return O("InvalidXml","Invalid '"+JSON.stringify(r.map(s=>s.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return O("InvalidXml","Start tag expected.",1);return!0};function Me(e){return e===" "||e==="	"||e===`
`||e==="\r"}function Pe(e,t){const r=t;for(;t<e.length;t++)if(e[t]=="?"||e[t]==" "){const n=e.substr(r,t-r);if(t>5&&n==="xml")return O("InvalidXml","XML declaration allowed only at the start of the document.",L(e,t));if(e[t]=="?"&&e[t+1]==">"){t++;break}else continue}return t}function Te(e,t){if(e.length>t+5&&e[t+1]==="-"&&e[t+2]==="-"){for(t+=3;t<e.length;t++)if(e[t]==="-"&&e[t+1]==="-"&&e[t+2]===">"){t+=2;break}}else if(e.length>t+8&&e[t+1]==="D"&&e[t+2]==="O"&&e[t+3]==="C"&&e[t+4]==="T"&&e[t+5]==="Y"&&e[t+6]==="P"&&e[t+7]==="E"){let r=1;for(t+=8;t<e.length;t++)if(e[t]==="<")r++;else if(e[t]===">"&&(r--,r===0))break}else if(e.length>t+9&&e[t+1]==="["&&e[t+2]==="C"&&e[t+3]==="D"&&e[t+4]==="A"&&e[t+5]==="T"&&e[t+6]==="A"&&e[t+7]==="["){for(t+=8;t<e.length;t++)if(e[t]==="]"&&e[t+1]==="]"&&e[t+2]===">"){t+=2;break}}return t}const xt='"',bt="'";function Nt(e,t){let r="",n="",i=!1;for(;t<e.length;t++){if(e[t]===xt||e[t]===bt)n===""?n=e[t]:n!==e[t]||(n="");else if(e[t]===">"&&n===""){i=!0;break}r+=e[t]}return n!==""?!1:{value:r,index:t,tagClosed:i}}const yt=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function Ae(e,t){const r=le.getAllMatches(e,yt),n={};for(let i=0;i<r.length;i++){if(r[i][1].length===0)return O("InvalidAttr","Attribute '"+r[i][2]+"' has no space in starting.",ee(r[i]));if(r[i][3]!==void 0&&r[i][4]===void 0)return O("InvalidAttr","Attribute '"+r[i][2]+"' is without value.",ee(r[i]));if(r[i][3]===void 0&&!t.allowBooleanAttributes)return O("InvalidAttr","boolean attribute '"+r[i][2]+"' is not allowed.",ee(r[i]));const s=r[i][2];if(!wt(s))return O("InvalidAttr","Attribute '"+s+"' is an invalid name.",ee(r[i]));if(!n.hasOwnProperty(s))n[s]=1;else return O("InvalidAttr","Attribute '"+s+"' is repeated.",ee(r[i]))}return!0}function Et(e,t){let r=/\d/;for(e[t]==="x"&&(t++,r=/[\da-fA-F]/);t<e.length;t++){if(e[t]===";")return t;if(!e[t].match(r))break}return-1}function _t(e,t){if(t++,e[t]===";")return-1;if(e[t]==="#")return t++,Et(e,t);let r=0;for(;t<e.length;t++,r++)if(!(e[t].match(/\w/)&&r<20)){if(e[t]===";")break;return-1}return t}function O(e,t,r){return{err:{code:e,msg:t,line:r.line||r,col:r.col}}}function wt(e){return le.isName(e)}function Mt(e){return le.isName(e)}function L(e,t){const r=e.substring(0,t).split(/\r?\n/);return{line:r.length,col:r[r.length-1].length+1}}function ee(e){return e.startIndex+e[1].length}var de={};const Ce={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,r){return e}},Pt=function(e){return Object.assign({},Ce,e)};de.buildOptions=Pt,de.defaultOptions=Ce;class Tt{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,r){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:r})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}var At=Tt;const Ct=oe;function Xt(e,t){const r={};if(e[t+3]==="O"&&e[t+4]==="C"&&e[t+5]==="T"&&e[t+6]==="Y"&&e[t+7]==="P"&&e[t+8]==="E"){t=t+9;let n=1,i=!1,s=!1,a="";for(;t<e.length;t++)if(e[t]==="<"&&!s){if(i&&Ot(e,t))t+=7,[entityName,val,t]=It(e,t+1),val.indexOf("&")===-1&&(r[Bt(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(i&&Yt(e,t))t+=8;else if(i&&$t(e,t))t+=8;else if(i&&Lt(e,t))t+=9;else if(St)s=!0;else throw new Error("Invalid DOCTYPE");n++,a=""}else if(e[t]===">"){if(s?e[t-1]==="-"&&e[t-2]==="-"&&(s=!1,n--):n--,n===0)break}else e[t]==="["?i=!0:a+=e[t];if(n!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:r,i:t}}function It(e,t){let r="";for(;t<e.length&&e[t]!=="'"&&e[t]!=='"';t++)r+=e[t];if(r=r.trim(),r.indexOf(" ")!==-1)throw new Error("External entites are not supported");const n=e[t++];let i="";for(;t<e.length&&e[t]!==n;t++)i+=e[t];return[r,i,t]}function St(e,t){return e[t+1]==="!"&&e[t+2]==="-"&&e[t+3]==="-"}function Ot(e,t){return e[t+1]==="!"&&e[t+2]==="E"&&e[t+3]==="N"&&e[t+4]==="T"&&e[t+5]==="I"&&e[t+6]==="T"&&e[t+7]==="Y"}function Yt(e,t){return e[t+1]==="!"&&e[t+2]==="E"&&e[t+3]==="L"&&e[t+4]==="E"&&e[t+5]==="M"&&e[t+6]==="E"&&e[t+7]==="N"&&e[t+8]==="T"}function $t(e,t){return e[t+1]==="!"&&e[t+2]==="A"&&e[t+3]==="T"&&e[t+4]==="T"&&e[t+5]==="L"&&e[t+6]==="I"&&e[t+7]==="S"&&e[t+8]==="T"}function Lt(e,t){return e[t+1]==="!"&&e[t+2]==="N"&&e[t+3]==="O"&&e[t+4]==="T"&&e[t+5]==="A"&&e[t+6]==="T"&&e[t+7]==="I"&&e[t+8]==="O"&&e[t+9]==="N"}function Bt(e){if(Ct.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}var kt=Xt;const Ft=/^[-+]?0x[a-fA-F0-9]+$/,Rt=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const Vt={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function qt(e,t={}){if(t=Object.assign({},Vt,t),!e||typeof e!="string")return e;let r=e.trim();if(t.skipLike!==void 0&&t.skipLike.test(r))return e;if(t.hex&&Ft.test(r))return Number.parseInt(r,16);{const n=Rt.exec(r);if(n){const i=n[1],s=n[2];let a=Gt(n[3]);const u=n[4]||n[6];if(!t.leadingZeros&&s.length>0&&i&&r[2]!==".")return e;if(!t.leadingZeros&&s.length>0&&!i&&r[1]!==".")return e;{const o=Number(r),c=""+o;return c.search(/[eE]/)!==-1||u?t.eNotation?o:e:r.indexOf(".")!==-1?c==="0"&&a===""||c===a||i&&c==="-"+a?o:e:s?a===c||i+a===c?o:e:r===c||r===i+c?o:e}}else return e}}function Gt(e){return e&&e.indexOf(".")!==-1&&(e=e.replace(/0+$/,""),e==="."?e="0":e[0]==="."?e="0"+e:e[e.length-1]==="."&&(e=e.substr(0,e.length-1))),e}var Wt=qt;function jt(e){return typeof e=="function"?e:Array.isArray(e)?t=>{for(const r of e)if(typeof r=="string"&&t===r||r instanceof RegExp&&r.test(t))return!0}:()=>!1}var Xe=jt;const Ie=oe,te=At,Ht=kt,zt=Wt,Ut=Xe;let Zt=class{constructor(t){this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(r,n)=>String.fromCharCode(Number.parseInt(n,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(r,n)=>String.fromCharCode(Number.parseInt(n,16))}},this.addExternalEntities=Jt,this.parseXml=tr,this.parseTextData=Qt,this.resolveNameSpace=Kt,this.buildAttributesMap=er,this.isItStopNode=sr,this.replaceEntitiesValue=nr,this.readStopNodeData=ar,this.saveTextToParentTag=ir,this.addChild=rr,this.ignoreAttributesFn=Ut(this.options.ignoreAttributes)}};function Jt(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];this.lastEntities[n]={regex:new RegExp("&"+n+";","g"),val:e[n]}}}function Qt(e,t,r,n,i,s,a){if(e!==void 0&&(this.options.trimValues&&!n&&(e=e.trim()),e.length>0)){a||(e=this.replaceEntitiesValue(e));const u=this.options.tagValueProcessor(t,e,r,i,s);return u==null?e:typeof u!=typeof e||u!==e?u:this.options.trimValues?ge(e,this.options.parseTagValue,this.options.numberParseOptions):e.trim()===e?ge(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function Kt(e){if(this.options.removeNSPrefix){const t=e.split(":"),r=e.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(e=r+t[1])}return e}const Dt=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function er(e,t,r){if(this.options.ignoreAttributes!==!0&&typeof e=="string"){const n=Ie.getAllMatches(e,Dt),i=n.length,s={};for(let a=0;a<i;a++){const u=this.resolveNameSpace(n[a][1]);if(this.ignoreAttributesFn(u,t))continue;let o=n[a][4],c=this.options.attributeNamePrefix+u;if(u.length)if(this.options.transformAttributeName&&(c=this.options.transformAttributeName(c)),c==="__proto__"&&(c="#__proto__"),o!==void 0){this.options.trimValues&&(o=o.trim()),o=this.replaceEntitiesValue(o);const f=this.options.attributeValueProcessor(u,o,t);f==null?s[c]=o:typeof f!=typeof o||f!==o?s[c]=f:s[c]=ge(o,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(s[c]=!0)}if(!Object.keys(s).length)return;if(this.options.attributesGroupName){const a={};return a[this.options.attributesGroupName]=s,a}return s}}const tr=function(e){e=e.replace(/\r\n?/g,`
`);const t=new te("!xml");let r=t,n="",i="";for(let s=0;s<e.length;s++)if(e[s]==="<")if(e[s+1]==="/"){const u=Z(e,">",s,"Closing Tag is not closed.");let o=e.substring(s+2,u).trim();if(this.options.removeNSPrefix){const g=o.indexOf(":");g!==-1&&(o=o.substr(g+1))}this.options.transformTagName&&(o=this.options.transformTagName(o)),r&&(n=this.saveTextToParentTag(n,r,i));const c=i.substring(i.lastIndexOf(".")+1);if(o&&this.options.unpairedTags.indexOf(o)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${o}>`);let f=0;c&&this.options.unpairedTags.indexOf(c)!==-1?(f=i.lastIndexOf(".",i.lastIndexOf(".")-1),this.tagsNodeStack.pop()):f=i.lastIndexOf("."),i=i.substring(0,f),r=this.tagsNodeStack.pop(),n="",s=u}else if(e[s+1]==="?"){let u=pe(e,s,!1,"?>");if(!u)throw new Error("Pi Tag is not closed.");if(n=this.saveTextToParentTag(n,r,i),!(this.options.ignoreDeclaration&&u.tagName==="?xml"||this.options.ignorePiTags)){const o=new te(u.tagName);o.add(this.options.textNodeName,""),u.tagName!==u.tagExp&&u.attrExpPresent&&(o[":@"]=this.buildAttributesMap(u.tagExp,i,u.tagName)),this.addChild(r,o,i)}s=u.closeIndex+1}else if(e.substr(s+1,3)==="!--"){const u=Z(e,"-->",s+4,"Comment is not closed.");if(this.options.commentPropName){const o=e.substring(s+4,u-2);n=this.saveTextToParentTag(n,r,i),r.add(this.options.commentPropName,[{[this.options.textNodeName]:o}])}s=u}else if(e.substr(s+1,2)==="!D"){const u=Ht(e,s);this.docTypeEntities=u.entities,s=u.i}else if(e.substr(s+1,2)==="!["){const u=Z(e,"]]>",s,"CDATA is not closed.")-2,o=e.substring(s+9,u);n=this.saveTextToParentTag(n,r,i);let c=this.parseTextData(o,r.tagname,i,!0,!1,!0,!0);c==null&&(c=""),this.options.cdataPropName?r.add(this.options.cdataPropName,[{[this.options.textNodeName]:o}]):r.add(this.options.textNodeName,c),s=u+2}else{let u=pe(e,s,this.options.removeNSPrefix),o=u.tagName;const c=u.rawTagName;let f=u.tagExp,g=u.attrExpPresent,d=u.closeIndex;this.options.transformTagName&&(o=this.options.transformTagName(o)),r&&n&&r.tagname!=="!xml"&&(n=this.saveTextToParentTag(n,r,i,!1));const v=r;if(v&&this.options.unpairedTags.indexOf(v.tagname)!==-1&&(r=this.tagsNodeStack.pop(),i=i.substring(0,i.lastIndexOf("."))),o!==t.tagname&&(i+=i?"."+o:o),this.isItStopNode(this.options.stopNodes,i,o)){let m="";if(f.length>0&&f.lastIndexOf("/")===f.length-1)o[o.length-1]==="/"?(o=o.substr(0,o.length-1),i=i.substr(0,i.length-1),f=o):f=f.substr(0,f.length-1),s=u.closeIndex;else if(this.options.unpairedTags.indexOf(o)!==-1)s=u.closeIndex;else{const y=this.readStopNodeData(e,c,d+1);if(!y)throw new Error(`Unexpected end of ${c}`);s=y.i,m=y.tagContent}const p=new te(o);o!==f&&g&&(p[":@"]=this.buildAttributesMap(f,i,o)),m&&(m=this.parseTextData(m,o,i,!0,g,!0,!0)),i=i.substr(0,i.lastIndexOf(".")),p.add(this.options.textNodeName,m),this.addChild(r,p,i)}else{if(f.length>0&&f.lastIndexOf("/")===f.length-1){o[o.length-1]==="/"?(o=o.substr(0,o.length-1),i=i.substr(0,i.length-1),f=o):f=f.substr(0,f.length-1),this.options.transformTagName&&(o=this.options.transformTagName(o));const m=new te(o);o!==f&&g&&(m[":@"]=this.buildAttributesMap(f,i,o)),this.addChild(r,m,i),i=i.substr(0,i.lastIndexOf("."))}else{const m=new te(o);this.tagsNodeStack.push(r),o!==f&&g&&(m[":@"]=this.buildAttributesMap(f,i,o)),this.addChild(r,m,i),r=m}n="",s=d}}else n+=e[s];return t.child};function rr(e,t,r){const n=this.options.updateTag(t.tagname,r,t[":@"]);n===!1||(typeof n=="string"&&(t.tagname=n),e.addChild(t))}const nr=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const r=this.docTypeEntities[t];e=e.replace(r.regx,r.val)}for(let t in this.lastEntities){const r=this.lastEntities[t];e=e.replace(r.regex,r.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const r=this.htmlEntities[t];e=e.replace(r.regex,r.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function ir(e,t,r,n){return e&&(n===void 0&&(n=Object.keys(t.child).length===0),e=this.parseTextData(e,t.tagname,r,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,n),e!==void 0&&e!==""&&t.add(this.options.textNodeName,e),e=""),e}function sr(e,t,r){const n="*."+r;for(const i in e){const s=e[i];if(n===s||t===s)return!0}return!1}function or(e,t,r=">"){let n,i="";for(let s=t;s<e.length;s++){let a=e[s];if(n)a===n&&(n="");else if(a==='"'||a==="'")n=a;else if(a===r[0])if(r[1]){if(e[s+1]===r[1])return{data:i,index:s}}else return{data:i,index:s};else a==="	"&&(a=" ");i+=a}}function Z(e,t,r,n){const i=e.indexOf(t,r);if(i===-1)throw new Error(n);return i+t.length-1}function pe(e,t,r,n=">"){const i=or(e,t+1,n);if(!i)return;let s=i.data;const a=i.index,u=s.search(/\s/);let o=s,c=!0;u!==-1&&(o=s.substring(0,u),s=s.substring(u+1).trimStart());const f=o;if(r){const g=o.indexOf(":");g!==-1&&(o=o.substr(g+1),c=o!==i.data.substr(g+1))}return{tagName:o,tagExp:s,closeIndex:a,attrExpPresent:c,rawTagName:f}}function ar(e,t,r){const n=r;let i=1;for(;r<e.length;r++)if(e[r]==="<")if(e[r+1]==="/"){const s=Z(e,">",r,`${t} is not closed`);if(e.substring(r+2,s).trim()===t&&(i--,i===0))return{tagContent:e.substring(n,r),i:s};r=s}else if(e[r+1]==="?")r=Z(e,"?>",r+1,"StopNode is not closed.");else if(e.substr(r+1,3)==="!--")r=Z(e,"-->",r+3,"StopNode is not closed.");else if(e.substr(r+1,2)==="![")r=Z(e,"]]>",r,"StopNode is not closed.")-2;else{const s=pe(e,r,">");s&&((s&&s.tagName)===t&&s.tagExp[s.tagExp.length-1]!=="/"&&i++,r=s.closeIndex)}}function ge(e,t,r){if(t&&typeof e=="string"){const n=e.trim();return n==="true"?!0:n==="false"?!1:zt(e,r)}else return Ie.isExist(e)?e:""}var ur=Zt,Se={};function hr(e,t){return Oe(e,t)}function Oe(e,t,r){let n;const i={};for(let s=0;s<e.length;s++){const a=e[s],u=fr(a);let o="";if(r===void 0?o=u:o=r+"."+u,u===t.textNodeName)n===void 0?n=a[u]:n+=""+a[u];else{if(u===void 0)continue;if(a[u]){let c=Oe(a[u],t,o);const f=lr(c,t);a[":@"]?cr(c,a[":@"],o,t):Object.keys(c).length===1&&c[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?c=c[t.textNodeName]:Object.keys(c).length===0&&(t.alwaysCreateTextNode?c[t.textNodeName]="":c=""),i[u]!==void 0&&i.hasOwnProperty(u)?(Array.isArray(i[u])||(i[u]=[i[u]]),i[u].push(c)):t.isArray(u,o,f)?i[u]=[c]:i[u]=c}}}return typeof n=="string"?n.length>0&&(i[t.textNodeName]=n):n!==void 0&&(i[t.textNodeName]=n),i}function fr(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];if(n!==":@")return n}}function cr(e,t,r,n){if(t){const i=Object.keys(t),s=i.length;for(let a=0;a<s;a++){const u=i[a];n.isArray(u,r+"."+u,!0,!0)?e[u]=[t[u]]:e[u]=t[u]}}}function lr(e,t){const{textNodeName:r}=t,n=Object.keys(e).length;return!!(n===0||n===1&&(e[r]||typeof e[r]=="boolean"||e[r]===0))}Se.prettify=hr;const{buildOptions:dr}=de,pr=ur,{prettify:gr}=Se,mr=ce;var vr=class{constructor(t){this.externalEntities={},this.options=dr(t)}parse(t,r){if(typeof t!="string")if(t.toString)t=t.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(r){r===!0&&(r={});const s=mr.validate(t,r);if(s!==!0)throw Error(`${s.err.msg}:${s.err.line}:${s.err.col}`)}const n=new pr(this.options);n.addExternalEntities(this.externalEntities);const i=n.parseXml(t);return this.options.preserveOrder||i===void 0?i:gr(i,this.options)}addEntity(t,r){if(r.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(t.indexOf("&")!==-1||t.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(r==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[t]=r}};const xr=`
`;function br(e,t){let r="";return t.format&&t.indentBy.length>0&&(r=xr),Ye(e,t,"",r)}function Ye(e,t,r,n){let i="",s=!1;for(let a=0;a<e.length;a++){const u=e[a],o=Nr(u);if(o===void 0)continue;let c="";if(r.length===0?c=o:c=`${r}.${o}`,o===t.textNodeName){let m=u[o];yr(c,t)||(m=t.tagValueProcessor(o,m),m=Le(m,t)),s&&(i+=n),i+=m,s=!1;continue}else if(o===t.cdataPropName){s&&(i+=n),i+=`<![CDATA[${u[o][0][t.textNodeName]}]]>`,s=!1;continue}else if(o===t.commentPropName){i+=n+`<!--${u[o][0][t.textNodeName]}-->`,s=!0;continue}else if(o[0]==="?"){const m=$e(u[":@"],t),p=o==="?xml"?"":n;let y=u[o][0][t.textNodeName];y=y.length!==0?" "+y:"",i+=p+`<${o}${y}${m}?>`,s=!0;continue}let f=n;f!==""&&(f+=t.indentBy);const g=$e(u[":@"],t),d=n+`<${o}${g}`,v=Ye(u[o],t,c,f);t.unpairedTags.indexOf(o)!==-1?t.suppressUnpairedNode?i+=d+">":i+=d+"/>":(!v||v.length===0)&&t.suppressEmptyNode?i+=d+"/>":v&&v.endsWith(">")?i+=d+`>${v}${n}</${o}>`:(i+=d+">",v&&n!==""&&(v.includes("/>")||v.includes("</"))?i+=n+t.indentBy+v+n:i+=v,i+=`</${o}>`),s=!0}return i}function Nr(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];if(e.hasOwnProperty(n)&&n!==":@")return n}}function $e(e,t){let r="";if(e&&!t.ignoreAttributes)for(let n in e){if(!e.hasOwnProperty(n))continue;let i=t.attributeValueProcessor(n,e[n]);i=Le(i,t),i===!0&&t.suppressBooleanAttributes?r+=` ${n.substr(t.attributeNamePrefix.length)}`:r+=` ${n.substr(t.attributeNamePrefix.length)}="${i}"`}return r}function yr(e,t){e=e.substr(0,e.length-t.textNodeName.length-1);let r=e.substr(e.lastIndexOf(".")+1);for(let n in t.stopNodes)if(t.stopNodes[n]===e||t.stopNodes[n]==="*."+r)return!0;return!1}function Le(e,t){if(e&&e.length>0&&t.processEntities)for(let r=0;r<t.entities.length;r++){const n=t.entities[r];e=e.replace(n.regex,n.val)}return e}var Er=br;const _r=Er,wr=Xe,Mr={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function W(e){this.options=Object.assign({},Mr,e),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=wr(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=Ar),this.processTextOrObjNode=Pr,this.options.format?(this.indentate=Tr,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}W.prototype.build=function(e){return this.options.preserveOrder?_r(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0,[]).val)},W.prototype.j2x=function(e,t,r){let n="",i="";const s=r.join(".");for(let a in e)if(Object.prototype.hasOwnProperty.call(e,a))if(typeof e[a]>"u")this.isAttribute(a)&&(i+="");else if(e[a]===null)this.isAttribute(a)?i+="":a[0]==="?"?i+=this.indentate(t)+"<"+a+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+a+"/"+this.tagEndChar;else if(e[a]instanceof Date)i+=this.buildTextValNode(e[a],a,"",t);else if(typeof e[a]!="object"){const u=this.isAttribute(a);if(u&&!this.ignoreAttributesFn(u,s))n+=this.buildAttrPairStr(u,""+e[a]);else if(!u)if(a===this.options.textNodeName){let o=this.options.tagValueProcessor(a,""+e[a]);i+=this.replaceEntitiesValue(o)}else i+=this.buildTextValNode(e[a],a,"",t)}else if(Array.isArray(e[a])){const u=e[a].length;let o="",c="";for(let f=0;f<u;f++){const g=e[a][f];if(!(typeof g>"u"))if(g===null)a[0]==="?"?i+=this.indentate(t)+"<"+a+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+a+"/"+this.tagEndChar;else if(typeof g=="object")if(this.options.oneListGroup){const d=this.j2x(g,t+1,r.concat(a));o+=d.val,this.options.attributesGroupName&&g.hasOwnProperty(this.options.attributesGroupName)&&(c+=d.attrStr)}else o+=this.processTextOrObjNode(g,a,t,r);else if(this.options.oneListGroup){let d=this.options.tagValueProcessor(a,g);d=this.replaceEntitiesValue(d),o+=d}else o+=this.buildTextValNode(g,a,"",t)}this.options.oneListGroup&&(o=this.buildObjectNode(o,a,c,t)),i+=o}else if(this.options.attributesGroupName&&a===this.options.attributesGroupName){const u=Object.keys(e[a]),o=u.length;for(let c=0;c<o;c++)n+=this.buildAttrPairStr(u[c],""+e[a][u[c]])}else i+=this.processTextOrObjNode(e[a],a,t,r);return{attrStr:n,val:i}},W.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&t==="true"?" "+e:" "+e+'="'+t+'"'};function Pr(e,t,r,n){const i=this.j2x(e,r+1,n.concat(t));return e[this.options.textNodeName]!==void 0&&Object.keys(e).length===1?this.buildTextValNode(e[this.options.textNodeName],t,i.attrStr,r):this.buildObjectNode(i.val,t,i.attrStr,r)}W.prototype.buildObjectNode=function(e,t,r,n){if(e==="")return t[0]==="?"?this.indentate(n)+"<"+t+r+"?"+this.tagEndChar:this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar;{let i="</"+t+this.tagEndChar,s="";return t[0]==="?"&&(s="?",i=""),(r||r==="")&&e.indexOf("<")===-1?this.indentate(n)+"<"+t+r+s+">"+e+i:this.options.commentPropName!==!1&&t===this.options.commentPropName&&s.length===0?this.indentate(n)+`<!--${e}-->`+this.newLine:this.indentate(n)+"<"+t+r+s+this.tagEndChar+e+this.indentate(n)+i}},W.prototype.closeTag=function(e){let t="";return this.options.unpairedTags.indexOf(e)!==-1?this.options.suppressUnpairedNode||(t="/"):this.options.suppressEmptyNode?t="/":t=`></${e}`,t},W.prototype.buildTextValNode=function(e,t,r,n){if(this.options.cdataPropName!==!1&&t===this.options.cdataPropName)return this.indentate(n)+`<![CDATA[${e}]]>`+this.newLine;if(this.options.commentPropName!==!1&&t===this.options.commentPropName)return this.indentate(n)+`<!--${e}-->`+this.newLine;if(t[0]==="?")return this.indentate(n)+"<"+t+r+"?"+this.tagEndChar;{let i=this.options.tagValueProcessor(t,e);return i=this.replaceEntitiesValue(i),i===""?this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar:this.indentate(n)+"<"+t+r+">"+i+"</"+t+this.tagEndChar}},W.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const r=this.options.entities[t];e=e.replace(r.regex,r.val)}return e};function Tr(e){return this.options.indentBy.repeat(e)}function Ar(e){return e.startsWith(this.options.attributeNamePrefix)&&e!==this.options.textNodeName?e.substr(this.attrPrefixLen):!1}var Cr=W,Xr={XMLParser:vr,XMLValidator:ce,XMLBuilder:Cr},J={},j={};Object.defineProperty(j,"__esModule",{value:!0}),j.vsub=j.vlen=j.vlen2=void 0;function Be(e){return e.x*e.x+e.y*e.y}j.vlen2=Be;function Ir(e){return Math.sqrt(Be(e))}j.vlen=Ir;function Sr(e,t){return{x:e.x-t.x,y:e.y-t.y}}j.vsub=Sr;var ae={};class Or{constructor(t=[],r=Yr){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:n}=this,i=r[t];for(;t>0;){const s=t-1>>1,a=r[s];if(n(i,a)>=0)break;r[t]=a,t=s}r[t]=i}_down(t){const{data:r,compare:n}=this,i=this.length>>1,s=r[t];for(;t<i;){let a=(t<<1)+1,u=r[a];const o=a+1;if(o<this.length&&n(r[o],u)<0&&(a=o,u=r[o]),n(u,s)>=0)break;r[t]=u,t=a}r[t]=s}}function Yr(e,t){return e<t?-1:e>t?1:0}var $r=Object.freeze({__proto__:null,default:Or}),Lr=rt($r),Br=z&&z.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ae,"__esModule",{value:!0}),ae.knn=void 0;const kr=Br(Lr);function Fr(e,t,r,n,i,s){let a=e.data,u=[],o=e.toBBox,c,f,g,d,v=new kr.default(void 0,Rr);for(;a;){for(c=0;c<a.children.length;c++)f=a.children[c],g=Vr(t,r,a.leaf?o(f):f),(!s||g<=s*s)&&v.push({node:f,isItem:a.leaf,dist:g});for(;v.length&&v.peek().isItem;)if(d=v.pop().node,(!i||i(d))&&u.push(d),n&&u.length===n)return u;a=v.pop(),a&&(a=a.node)}return u}ae.knn=Fr;function Rr(e,t){return e.dist-t.dist}function Vr(e,t,r){var n=ke(e,r.minX,r.maxX),i=ke(t,r.minY,r.maxY);return n*n+i*i}function ke(e,t,r){return e<t?t-e:e<=r?0:e-r}var Fe={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(z,function(){function r(h,l,x,E,b){(function N(_,P,w,T,X){for(;T>w;){if(T-w>600){var A=T-w+1,I=P-w+1,q=Math.log(A),Y=.5*Math.exp(2*q/3),B=.5*Math.sqrt(q*Y*(A-Y)/A)*(I-A/2<0?-1:1),$=Math.max(w,Math.floor(P-I*Y/A+B)),F=Math.min(T,Math.floor(P+(A-I)*Y/A+B));N(_,P,$,F,X)}var G=_[P],R=w,C=T;for(n(_,w,P),X(_[T],G)>0&&n(_,w,T);R<C;){for(n(_,R,C),R++,C--;X(_[R],G)<0;)R++;for(;X(_[C],G)>0;)C--}X(_[w],G)===0?n(_,w,C):n(_,++C,T),C<=P&&(w=C+1),P<=C&&(T=C-1)}})(h,l,x||0,E||h.length-1,b||i)}function n(h,l,x){var E=h[l];h[l]=h[x],h[x]=E}function i(h,l){return h<l?-1:h>l?1:0}var s=function(h){h===void 0&&(h=9),this._maxEntries=Math.max(4,h),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function a(h,l,x){if(!x)return l.indexOf(h);for(var E=0;E<l.length;E++)if(x(h,l[E]))return E;return-1}function u(h,l){o(h,0,h.children.length,l,h)}function o(h,l,x,E,b){b||(b=y(null)),b.minX=1/0,b.minY=1/0,b.maxX=-1/0,b.maxY=-1/0;for(var N=l;N<x;N++){var _=h.children[N];c(b,h.leaf?E(_):_)}return b}function c(h,l){return h.minX=Math.min(h.minX,l.minX),h.minY=Math.min(h.minY,l.minY),h.maxX=Math.max(h.maxX,l.maxX),h.maxY=Math.max(h.maxY,l.maxY),h}function f(h,l){return h.minX-l.minX}function g(h,l){return h.minY-l.minY}function d(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function v(h){return h.maxX-h.minX+(h.maxY-h.minY)}function m(h,l){return h.minX<=l.minX&&h.minY<=l.minY&&l.maxX<=h.maxX&&l.maxY<=h.maxY}function p(h,l){return l.minX<=h.maxX&&l.minY<=h.maxY&&l.maxX>=h.minX&&l.maxY>=h.minY}function y(h){return{children:h,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function M(h,l,x,E,b){for(var N=[l,x];N.length;)if(!((x=N.pop())-(l=N.pop())<=E)){var _=l+Math.ceil((x-l)/E/2)*E;r(h,_,l,x,b),N.push(l,_,_,x)}}return s.prototype.all=function(){return this._all(this.data,[])},s.prototype.search=function(h){var l=this.data,x=[];if(!p(h,l))return x;for(var E=this.toBBox,b=[];l;){for(var N=0;N<l.children.length;N++){var _=l.children[N],P=l.leaf?E(_):_;p(h,P)&&(l.leaf?x.push(_):m(h,P)?this._all(_,x):b.push(_))}l=b.pop()}return x},s.prototype.collides=function(h){var l=this.data;if(!p(h,l))return!1;for(var x=[];l;){for(var E=0;E<l.children.length;E++){var b=l.children[E],N=l.leaf?this.toBBox(b):b;if(p(h,N)){if(l.leaf||m(h,N))return!0;x.push(b)}}l=x.pop()}return!1},s.prototype.load=function(h){if(!h||!h.length)return this;if(h.length<this._minEntries){for(var l=0;l<h.length;l++)this.insert(h[l]);return this}var x=this._build(h.slice(),0,h.length-1,0);if(this.data.children.length)if(this.data.height===x.height)this._splitRoot(this.data,x);else{if(this.data.height<x.height){var E=this.data;this.data=x,x=E}this._insert(x,this.data.height-x.height-1,!0)}else this.data=x;return this},s.prototype.insert=function(h){return h&&this._insert(h,this.data.height-1),this},s.prototype.clear=function(){return this.data=y([]),this},s.prototype.remove=function(h,l){if(!h)return this;for(var x,E,b,N=this.data,_=this.toBBox(h),P=[],w=[];N||P.length;){if(N||(N=P.pop(),E=P[P.length-1],x=w.pop(),b=!0),N.leaf){var T=a(h,N.children,l);if(T!==-1)return N.children.splice(T,1),P.push(N),this._condense(P),this}b||N.leaf||!m(N,_)?E?(x++,N=E.children[x],b=!1):N=null:(P.push(N),w.push(x),x=0,E=N,N=N.children[0])}return this},s.prototype.toBBox=function(h){return h},s.prototype.compareMinX=function(h,l){return h.minX-l.minX},s.prototype.compareMinY=function(h,l){return h.minY-l.minY},s.prototype.toJSON=function(){return this.data},s.prototype.fromJSON=function(h){return this.data=h,this},s.prototype._all=function(h,l){for(var x=[];h;)h.leaf?l.push.apply(l,h.children):x.push.apply(x,h.children),h=x.pop();return l},s.prototype._build=function(h,l,x,E){var b,N=x-l+1,_=this._maxEntries;if(N<=_)return u(b=y(h.slice(l,x+1)),this.toBBox),b;E||(E=Math.ceil(Math.log(N)/Math.log(_)),_=Math.ceil(N/Math.pow(_,E-1))),(b=y([])).leaf=!1,b.height=E;var P=Math.ceil(N/_),w=P*Math.ceil(Math.sqrt(_));M(h,l,x,w,this.compareMinX);for(var T=l;T<=x;T+=w){var X=Math.min(T+w-1,x);M(h,T,X,P,this.compareMinY);for(var A=T;A<=X;A+=P){var I=Math.min(A+P-1,X);b.children.push(this._build(h,A,I,E-1))}}return u(b,this.toBBox),b},s.prototype._chooseSubtree=function(h,l,x,E){for(;E.push(l),!l.leaf&&E.length-1!==x;){for(var b=1/0,N=1/0,_=void 0,P=0;P<l.children.length;P++){var w=l.children[P],T=d(w),X=(A=h,I=w,(Math.max(I.maxX,A.maxX)-Math.min(I.minX,A.minX))*(Math.max(I.maxY,A.maxY)-Math.min(I.minY,A.minY))-T);X<N?(N=X,b=T<b?T:b,_=w):X===N&&T<b&&(b=T,_=w)}l=_||l.children[0]}var A,I;return l},s.prototype._insert=function(h,l,x){var E=x?h:this.toBBox(h),b=[],N=this._chooseSubtree(E,this.data,l,b);for(N.children.push(h),c(N,E);l>=0&&b[l].children.length>this._maxEntries;)this._split(b,l),l--;this._adjustParentBBoxes(E,b,l)},s.prototype._split=function(h,l){var x=h[l],E=x.children.length,b=this._minEntries;this._chooseSplitAxis(x,b,E);var N=this._chooseSplitIndex(x,b,E),_=y(x.children.splice(N,x.children.length-N));_.height=x.height,_.leaf=x.leaf,u(x,this.toBBox),u(_,this.toBBox),l?h[l-1].children.push(_):this._splitRoot(x,_)},s.prototype._splitRoot=function(h,l){this.data=y([h,l]),this.data.height=h.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},s.prototype._chooseSplitIndex=function(h,l,x){for(var E,b,N,_,P,w,T,X=1/0,A=1/0,I=l;I<=x-l;I++){var q=o(h,0,I,this.toBBox),Y=o(h,I,x,this.toBBox),B=(b=q,N=Y,_=void 0,P=void 0,w=void 0,T=void 0,_=Math.max(b.minX,N.minX),P=Math.max(b.minY,N.minY),w=Math.min(b.maxX,N.maxX),T=Math.min(b.maxY,N.maxY),Math.max(0,w-_)*Math.max(0,T-P)),$=d(q)+d(Y);B<X?(X=B,E=I,A=$<A?$:A):B===X&&$<A&&(A=$,E=I)}return E||x-l},s.prototype._chooseSplitAxis=function(h,l,x){var E=h.leaf?this.compareMinX:f,b=h.leaf?this.compareMinY:g;this._allDistMargin(h,l,x,E)<this._allDistMargin(h,l,x,b)&&h.children.sort(E)},s.prototype._allDistMargin=function(h,l,x,E){h.children.sort(E);for(var b=this.toBBox,N=o(h,0,l,b),_=o(h,x-l,x,b),P=v(N)+v(_),w=l;w<x-l;w++){var T=h.children[w];c(N,h.leaf?b(T):T),P+=v(N)}for(var X=x-l-1;X>=l;X--){var A=h.children[X];c(_,h.leaf?b(A):A),P+=v(_)}return P},s.prototype._adjustParentBBoxes=function(h,l,x){for(var E=x;E>=0;E--)c(l[E],h)},s.prototype._condense=function(h){for(var l=h.length-1,x=void 0;l>=0;l--)h[l].children.length===0?l>0?(x=h[l-1].children).splice(x.indexOf(h[l]),1):this.clear():u(h[l],this.toBBox)},s})})(Fe);var qr=Fe.exports,Gr=z&&z.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(J,"__esModule",{value:!0});var Re=J.reorder=Ge=J.elideShorterThan=qe=J.merge=void 0;const Ve=j,Wr=ae,jr=Gr(qr);function Hr(e,t){return e.slice(e.findIndex(r=>!t(r)))}function zr(e,t=.5){if(e.length===0)return[];const r=t*t,n=e.slice(),i=[n.shift()];for(;n.length;){const s=i[i.length-1],a=n.shift(),u=s[s.length-1],o=a[0],c=u.x-o.x,f=u.y-o.y;c*c+f*f<=r?i[i.length-1]=i[i.length-1].concat(Hr(a,d=>{const v=u.x-d.x,m=u.y-d.y;return v*v+m*m<=r})):i.push(a)}return i}var qe=J.merge=zr;function Ur(e){if(e.length<=1)return 0;let t=0,r=e[0];for(let n=1;n<e.length;n++)t+=Ve.vlen(Ve.vsub(r,e[n])),r=e[n];return t}function Zr(e,t){return e.filter(r=>Ur(r)>=t)}var Ge=J.elideShorterThan=Zr;function*Jr(e,t){for(let r=e;r<t;r++)yield r}function Qr(e){if(e.length===0)return e;const t=u=>u%2===0?e[u/2|0][0]:e[u/2|0][e[u/2|0].length-1];class r extends jr.default{toBBox(o){const{x:c,y:f}=t(o);return{minX:c,minY:f,maxX:c,maxY:f}}compareMinX(o,c){return t(o).x-t(c).x}compareMinY(o,c){return t(o).y-t(c).y}}const n=new r;n.load([...Jr(2,e.length*2)]);const i=[];i.push(e[0]);let s=t(1),a=e.length*2-2;for(;a;){const[u]=Wr.knn(n,s.x,s.y,1),o=u/2|0;n.remove(o*2),n.remove(o*2+1),i.push(u%2===0?e[o]:e[o].slice().reverse()),s=t(u%2===0?u+1:u-1),a-=2}return i}Re=J.reorder=Qr;var ue={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},Kr=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279];function Dr(e){return e===10||e===13||e===8232||e===8233||e===32||e===9||e===11||e===12||e===160||e>=5760&&Kr.indexOf(e)>=0}function en(e){switch(e|32){case 109:case 122:case 108:case 104:case 118:case 99:case 115:case 113:case 116:case 97:case 114:return!0}return!1}function tn(e){return(e|32)===97}function Q(e){return e>=48&&e<=57}function rn(e){return e>=48&&e<=57||e===43||e===45||e===46}function nn(e){this.index=0,this.path=e,this.max=e.length,this.result=[],this.param=0,this.err="",this.segmentStart=0,this.data=[]}function he(e){for(;e.index<e.max&&Dr(e.path.charCodeAt(e.index));)e.index++}function sn(e){var t=e.path.charCodeAt(e.index);if(t===48){e.param=0,e.index++;return}if(t===49){e.param=1,e.index++;return}e.err="SvgPath: arc flag can be 0 or 1 only (at pos "+e.index+")"}function on(e){var t=e.index,r=t,n=e.max,i=!1,s=!1,a=!1,u=!1,o;if(r>=n){e.err="SvgPath: missed param (at pos "+r+")";return}if(o=e.path.charCodeAt(r),(o===43||o===45)&&(r++,o=r<n?e.path.charCodeAt(r):0),!Q(o)&&o!==46){e.err="SvgPath: param should start with 0..9 or `.` (at pos "+r+")";return}if(o!==46){if(i=o===48,r++,o=r<n?e.path.charCodeAt(r):0,i&&r<n&&o&&Q(o)){e.err="SvgPath: numbers started with `0` such as `09` are illegal (at pos "+t+")";return}for(;r<n&&Q(e.path.charCodeAt(r));)r++,s=!0;o=r<n?e.path.charCodeAt(r):0}if(o===46){for(u=!0,r++;Q(e.path.charCodeAt(r));)r++,a=!0;o=r<n?e.path.charCodeAt(r):0}if(o===101||o===69){if(u&&!s&&!a){e.err="SvgPath: invalid float exponent (at pos "+r+")";return}if(r++,o=r<n?e.path.charCodeAt(r):0,(o===43||o===45)&&r++,r<n&&Q(e.path.charCodeAt(r)))for(;r<n&&Q(e.path.charCodeAt(r));)r++;else{e.err="SvgPath: invalid float exponent (at pos "+r+")";return}}e.index=r,e.param=parseFloat(e.path.slice(t,r))+0}function me(e){var t,r;t=e.path[e.segmentStart],r=t.toLowerCase();var n=e.data;if(r==="m"&&n.length>2&&(e.result.push([t,n[0],n[1]]),n=n.slice(2),r="l",t=t==="m"?"l":"L"),r==="r")e.result.push([t].concat(n));else for(;n.length>=ue[r]&&(e.result.push([t].concat(n.splice(0,ue[r]))),!!ue[r]););}function an(e){var t=e.max,r,n,i,s,a;if(e.segmentStart=e.index,r=e.path.charCodeAt(e.index),n=tn(r),!en(r)){e.err="SvgPath: bad command "+e.path[e.index]+" (at pos "+e.index+")";return}if(s=ue[e.path[e.index].toLowerCase()],e.index++,he(e),e.data=[],!s){me(e);return}for(i=!1;;){for(a=s;a>0;a--){if(n&&(a===3||a===4)?sn(e):on(e),e.err.length){me(e);return}e.data.push(e.param),he(e),i=!1,e.index<t&&e.path.charCodeAt(e.index)===44&&(e.index++,he(e),i=!0)}if(!i&&(e.index>=e.max||!rn(e.path.charCodeAt(e.index))))break}me(e)}var un=function(t){var r=new nn(t),n=r.max;for(he(r);r.index<n&&!r.err.length;)an(r);return r.result.length&&("mM".indexOf(r.result[0][0])<0?(r.err="SvgPath: string should start with `M` or `m`",r.result=[]):r.result[0][0]="M"),{err:r.err,segments:r.result}};function hn(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}function V(){if(!(this instanceof V))return new V;this.queue=[],this.cache=null}V.prototype.matrix=function(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===1&&e[4]===0&&e[5]===0?this:(this.cache=null,this.queue.push(e),this)},V.prototype.translate=function(e,t){return(e!==0||t!==0)&&(this.cache=null,this.queue.push([1,0,0,1,e,t])),this},V.prototype.scale=function(e,t){return(e!==1||t!==1)&&(this.cache=null,this.queue.push([e,0,0,t,0,0])),this},V.prototype.rotate=function(e,t,r){var n,i,s;return e!==0&&(this.translate(t,r),n=e*Math.PI/180,i=Math.cos(n),s=Math.sin(n),this.queue.push([i,s,-s,i,0,0]),this.cache=null,this.translate(-t,-r)),this},V.prototype.skewX=function(e){return e!==0&&(this.cache=null,this.queue.push([1,0,Math.tan(e*Math.PI/180),1,0,0])),this},V.prototype.skewY=function(e){return e!==0&&(this.cache=null,this.queue.push([1,Math.tan(e*Math.PI/180),0,1,0,0])),this},V.prototype.toArray=function(){if(this.cache)return this.cache;if(!this.queue.length)return this.cache=[1,0,0,1,0,0],this.cache;if(this.cache=this.queue[0],this.queue.length===1)return this.cache;for(var e=1;e<this.queue.length;e++)this.cache=hn(this.cache,this.queue[e]);return this.cache},V.prototype.calc=function(e,t,r){var n;return this.queue.length?(this.cache||(this.cache=this.toArray()),n=this.cache,[e*n[0]+t*n[2]+(r?0:n[4]),e*n[1]+t*n[3]+(r?0:n[5])]):[e,t]};var We=V,fn=We,cn={matrix:!0,scale:!0,rotate:!0,translate:!0,skewX:!0,skewY:!0},ln=/\s*(matrix|translate|scale|rotate|skewX|skewY)\s*\(\s*(.+?)\s*\)[\s,]*/,dn=/[\s,]+/,pn=function(t){var r=new fn,n,i;return t.split(ln).forEach(function(s){if(s.length){if(typeof cn[s]<"u"){n=s;return}switch(i=s.split(dn).map(function(a){return+a||0}),n){case"matrix":i.length===6&&r.matrix(i);return;case"scale":i.length===1?r.scale(i[0],i[0]):i.length===2&&r.scale(i[0],i[1]);return;case"rotate":i.length===1?r.rotate(i[0],0,0):i.length===3&&r.rotate(i[0],i[1],i[2]);return;case"translate":i.length===1?r.translate(i[0],0):i.length===2&&r.translate(i[0],i[1]);return;case"skewX":i.length===1&&r.skewX(i[0]);return;case"skewY":i.length===1&&r.skewY(i[0]);return}}}),r},re=Math.PI*2;function je(e,t,r,n){var i=e*n-t*r<0?-1:1,s=e*r+t*n;return s>1&&(s=1),s<-1&&(s=-1),i*Math.acos(s)}function gn(e,t,r,n,i,s,a,u,o,c){var f=c*(e-r)/2+o*(t-n)/2,g=-o*(e-r)/2+c*(t-n)/2,d=a*a,v=u*u,m=f*f,p=g*g,y=d*v-d*p-v*m;y<0&&(y=0),y/=d*p+v*m,y=Math.sqrt(y)*(i===s?-1:1);var M=y*a/u*g,h=y*-u/a*f,l=c*M-o*h+(e+r)/2,x=o*M+c*h+(t+n)/2,E=(f-M)/a,b=(g-h)/u,N=(-f-M)/a,_=(-g-h)/u,P=je(1,0,E,b),w=je(E,b,N,_);return s===0&&w>0&&(w-=re),s===1&&w<0&&(w+=re),[l,x,P,w]}function mn(e,t){var r=1.3333333333333333*Math.tan(t/4),n=Math.cos(e),i=Math.sin(e),s=Math.cos(e+t),a=Math.sin(e+t);return[n,i,n-i*r,i+n*r,s+a*r,a-s*r,s,a]}var vn=function(t,r,n,i,s,a,u,o,c){var f=Math.sin(c*re/360),g=Math.cos(c*re/360),d=g*(t-n)/2+f*(r-i)/2,v=-f*(t-n)/2+g*(r-i)/2;if(d===0&&v===0)return[];if(u===0||o===0)return[];u=Math.abs(u),o=Math.abs(o);var m=d*d/(u*u)+v*v/(o*o);m>1&&(u*=Math.sqrt(m),o*=Math.sqrt(m));var p=gn(t,r,n,i,s,a,u,o,f,g),y=[],M=p[2],h=p[3],l=Math.max(Math.ceil(Math.abs(h)/(re/4)),1);h/=l;for(var x=0;x<l;x++)y.push(mn(M,h)),M+=h;return y.map(function(E){for(var b=0;b<E.length;b+=2){var N=E[b+0],_=E[b+1];N*=u,_*=o;var P=g*N-f*_,w=f*N+g*_;E[b+0]=P+p[0],E[b+1]=w+p[1]}return E})},ne=1e-10,He=Math.PI/180;function ie(e,t,r){if(!(this instanceof ie))return new ie(e,t,r);this.rx=e,this.ry=t,this.ax=r}ie.prototype.transform=function(e){var t=Math.cos(this.ax*He),r=Math.sin(this.ax*He),n=[this.rx*(e[0]*t+e[2]*r),this.rx*(e[1]*t+e[3]*r),this.ry*(-e[0]*r+e[2]*t),this.ry*(-e[1]*r+e[3]*t)],i=n[0]*n[0]+n[2]*n[2],s=n[1]*n[1]+n[3]*n[3],a=((n[0]-n[3])*(n[0]-n[3])+(n[2]+n[1])*(n[2]+n[1]))*((n[0]+n[3])*(n[0]+n[3])+(n[2]-n[1])*(n[2]-n[1])),u=(i+s)/2;if(a<ne*u)return this.rx=this.ry=Math.sqrt(u),this.ax=0,this;var o=n[0]*n[1]+n[2]*n[3];a=Math.sqrt(a);var c=u+a/2,f=u-a/2;return this.ax=Math.abs(o)<ne&&Math.abs(c-s)<ne?90:Math.atan(Math.abs(o)>Math.abs(c-s)?(c-i)/o:o/(c-s))*180/Math.PI,this.ax>=0?(this.rx=Math.sqrt(c),this.ry=Math.sqrt(f)):(this.ax+=90,this.rx=Math.sqrt(f),this.ry=Math.sqrt(c)),this},ie.prototype.isDegenerate=function(){return this.rx<ne*this.ry||this.ry<ne*this.rx};var xn=ie,bn=un,Nn=pn,H=We,yn=vn,En=xn;function S(e){if(!(this instanceof S))return new S(e);var t=bn(e);this.segments=t.segments,this.err=t.err,this.__stack=[]}S.from=function(e){if(typeof e=="string")return new S(e);if(e instanceof S){var t=new S("");return t.err=e.err,t.segments=e.segments.map(function(r){return r.slice()}),t.__stack=e.__stack.map(function(r){return H().matrix(r.toArray())}),t}throw new Error("SvgPath.from: invalid param type "+e)},S.prototype.__matrix=function(e){var t=this,r;e.queue.length&&this.iterate(function(n,i,s,a){var u,o,c,f;switch(n[0]){case"v":u=e.calc(0,n[1],!0),o=u[0]===0?["v",u[1]]:["l",u[0],u[1]];break;case"V":u=e.calc(s,n[1],!1),o=u[0]===e.calc(s,a,!1)[0]?["V",u[1]]:["L",u[0],u[1]];break;case"h":u=e.calc(n[1],0,!0),o=u[1]===0?["h",u[0]]:["l",u[0],u[1]];break;case"H":u=e.calc(n[1],a,!1),o=u[1]===e.calc(s,a,!1)[1]?["H",u[0]]:["L",u[0],u[1]];break;case"a":case"A":var g=e.toArray(),d=En(n[1],n[2],n[3]).transform(g);if(g[0]*g[3]-g[1]*g[2]<0&&(n[5]=n[5]?"0":"1"),u=e.calc(n[6],n[7],n[0]==="a"),n[0]==="A"&&n[6]===s&&n[7]===a||n[0]==="a"&&n[6]===0&&n[7]===0){o=[n[0]==="a"?"l":"L",u[0],u[1]];break}d.isDegenerate()?o=[n[0]==="a"?"l":"L",u[0],u[1]]:o=[n[0],d.rx,d.ry,d.ax,n[4],n[5],u[0],u[1]];break;case"m":f=i>0,u=e.calc(n[1],n[2],f),o=["m",u[0],u[1]];break;default:for(c=n[0],o=[c],f=c.toLowerCase()===c,r=1;r<n.length;r+=2)u=e.calc(n[r],n[r+1],f),o.push(u[0],u[1])}t.segments[i]=o},!0)},S.prototype.__evaluateStack=function(){var e,t;if(this.__stack.length){if(this.__stack.length===1){this.__matrix(this.__stack[0]),this.__stack=[];return}for(e=H(),t=this.__stack.length;--t>=0;)e.matrix(this.__stack[t].toArray());this.__matrix(e),this.__stack=[]}},S.prototype.toString=function(){var e="",t="",r=!1;this.__evaluateStack();for(var n=0,i=this.segments.length;n<i;n++){var s=this.segments[n],a=s[0];a!==t||a==="m"||a==="M"?(a==="m"&&t==="z"&&(e+=" "),e+=a,r=!1):r=!0;for(var u=1;u<s.length;u++){var o=s[u];u===1?r&&o>=0&&(e+=" "):o>=0&&(e+=" "),e+=o}t=a}return e},S.prototype.translate=function(e,t){return this.__stack.push(H().translate(e,t||0)),this},S.prototype.scale=function(e,t){return this.__stack.push(H().scale(e,!t&&t!==0?e:t)),this},S.prototype.rotate=function(e,t,r){return this.__stack.push(H().rotate(e,t||0,r||0)),this},S.prototype.skewX=function(e){return this.__stack.push(H().skewX(e)),this},S.prototype.skewY=function(e){return this.__stack.push(H().skewY(e)),this},S.prototype.matrix=function(e){return this.__stack.push(H().matrix(e)),this},S.prototype.transform=function(e){return e.trim()?(this.__stack.push(Nn(e)),this):this},S.prototype.round=function(e){var t=0,r=0,n=0,i=0,s;return e=e||0,this.__evaluateStack(),this.segments.forEach(function(a){var u=a[0].toLowerCase()===a[0];switch(a[0]){case"H":case"h":u&&(a[1]+=n),n=a[1]-a[1].toFixed(e),a[1]=+a[1].toFixed(e);return;case"V":case"v":u&&(a[1]+=i),i=a[1]-a[1].toFixed(e),a[1]=+a[1].toFixed(e);return;case"Z":case"z":n=t,i=r;return;case"M":case"m":u&&(a[1]+=n,a[2]+=i),n=a[1]-a[1].toFixed(e),i=a[2]-a[2].toFixed(e),t=n,r=i,a[1]=+a[1].toFixed(e),a[2]=+a[2].toFixed(e);return;case"A":case"a":u&&(a[6]+=n,a[7]+=i),n=a[6]-a[6].toFixed(e),i=a[7]-a[7].toFixed(e),a[1]=+a[1].toFixed(e),a[2]=+a[2].toFixed(e),a[3]=+a[3].toFixed(e+2),a[6]=+a[6].toFixed(e),a[7]=+a[7].toFixed(e);return;default:s=a.length,u&&(a[s-2]+=n,a[s-1]+=i),n=a[s-2]-a[s-2].toFixed(e),i=a[s-1]-a[s-1].toFixed(e),a.forEach(function(o,c){c&&(a[c]=+a[c].toFixed(e))});return}}),this},S.prototype.iterate=function(e,t){var r=this.segments,n={},i=!1,s=0,a=0,u=0,o=0,c,f,g;if(t||this.__evaluateStack(),r.forEach(function(d,v){var m=e(d,v,s,a);Array.isArray(m)&&(n[v]=m,i=!0);var p=d[0]===d[0].toLowerCase();switch(d[0]){case"m":case"M":s=d[1]+(p?s:0),a=d[2]+(p?a:0),u=s,o=a;return;case"h":case"H":s=d[1]+(p?s:0);return;case"v":case"V":a=d[1]+(p?a:0);return;case"z":case"Z":s=u,a=o;return;default:s=d[d.length-2]+(p?s:0),a=d[d.length-1]+(p?a:0)}}),!i)return this;for(g=[],c=0;c<r.length;c++)if(typeof n[c]<"u")for(f=0;f<n[c].length;f++)g.push(n[c][f]);else g.push(r[c]);return this.segments=g,this},S.prototype.abs=function(){return this.iterate(function(e,t,r,n){var i=e[0],s=i.toUpperCase(),a;if(i!==s)switch(e[0]=s,i){case"v":e[1]+=n;return;case"a":e[6]+=r,e[7]+=n;return;default:for(a=1;a<e.length;a++)e[a]+=a%2?r:n}},!0),this},S.prototype.rel=function(){return this.iterate(function(e,t,r,n){var i=e[0],s=i.toLowerCase(),a;if(i!==s&&!(t===0&&i==="M"))switch(e[0]=s,i){case"V":e[1]-=n;return;case"A":e[6]-=r,e[7]-=n;return;default:for(a=1;a<e.length;a++)e[a]-=a%2?r:n}},!0),this},S.prototype.unarc=function(){return this.iterate(function(e,t,r,n){var i,s,a,u=[],o=e[0];return o!=="A"&&o!=="a"?null:(o==="a"?(s=r+e[6],a=n+e[7]):(s=e[6],a=e[7]),i=yn(r,n,s,a,e[4],e[5],e[1],e[2],e[3]),i.length===0?[[e[0]==="a"?"l":"L",e[6],e[7]]]:(i.forEach(function(c){u.push(["C",c[2],c[3],c[4],c[5],c[6],c[7]])}),u))}),this},S.prototype.unshort=function(){var e=this.segments,t,r,n,i,s;return this.iterate(function(a,u,o,c){var f=a[0],g=f.toUpperCase(),d;u&&(g==="T"?(d=f==="t",n=e[u-1],n[0]==="Q"?(t=n[1]-o,r=n[2]-c):n[0]==="q"?(t=n[1]-n[3],r=n[2]-n[4]):(t=0,r=0),i=-t,s=-r,d||(i+=o,s+=c),e[u]=[d?"q":"Q",i,s,a[1],a[2]]):g==="S"&&(d=f==="s",n=e[u-1],n[0]==="C"?(t=n[3]-o,r=n[4]-c):n[0]==="c"?(t=n[3]-n[5],r=n[4]-n[6]):(t=0,r=0),i=-t,s=-r,d||(i+=o,s+=c),e[u]=[d?"c":"C",i,s,a[1],a[2],a[3],a[4]]))}),this};var _n=S,wn=_n,Mn=ve(wn);function ze(e){return[e[0],e[1]]}function k(e,t){return[e,t]}var Pn=function(t){t=t||{};var r=typeof t.recursion=="number"?t.recursion:8,n=typeof t.epsilon=="number"?t.epsilon:11920929e-14,i=typeof t.pathEpsilon=="number"?t.pathEpsilon:1,s=typeof t.angleEpsilon=="number"?t.angleEpsilon:.01,a=t.angleTolerance||0,u=t.cuspLimit||0;return function(g,d,v,m,p,y){y||(y=[]),p=typeof p=="number"?p:1;var M=i/p;return M*=M,o(g,d,v,m,y,M),y};function o(f,g,d,v,m,p){m.push(ze(f));var y=f[0],M=f[1],h=g[0],l=g[1],x=d[0],E=d[1],b=v[0],N=v[1];c(y,M,h,l,x,E,b,N,m,p,0),m.push(ze(v))}function c(f,g,d,v,m,p,y,M,h,l,x){if(!(x>r)){var E=Math.PI,b=(f+d)/2,N=(g+v)/2,_=(d+m)/2,P=(v+p)/2,w=(m+y)/2,T=(p+M)/2,X=(b+_)/2,A=(N+P)/2,I=(_+w)/2,q=(P+T)/2,Y=(X+I)/2,B=(A+q)/2;if(x>0){var $=y-f,F=M-g,G=Math.abs((d-y)*F-(v-M)*$),R=Math.abs((m-y)*F-(p-M)*$),C,D;if(G>n&&R>n){if((G+R)*(G+R)<=l*($*$+F*F)){if(a<s){h.push(k(Y,B));return}var tt=Math.atan2(p-v,m-d);if(C=Math.abs(tt-Math.atan2(v-g,d-f)),D=Math.abs(Math.atan2(M-p,y-m)-tt),C>=E&&(C=2*E-C),D>=E&&(D=2*E-D),C+D<a){h.push(k(Y,B));return}if(u!==0){if(C>u){h.push(k(d,v));return}if(D>u){h.push(k(m,p));return}}}}else if(G>n){if(G*G<=l*($*$+F*F)){if(a<s){h.push(k(Y,B));return}if(C=Math.abs(Math.atan2(p-v,m-d)-Math.atan2(v-g,d-f)),C>=E&&(C=2*E-C),C<a){h.push(k(d,v)),h.push(k(m,p));return}if(u!==0&&C>u){h.push(k(d,v));return}}}else if(R>n){if(R*R<=l*($*$+F*F)){if(a<s){h.push(k(Y,B));return}if(C=Math.abs(Math.atan2(M-p,y-m)-Math.atan2(p-v,m-d)),C>=E&&(C=2*E-C),C<a){h.push(k(d,v)),h.push(k(m,p));return}if(u!==0&&C>u){h.push(k(m,p));return}}}else if($=Y-(f+y)/2,F=B-(g+M)/2,$*$+F*F<=l){h.push(k(Y,B));return}}c(f,g,b,N,X,A,Y,B,h,l,x+1),c(Y,B,I,q,w,T,y,M,h,l,x+1)}}},Tn=ve(Pn);const An=Tn({recursion:8,pathEpsilon:.1});function Cn(e,t){const{grid:r,marginX:n,marginY:i}=t;if(r.enabled){const s=r.totalWidth,a=r.totalHeight,{pathList:u,pathBounds:o}=Ze(e,{...t,width:s,height:a,marginX:0,marginY:0}),c=t.width-n*2,f=t.height-i*2,g=Math.ceil(s/c),d=Math.ceil(a/f),v=In(u,{cellWidth:c,cellHeight:f,cols:g,rows:d,marginX:n,marginY:i});o.minX+=n,o.maxX+=n,o.minY+=i,o.maxY+=i;const m={minX:n,maxX:n+s,minY:i,maxY:i+a},{includeCorners:p,cornerLength:y}=r,M=[[{x:n,y:i+y},{x:n,y:i},{x:n+y,y:i}],[{x:t.width-n-y,y:i},{x:t.width-n,y:i},{x:t.width-n,y:i+y}],[{x:t.width-n,y:t.height-i-y},{x:t.width-n,y:t.height-i},{x:t.width-n-y,y:t.height-i}],[{x:n+y,y:t.height-i},{x:n,y:t.height-i},{x:n,y:t.height-i-y}]];return{pathGrid:v.map((h,l)=>{const x=Math.floor(l%g),E=Math.floor(l/g),b=x*c,N=E*f,_=Ue(o,b,N,t),P=Ue(m,b,N,t);return p&&h.unshift(...M),{pathList:h,pathBounds:_,gridBounds:P}}),cols:g,rows:d}}else return{pathGrid:[Ze(e,t)],cols:1,rows:1}}function Xn(e,t){const{parentWidth:r,parentHeight:n,rotation:i}=t;let s=[];return e.forEach(a=>{const u=On(a);if(u){const o=Mn.from(u).unarc().unshort().abs().iterate((v,m,p,y)=>{switch(v[0]){case"H":return[["L",v[1],y]];case"V":return[["L",p,v[1]]];case"Q":{const[h,l,x,E]=v.slice(1),b=p+2*(h-p)/3,N=y+2*(l-y)/3,_=x+2*(h-x)/3,P=E+2*(l-E)/3;return[["C",b,N,_,P,x,E]]}default:return[v]}}).transform(a.transform);i!==0&&o.rotate(i,r*.5,n*.5);const c=[];let f=[],g=null,d=null;o.iterate((v,m,p,y)=>{const M=v[0];switch(M){case"M":{f.length>0&&c.push(f),f=[v[1],v[2]],g=[v[1],v[2]];break}case"L":{f.push(v[1],v[2]);break}case"C":{const[h,l,x,E,b,N]=v.slice(1),_=An([p,y],[h,l],[x,E],[b,N]).flat();d==="M"?f=[..._]:f.push(..._);break}case"Z":{g&&f.push(g[0],g[1]);break}default:console.warn("Encountered unknown command during path parsing:",M)}d=M}),f.length>0&&c.push(f),c.forEach(v=>{const m=[];for(let p=0;p<v.length;p+=2)m.push({x:v[p],y:v[p+1]});s.push(m)})}}),s}function Ue(e,t,r,n){const i={minX:t+n.marginX,maxX:t+n.width-n.marginX,minY:r+n.marginY,maxY:r+n.height-n.marginY};return e.minX>=i.minX&&e.minX<=i.maxX&&(i.minX=e.minX),e.maxX>=i.minX&&e.maxX<=i.maxX&&(i.maxX=e.maxX),e.minY>=i.minY&&e.minY<=i.maxY&&(i.minY=e.minY),e.maxY>=i.minY&&e.maxY<=i.maxY&&(i.maxY=e.maxY),i.minX-=t,i.maxX-=t,i.minY-=r,i.maxY-=r,i}function Ze(e,t){const r=structuredClone(e),{parentWidth:n,parentHeight:i,width:s,height:a,marginX:u,marginY:o,alignment:c,rotation:f,useBoundingBox:g}=t,d={minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0};r.forEach(b=>{b.forEach(N=>{d.minX=Math.min(N.x,d.minX),d.maxX=Math.max(N.x,d.maxX),d.minY=Math.min(N.y,d.minY),d.maxY=Math.max(N.y,d.maxY)})});let v=0,m=0,p=0,y=0;if(g)v=d.maxX-d.minX,m=d.maxY-d.minY,p=-d.minX,y=-d.minY;else{const b=f*Math.PI/180,N=Math.abs(Math.sin(b)),_=Math.abs(Math.cos(b));v=n*_+i*N,m=n*N+i*_,p=(v-n)*.5,y=(m-i)*.5}if(v===0||m===0)throw new Error("Could not determine SVG dimensions");const M=s-u*2,h=a-o*2,l=Math.min(M/v,h/m),x=(M-v*l)*.5*c,E=(h-m*l)*.5*c;return r.forEach(b=>{b.forEach(N=>{N.x=(N.x+p)*l+x+u,N.y=(N.y+y)*l+E+o})}),d.minX=(d.minX+p)*l+x+u,d.minY=(d.minY+y)*l+E+o,d.maxX=(d.maxX+p)*l+x+u,d.maxY=(d.maxY+y)*l+E+o,{pathList:r,pathBounds:d}}function In(e,t){const{cellWidth:r,cellHeight:n,cols:i,rows:s,marginX:a,marginY:u}=t,o=r*i,c=n*s;let f=structuredClone(e),g=[];for(let d=0;d<s;d++)for(let v=0;v<i;v++){let m=[],p=[],y=f.shift();const M=v*r,h=d*n,l=M+r,x=h+n,E={minX:M,minY:h,maxX:l,maxY:x};for(;y;){let b=!1,N=0,_=null;y.forEach((w,T)=>{if(w.x<0||w.x>o||w.y<0||w.y>c)throw new Error(`Invalid point found during path division: ${w.x}, ${w.y}`);const X=w.x>=M&&w.x<l&&w.y>=h&&w.y<x;if(X!==b){if(T>0){let A,I;X?(A=w,I=y[T-1]):(A=y[T-1],I=w);const q=Sn(A,I,E),Y=y.slice(N,T).concat(q);_&&Y.unshift(_),X?p.push(Y):m.push(Y),_={...q}}b=X,N=T}});const P=y.slice(N);_&&P.unshift(_),b?m.push(P):p.push(P),y=f.shift()}m.forEach(b=>{b.forEach(N=>{N.x=N.x-M+a,N.y=N.y-h+u})}),g.push(m),f=p}return g}function Sn(e,t,r){const{minX:n,minY:i,maxX:s,maxY:a}=r,{x:u,y:o}=e,{x:c,y:f}=t,g=c-u,d=f-o;let v=0,m=1,p,y,M;for(let h=0;h<4;h++){if(h===0&&(p=-g,y=-(n-u)),h===1&&(p=g,y=s-u),h===2&&(p=-d,y=-(i-o)),h===3&&(p=d,y=a-o),M=y/p,p===0&&y<0)return null;if(p<0){if(M>m)return null;M>v&&(v=M)}else if(p>0){if(M<v)return null;M<m&&(m=M)}}return{x:u+m*g,y:o+m*d}}function On(e){switch(e.tag){case"path":return e.d;case"rect":return Yn(e);case"circle":return $n(e);case"ellipse":return Ln(e);case"line":return Bn(e);case"polygon":return kn(e);case"polyline":return Fn(e);default:return null}}function fe(e,t){return t.map(r=>Number(e[r]))}function K(e){return e.join(" ")}function Yn(e){const[t,r,n,i,s,a]=fe(e,["x","y","width","height","rx","ry"]);if(s||a){let u=s||a,o=a||s;return u*2>n&&(u-=(u*2-n)/2),o*2>i&&(o-=(o*2-i)/2),K(["M",t+u,r,"h",n-u*2,"s",u,0,u,o,"v",i-o*2,"s",0,o,-u,o,"h",-n+u*2,"s",-u,0,-u,-o,"v",-i+o*2,"s",0,-o,u,-o])}else return K(["M",t,r,"h",n,"v",i,"H",t,"Z"])}function $n(e){const[t,r,n]=fe(e,["cx","cy","r"]);return K(["M",t-n,r,"a",n,n,0,1,0,2*n,0,"a",n,n,0,1,0,-2*n,0])}function Ln(e){const[t,r,n,i]=fe(e,["cx","cy","rx","ry"]);return K(["M",t-n,r,"a",n,i,0,1,0,2*n,0,"a",n,i,0,1,0,-2*n,0])}function Bn(e){const[t,r,n,i]=fe(e,["x1","x2","y1","y2"]);return K(["M",t,n,"L",r,i])}function kn(e){return Je(e).concat("Z")}function Fn(e){return Je(e)}function Je(e){const{points:t=""}=e,r=t.trim().split(/[ ,]+/),n=[];for(let i=0;i<r.length;i+=2)n.push(i===0?"M":"L",[Number(r[i]),Number(r[i+1])]);return K(n)}const Rn=["svg","g","a"],Vn=["rect","circle","ellipse","path","line","polyline","polygon"],qn=new Xr.XMLParser({ignoreDeclaration:!0,ignoreAttributes:!1,attributeNamePrefix:""});function Gn(e,t){const{width:r,height:n,marginX:i,marginY:s,grid:a,alignment:u,rotation:o,useBoundingBox:c,postProcessing:f}=t,{svg:g}=qn.parse(e);if(!g)throw new Error("Root SVG node not found");const{viewBox:d,translation:v}=De(g),m=Qe(g,v),p=d.width,y=d.height,M={parentWidth:p,parentHeight:y,width:r,height:n,marginX:i,marginY:s,grid:a,alignment:u,rotation:o,useBoundingBox:c},h=Xn(m,M),{pathGrid:l,cols:x,rows:E}=Cn(h,M);return l.forEach(b=>{f.merge&&(b.pathList=qe(b.pathList,f.mergeTolerance)),f.filterShort&&(b.pathList=Ge(b.pathList,f.filterShortLength)),f.reorder&&(b.pathList=Re(b.pathList)),f.randomizeStart&&(b.pathList=Wn(b.pathList,f.randomizeStartTolerance))}),{pathGrid:l,cols:x,rows:E}}function Qe(e,t=""){const r=we(e.style)??{},n=se(r.transform,e.transform);return Ke(e,r)?[]:Object.entries(e).reduce((i,[s,a])=>{const u=Rn.includes(s),o=Vn.includes(s);if(u||o){const c=Array.isArray(a)?a:[a];if(u){let f="";if(e.tag==="svg"){const{translation:g}=De(e);f=se(t,g,n)}else f=se(t,n);c.forEach(g=>{i.push(...Qe(g,f))})}else c.forEach(f=>{const g=we(f.style)??{},d=se(g.transform,f.transform),v=se(t,n,d);Ke(f,g)||i.push({...f,tag:s,transform:v})})}return i},[])}function se(...e){return e.filter(Boolean).join(" ")}function Ke(e,t){return e.display==="none"||e.visibility==="hidden"||t.display==="none"||t.visibility==="hidden"}function De(e){let t=0,r=0,n=NaN,i=NaN,s="";if(!e.viewBox)e.width&&e.height&&(n=Number(e.width.match(/\d*/)),i=Number(e.height.match(/\d*/)));else{const a=e.viewBox.split(" ").map(u=>Number(u));t=a[0],r=a[1],n=a[2],i=a[3]}if(isNaN(n)||isNaN(i))throw new Error("Could not determine view box dimensions.");return(t!==0||r!==0)&&!isNaN(t)&&!isNaN(r)&&(s=`translate(${t}, ${r})`),{viewBox:{minX:t,minY:r,width:n,height:i},translation:s}}function Wn(e,t){return e.map(r=>{const n=r.length;if(jn(r[0].x,r[0].y,r[n-1].x,r[n-1].y)<t){let s=Math.floor(Math.random()*n);if(s%2!==0&&s++,s>0&&s<n-1){const a=r[s];return r.slice(s).concat(r.slice(0,s)).concat(a)}}return r})}function jn(e,t,r,n){return Math.hypot(e-r,t-n)}const Hn="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let zn=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=Hn[r[e]&63];return t};function Un(e,t){const{pathList:r,pathBounds:n,gridBounds:i}=e,{width:s,height:a,marginX:u,marginY:o}=t;let c="",f="",g="",d="",v={x:0,y:a};r.length>0&&(r.forEach(p=>{f+=` M${v.x},${v.y} L${p[0].x},${p[0].y}`,c+=` M${p[0].x},${p[0].y}`;for(let y=1;y<p.length;y++)c+=` L${p[y].x},${p[y].y}`;v.x=p[p.length-1].x,v.y=p[p.length-1].y}),c=c.trim(),f=f.trim()),(u!==0||o!==0)&&(d=[`M${u},${o}`,`L${s-u},${o}`,`L${s-u},${a-o}`,`L${u},${a-o}`,`L${u},${o}`].join(" "));const m=et(n);return i&&(g=et(i)),{downPath:c,upPath:f,marginsPath:d,pathBoundsPath:m,gridBoundsPath:g,width:s,height:a,id:zn()}}function et(e){const{minX:t,minY:r,maxX:n,maxY:i}=e;return[`M${t},${r}`,`L${n},${r}`,`L${n},${i}`,`L${t},${i}`,`L${t},${r}`].join(" ")}onmessage=e=>{try{const{svg:t,options:r}=JSON.parse(e.data),{pathGrid:n,cols:i,rows:s}=Gn(t,r);postMessage(JSON.stringify({isError:!1,result:{pathGrid:n,previews:n.map(a=>Un(a,r)),options:r,cols:i,rows:s}}))}catch(t){let r="Unknown error";t instanceof Error?r=t.message:typeof t=="string"&&(r=t),console.error(t),postMessage(JSON.stringify({isError:!0,errorMessage:r}))}}})();
