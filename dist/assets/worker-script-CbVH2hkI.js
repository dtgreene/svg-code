(function(){"use strict";var W=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ve(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function et(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}),r}var xe={},be=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,tt=/\n/g,rt=/^\s*/,nt=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,it=/^:\s*/,st=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,ot=/^[;\s]*/,at=/^\s+|\s+$/g,ut=`
`,Ne="/",ye="*",H="",ft="comment",ht="declaration",ct=function(e,t){if(typeof e!="string")throw new TypeError("First argument must be a string");if(!e)return[];t=t||{};var r=1,n=1;function s(v){var g=v.match(tt);g&&(r+=g.length);var N=v.lastIndexOf(ut);n=~N?v.length-N:n+v.length}function i(){var v={line:r,column:n};return function(g){return g.position=new a(v),h(),g}}function a(v){this.start=v,this.end={line:r,column:n},this.source=t.source}a.prototype.content=e;function u(v){var g=new Error(t.source+":"+r+":"+n+": "+v);if(g.reason=v,g.filename=t.source,g.line=r,g.column=n,g.source=e,!t.silent)throw g}function o(v){var g=v.exec(e);if(g){var N=g[0];return s(N),e=e.slice(N.length),g}}function h(){o(rt)}function c(v){var g;for(v=v||[];g=p();)g!==!1&&v.push(g);return v}function p(){var v=i();if(!(Ne!=e.charAt(0)||ye!=e.charAt(1))){for(var g=2;H!=e.charAt(g)&&(ye!=e.charAt(g)||Ne!=e.charAt(g+1));)++g;if(g+=2,H===e.charAt(g-1))return u("End of comment missing");var N=e.slice(2,g-2);return n+=2,s(N),e=e.slice(g),n+=2,v({type:ft,comment:N})}}function d(){var v=i(),g=o(nt);if(g){if(p(),!o(it))return u("property missing ':'");var N=o(st),w=v({type:ht,property:Ee(g[0].replace(be,H)),value:N?Ee(N[0].replace(be,H)):H});return o(ot),w}}function x(){var v=[];c(v);for(var g;g=d();)g!==!1&&(v.push(g),c(v));return v}return h(),x()};function Ee(e){return e?e.replace(at,H):H}var lt=W&&W.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(xe,"__esModule",{value:!0});var _e=xe.default=pt,dt=lt(ct);function pt(e,t){var r=null;if(!e||typeof e!="string")return r;var n=(0,dt.default)(e),s=typeof t=="function";return n.forEach(function(i){if(i.type==="declaration"){var a=i.property,u=i.value;s?t(a,u,i):u&&(r=r||{},r[a]=u)}}),r}var we=_e.default||_e,ce={},oe={};(function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",r=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",n="["+t+"]["+r+"]*",s=new RegExp("^"+n+"$"),i=function(u,o){const h=[];let c=o.exec(u);for(;c;){const p=[];p.startIndex=o.lastIndex-c[0].length;const d=c.length;for(let x=0;x<d;x++)p.push(c[x]);h.push(p),c=o.exec(u)}return h},a=function(u){const o=s.exec(u);return!(o===null||typeof o>"u")};e.isExist=function(u){return typeof u<"u"},e.isEmptyObject=function(u){return Object.keys(u).length===0},e.merge=function(u,o,h){if(o){const c=Object.keys(o),p=c.length;for(let d=0;d<p;d++)h==="strict"?u[c[d]]=[o[c[d]]]:u[c[d]]=o[c[d]]}},e.getValue=function(u){return e.isExist(u)?u:""},e.isName=a,e.getAllMatches=i,e.nameRegexp=n})(oe);const le=oe,gt={allowBooleanAttributes:!1,unpairedTags:[]};ce.validate=function(e,t){t=Object.assign({},gt,t);const r=[];let n=!1,s=!1;e[0]==="\uFEFF"&&(e=e.substr(1));for(let i=0;i<e.length;i++)if(e[i]==="<"&&e[i+1]==="?"){if(i+=2,i=Pe(e,i),i.err)return i}else if(e[i]==="<"){let a=i;if(i++,e[i]==="!"){i=Te(e,i);continue}else{let u=!1;e[i]==="/"&&(u=!0,i++);let o="";for(;i<e.length&&e[i]!==">"&&e[i]!==" "&&e[i]!=="	"&&e[i]!==`
`&&e[i]!=="\r";i++)o+=e[i];if(o=o.trim(),o[o.length-1]==="/"&&(o=o.substring(0,o.length-1),i--),!_t(o)){let p;return o.trim().length===0?p="Invalid space after '<'.":p="Tag '"+o+"' is an invalid name.",X("InvalidTag",p,B(e,i))}const h=xt(e,i);if(h===!1)return X("InvalidAttr","Attributes for '"+o+"' have open quote.",B(e,i));let c=h.value;if(i=h.index,c[c.length-1]==="/"){const p=i-c.length;c=c.substring(0,c.length-1);const d=Ae(c,t);if(d===!0)n=!0;else return X(d.err.code,d.err.msg,B(e,p+d.err.line))}else if(u)if(h.tagClosed){if(c.trim().length>0)return X("InvalidTag","Closing tag '"+o+"' can't have attributes or invalid starting.",B(e,a));if(r.length===0)return X("InvalidTag","Closing tag '"+o+"' has not been opened.",B(e,a));{const p=r.pop();if(o!==p.tagName){let d=B(e,p.tagStartPos);return X("InvalidTag","Expected closing tag '"+p.tagName+"' (opened in line "+d.line+", col "+d.col+") instead of closing tag '"+o+"'.",B(e,a))}r.length==0&&(s=!0)}}else return X("InvalidTag","Closing tag '"+o+"' doesn't have proper closing.",B(e,i));else{const p=Ae(c,t);if(p!==!0)return X(p.err.code,p.err.msg,B(e,i-c.length+p.err.line));if(s===!0)return X("InvalidXml","Multiple possible root nodes found.",B(e,i));t.unpairedTags.indexOf(o)!==-1||r.push({tagName:o,tagStartPos:a}),n=!0}for(i++;i<e.length;i++)if(e[i]==="<")if(e[i+1]==="!"){i++,i=Te(e,i);continue}else if(e[i+1]==="?"){if(i=Pe(e,++i),i.err)return i}else break;else if(e[i]==="&"){const p=yt(e,i);if(p==-1)return X("InvalidChar","char '&' is not expected.",B(e,i));i=p}else if(s===!0&&!Me(e[i]))return X("InvalidXml","Extra text at the end",B(e,i));e[i]==="<"&&i--}}else{if(Me(e[i]))continue;return X("InvalidChar","char '"+e[i]+"' is not expected.",B(e,i))}if(n){if(r.length==1)return X("InvalidTag","Unclosed tag '"+r[0].tagName+"'.",B(e,r[0].tagStartPos));if(r.length>0)return X("InvalidXml","Invalid '"+JSON.stringify(r.map(i=>i.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return X("InvalidXml","Start tag expected.",1);return!0};function Me(e){return e===" "||e==="	"||e===`
`||e==="\r"}function Pe(e,t){const r=t;for(;t<e.length;t++)if(e[t]=="?"||e[t]==" "){const n=e.substr(r,t-r);if(t>5&&n==="xml")return X("InvalidXml","XML declaration allowed only at the start of the document.",B(e,t));if(e[t]=="?"&&e[t+1]==">"){t++;break}else continue}return t}function Te(e,t){if(e.length>t+5&&e[t+1]==="-"&&e[t+2]==="-"){for(t+=3;t<e.length;t++)if(e[t]==="-"&&e[t+1]==="-"&&e[t+2]===">"){t+=2;break}}else if(e.length>t+8&&e[t+1]==="D"&&e[t+2]==="O"&&e[t+3]==="C"&&e[t+4]==="T"&&e[t+5]==="Y"&&e[t+6]==="P"&&e[t+7]==="E"){let r=1;for(t+=8;t<e.length;t++)if(e[t]==="<")r++;else if(e[t]===">"&&(r--,r===0))break}else if(e.length>t+9&&e[t+1]==="["&&e[t+2]==="C"&&e[t+3]==="D"&&e[t+4]==="A"&&e[t+5]==="T"&&e[t+6]==="A"&&e[t+7]==="["){for(t+=8;t<e.length;t++)if(e[t]==="]"&&e[t+1]==="]"&&e[t+2]===">"){t+=2;break}}return t}const mt='"',vt="'";function xt(e,t){let r="",n="",s=!1;for(;t<e.length;t++){if(e[t]===mt||e[t]===vt)n===""?n=e[t]:n!==e[t]||(n="");else if(e[t]===">"&&n===""){s=!0;break}r+=e[t]}return n!==""?!1:{value:r,index:t,tagClosed:s}}const bt=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function Ae(e,t){const r=le.getAllMatches(e,bt),n={};for(let s=0;s<r.length;s++){if(r[s][1].length===0)return X("InvalidAttr","Attribute '"+r[s][2]+"' has no space in starting.",ee(r[s]));if(r[s][3]!==void 0&&r[s][4]===void 0)return X("InvalidAttr","Attribute '"+r[s][2]+"' is without value.",ee(r[s]));if(r[s][3]===void 0&&!t.allowBooleanAttributes)return X("InvalidAttr","boolean attribute '"+r[s][2]+"' is not allowed.",ee(r[s]));const i=r[s][2];if(!Et(i))return X("InvalidAttr","Attribute '"+i+"' is an invalid name.",ee(r[s]));if(!n.hasOwnProperty(i))n[i]=1;else return X("InvalidAttr","Attribute '"+i+"' is repeated.",ee(r[s]))}return!0}function Nt(e,t){let r=/\d/;for(e[t]==="x"&&(t++,r=/[\da-fA-F]/);t<e.length;t++){if(e[t]===";")return t;if(!e[t].match(r))break}return-1}function yt(e,t){if(t++,e[t]===";")return-1;if(e[t]==="#")return t++,Nt(e,t);let r=0;for(;t<e.length;t++,r++)if(!(e[t].match(/\w/)&&r<20)){if(e[t]===";")break;return-1}return t}function X(e,t,r){return{err:{code:e,msg:t,line:r.line||r,col:r.col}}}function Et(e){return le.isName(e)}function _t(e){return le.isName(e)}function B(e,t){const r=e.substring(0,t).split(/\r?\n/);return{line:r.length,col:r[r.length-1].length+1}}function ee(e){return e.startIndex+e[1].length}var de={};const Ce={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,r){return e}},wt=function(e){return Object.assign({},Ce,e)};de.buildOptions=wt,de.defaultOptions=Ce;class Mt{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,r){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:r})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}var Pt=Mt;const Tt=oe;function At(e,t){const r={};if(e[t+3]==="O"&&e[t+4]==="C"&&e[t+5]==="T"&&e[t+6]==="Y"&&e[t+7]==="P"&&e[t+8]==="E"){t=t+9;let n=1,s=!1,i=!1,a="";for(;t<e.length;t++)if(e[t]==="<"&&!i){if(s&&It(e,t))t+=7,[entityName,val,t]=Ct(e,t+1),val.indexOf("&")===-1&&(r[$t(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(s&&St(e,t))t+=8;else if(s&&Xt(e,t))t+=8;else if(s&&Yt(e,t))t+=9;else if(Ot)i=!0;else throw new Error("Invalid DOCTYPE");n++,a=""}else if(e[t]===">"){if(i?e[t-1]==="-"&&e[t-2]==="-"&&(i=!1,n--):n--,n===0)break}else e[t]==="["?s=!0:a+=e[t];if(n!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:r,i:t}}function Ct(e,t){let r="";for(;t<e.length&&e[t]!=="'"&&e[t]!=='"';t++)r+=e[t];if(r=r.trim(),r.indexOf(" ")!==-1)throw new Error("External entites are not supported");const n=e[t++];let s="";for(;t<e.length&&e[t]!==n;t++)s+=e[t];return[r,s,t]}function Ot(e,t){return e[t+1]==="!"&&e[t+2]==="-"&&e[t+3]==="-"}function It(e,t){return e[t+1]==="!"&&e[t+2]==="E"&&e[t+3]==="N"&&e[t+4]==="T"&&e[t+5]==="I"&&e[t+6]==="T"&&e[t+7]==="Y"}function St(e,t){return e[t+1]==="!"&&e[t+2]==="E"&&e[t+3]==="L"&&e[t+4]==="E"&&e[t+5]==="M"&&e[t+6]==="E"&&e[t+7]==="N"&&e[t+8]==="T"}function Xt(e,t){return e[t+1]==="!"&&e[t+2]==="A"&&e[t+3]==="T"&&e[t+4]==="T"&&e[t+5]==="L"&&e[t+6]==="I"&&e[t+7]==="S"&&e[t+8]==="T"}function Yt(e,t){return e[t+1]==="!"&&e[t+2]==="N"&&e[t+3]==="O"&&e[t+4]==="T"&&e[t+5]==="A"&&e[t+6]==="T"&&e[t+7]==="I"&&e[t+8]==="O"&&e[t+9]==="N"}function $t(e){if(Tt.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}var Lt=At;const Bt=/^[-+]?0x[a-fA-F0-9]+$/,kt=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const Ft={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function Rt(e,t={}){if(t=Object.assign({},Ft,t),!e||typeof e!="string")return e;let r=e.trim();if(t.skipLike!==void 0&&t.skipLike.test(r))return e;if(t.hex&&Bt.test(r))return Number.parseInt(r,16);{const n=kt.exec(r);if(n){const s=n[1],i=n[2];let a=Vt(n[3]);const u=n[4]||n[6];if(!t.leadingZeros&&i.length>0&&s&&r[2]!==".")return e;if(!t.leadingZeros&&i.length>0&&!s&&r[1]!==".")return e;{const o=Number(r),h=""+o;return h.search(/[eE]/)!==-1||u?t.eNotation?o:e:r.indexOf(".")!==-1?h==="0"&&a===""||h===a||s&&h==="-"+a?o:e:i?a===h||s+a===h?o:e:r===h||r===s+h?o:e}}else return e}}function Vt(e){return e&&e.indexOf(".")!==-1&&(e=e.replace(/0+$/,""),e==="."?e="0":e[0]==="."?e="0"+e:e[e.length-1]==="."&&(e=e.substr(0,e.length-1))),e}var qt=Rt;function Gt(e){return typeof e=="function"?e:Array.isArray(e)?t=>{for(const r of e)if(typeof r=="string"&&t===r||r instanceof RegExp&&r.test(t))return!0}:()=>!1}var Oe=Gt;const Ie=oe,te=Pt,jt=Lt,zt=qt,Ut=Oe;let Wt=class{constructor(t){this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(r,n)=>String.fromCharCode(Number.parseInt(n,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(r,n)=>String.fromCharCode(Number.parseInt(n,16))}},this.addExternalEntities=Ht,this.parseXml=Dt,this.parseTextData=Zt,this.resolveNameSpace=Jt,this.buildAttributesMap=Kt,this.isItStopNode=nr,this.replaceEntitiesValue=tr,this.readStopNodeData=sr,this.saveTextToParentTag=rr,this.addChild=er,this.ignoreAttributesFn=Ut(this.options.ignoreAttributes)}};function Ht(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];this.lastEntities[n]={regex:new RegExp("&"+n+";","g"),val:e[n]}}}function Zt(e,t,r,n,s,i,a){if(e!==void 0&&(this.options.trimValues&&!n&&(e=e.trim()),e.length>0)){a||(e=this.replaceEntitiesValue(e));const u=this.options.tagValueProcessor(t,e,r,s,i);return u==null?e:typeof u!=typeof e||u!==e?u:this.options.trimValues?ge(e,this.options.parseTagValue,this.options.numberParseOptions):e.trim()===e?ge(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function Jt(e){if(this.options.removeNSPrefix){const t=e.split(":"),r=e.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(e=r+t[1])}return e}const Qt=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function Kt(e,t,r){if(this.options.ignoreAttributes!==!0&&typeof e=="string"){const n=Ie.getAllMatches(e,Qt),s=n.length,i={};for(let a=0;a<s;a++){const u=this.resolveNameSpace(n[a][1]);if(this.ignoreAttributesFn(u,t))continue;let o=n[a][4],h=this.options.attributeNamePrefix+u;if(u.length)if(this.options.transformAttributeName&&(h=this.options.transformAttributeName(h)),h==="__proto__"&&(h="#__proto__"),o!==void 0){this.options.trimValues&&(o=o.trim()),o=this.replaceEntitiesValue(o);const c=this.options.attributeValueProcessor(u,o,t);c==null?i[h]=o:typeof c!=typeof o||c!==o?i[h]=c:i[h]=ge(o,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[h]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){const a={};return a[this.options.attributesGroupName]=i,a}return i}}const Dt=function(e){e=e.replace(/\r\n?/g,`
`);const t=new te("!xml");let r=t,n="",s="";for(let i=0;i<e.length;i++)if(e[i]==="<")if(e[i+1]==="/"){const u=Z(e,">",i,"Closing Tag is not closed.");let o=e.substring(i+2,u).trim();if(this.options.removeNSPrefix){const p=o.indexOf(":");p!==-1&&(o=o.substr(p+1))}this.options.transformTagName&&(o=this.options.transformTagName(o)),r&&(n=this.saveTextToParentTag(n,r,s));const h=s.substring(s.lastIndexOf(".")+1);if(o&&this.options.unpairedTags.indexOf(o)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${o}>`);let c=0;h&&this.options.unpairedTags.indexOf(h)!==-1?(c=s.lastIndexOf(".",s.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=s.lastIndexOf("."),s=s.substring(0,c),r=this.tagsNodeStack.pop(),n="",i=u}else if(e[i+1]==="?"){let u=pe(e,i,!1,"?>");if(!u)throw new Error("Pi Tag is not closed.");if(n=this.saveTextToParentTag(n,r,s),!(this.options.ignoreDeclaration&&u.tagName==="?xml"||this.options.ignorePiTags)){const o=new te(u.tagName);o.add(this.options.textNodeName,""),u.tagName!==u.tagExp&&u.attrExpPresent&&(o[":@"]=this.buildAttributesMap(u.tagExp,s,u.tagName)),this.addChild(r,o,s)}i=u.closeIndex+1}else if(e.substr(i+1,3)==="!--"){const u=Z(e,"-->",i+4,"Comment is not closed.");if(this.options.commentPropName){const o=e.substring(i+4,u-2);n=this.saveTextToParentTag(n,r,s),r.add(this.options.commentPropName,[{[this.options.textNodeName]:o}])}i=u}else if(e.substr(i+1,2)==="!D"){const u=jt(e,i);this.docTypeEntities=u.entities,i=u.i}else if(e.substr(i+1,2)==="!["){const u=Z(e,"]]>",i,"CDATA is not closed.")-2,o=e.substring(i+9,u);n=this.saveTextToParentTag(n,r,s);let h=this.parseTextData(o,r.tagname,s,!0,!1,!0,!0);h==null&&(h=""),this.options.cdataPropName?r.add(this.options.cdataPropName,[{[this.options.textNodeName]:o}]):r.add(this.options.textNodeName,h),i=u+2}else{let u=pe(e,i,this.options.removeNSPrefix),o=u.tagName;const h=u.rawTagName;let c=u.tagExp,p=u.attrExpPresent,d=u.closeIndex;this.options.transformTagName&&(o=this.options.transformTagName(o)),r&&n&&r.tagname!=="!xml"&&(n=this.saveTextToParentTag(n,r,s,!1));const x=r;if(x&&this.options.unpairedTags.indexOf(x.tagname)!==-1&&(r=this.tagsNodeStack.pop(),s=s.substring(0,s.lastIndexOf("."))),o!==t.tagname&&(s+=s?"."+o:o),this.isItStopNode(this.options.stopNodes,s,o)){let v="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)o[o.length-1]==="/"?(o=o.substr(0,o.length-1),s=s.substr(0,s.length-1),c=o):c=c.substr(0,c.length-1),i=u.closeIndex;else if(this.options.unpairedTags.indexOf(o)!==-1)i=u.closeIndex;else{const N=this.readStopNodeData(e,h,d+1);if(!N)throw new Error(`Unexpected end of ${h}`);i=N.i,v=N.tagContent}const g=new te(o);o!==c&&p&&(g[":@"]=this.buildAttributesMap(c,s,o)),v&&(v=this.parseTextData(v,o,s,!0,p,!0,!0)),s=s.substr(0,s.lastIndexOf(".")),g.add(this.options.textNodeName,v),this.addChild(r,g,s)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){o[o.length-1]==="/"?(o=o.substr(0,o.length-1),s=s.substr(0,s.length-1),c=o):c=c.substr(0,c.length-1),this.options.transformTagName&&(o=this.options.transformTagName(o));const v=new te(o);o!==c&&p&&(v[":@"]=this.buildAttributesMap(c,s,o)),this.addChild(r,v,s),s=s.substr(0,s.lastIndexOf("."))}else{const v=new te(o);this.tagsNodeStack.push(r),o!==c&&p&&(v[":@"]=this.buildAttributesMap(c,s,o)),this.addChild(r,v,s),r=v}n="",i=d}}else n+=e[i];return t.child};function er(e,t,r){const n=this.options.updateTag(t.tagname,r,t[":@"]);n===!1||(typeof n=="string"&&(t.tagname=n),e.addChild(t))}const tr=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const r=this.docTypeEntities[t];e=e.replace(r.regx,r.val)}for(let t in this.lastEntities){const r=this.lastEntities[t];e=e.replace(r.regex,r.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const r=this.htmlEntities[t];e=e.replace(r.regex,r.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function rr(e,t,r,n){return e&&(n===void 0&&(n=Object.keys(t.child).length===0),e=this.parseTextData(e,t.tagname,r,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,n),e!==void 0&&e!==""&&t.add(this.options.textNodeName,e),e=""),e}function nr(e,t,r){const n="*."+r;for(const s in e){const i=e[s];if(n===i||t===i)return!0}return!1}function ir(e,t,r=">"){let n,s="";for(let i=t;i<e.length;i++){let a=e[i];if(n)a===n&&(n="");else if(a==='"'||a==="'")n=a;else if(a===r[0])if(r[1]){if(e[i+1]===r[1])return{data:s,index:i}}else return{data:s,index:i};else a==="	"&&(a=" ");s+=a}}function Z(e,t,r,n){const s=e.indexOf(t,r);if(s===-1)throw new Error(n);return s+t.length-1}function pe(e,t,r,n=">"){const s=ir(e,t+1,n);if(!s)return;let i=s.data;const a=s.index,u=i.search(/\s/);let o=i,h=!0;u!==-1&&(o=i.substring(0,u),i=i.substring(u+1).trimStart());const c=o;if(r){const p=o.indexOf(":");p!==-1&&(o=o.substr(p+1),h=o!==s.data.substr(p+1))}return{tagName:o,tagExp:i,closeIndex:a,attrExpPresent:h,rawTagName:c}}function sr(e,t,r){const n=r;let s=1;for(;r<e.length;r++)if(e[r]==="<")if(e[r+1]==="/"){const i=Z(e,">",r,`${t} is not closed`);if(e.substring(r+2,i).trim()===t&&(s--,s===0))return{tagContent:e.substring(n,r),i};r=i}else if(e[r+1]==="?")r=Z(e,"?>",r+1,"StopNode is not closed.");else if(e.substr(r+1,3)==="!--")r=Z(e,"-->",r+3,"StopNode is not closed.");else if(e.substr(r+1,2)==="![")r=Z(e,"]]>",r,"StopNode is not closed.")-2;else{const i=pe(e,r,">");i&&((i&&i.tagName)===t&&i.tagExp[i.tagExp.length-1]!=="/"&&s++,r=i.closeIndex)}}function ge(e,t,r){if(t&&typeof e=="string"){const n=e.trim();return n==="true"?!0:n==="false"?!1:zt(e,r)}else return Ie.isExist(e)?e:""}var or=Wt,Se={};function ar(e,t){return Xe(e,t)}function Xe(e,t,r){let n;const s={};for(let i=0;i<e.length;i++){const a=e[i],u=ur(a);let o="";if(r===void 0?o=u:o=r+"."+u,u===t.textNodeName)n===void 0?n=a[u]:n+=""+a[u];else{if(u===void 0)continue;if(a[u]){let h=Xe(a[u],t,o);const c=hr(h,t);a[":@"]?fr(h,a[":@"],o,t):Object.keys(h).length===1&&h[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?h=h[t.textNodeName]:Object.keys(h).length===0&&(t.alwaysCreateTextNode?h[t.textNodeName]="":h=""),s[u]!==void 0&&s.hasOwnProperty(u)?(Array.isArray(s[u])||(s[u]=[s[u]]),s[u].push(h)):t.isArray(u,o,c)?s[u]=[h]:s[u]=h}}}return typeof n=="string"?n.length>0&&(s[t.textNodeName]=n):n!==void 0&&(s[t.textNodeName]=n),s}function ur(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];if(n!==":@")return n}}function fr(e,t,r,n){if(t){const s=Object.keys(t),i=s.length;for(let a=0;a<i;a++){const u=s[a];n.isArray(u,r+"."+u,!0,!0)?e[u]=[t[u]]:e[u]=t[u]}}}function hr(e,t){const{textNodeName:r}=t,n=Object.keys(e).length;return!!(n===0||n===1&&(e[r]||typeof e[r]=="boolean"||e[r]===0))}Se.prettify=ar;const{buildOptions:cr}=de,lr=or,{prettify:dr}=Se,pr=ce;var gr=class{constructor(t){this.externalEntities={},this.options=cr(t)}parse(t,r){if(typeof t!="string")if(t.toString)t=t.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(r){r===!0&&(r={});const i=pr.validate(t,r);if(i!==!0)throw Error(`${i.err.msg}:${i.err.line}:${i.err.col}`)}const n=new lr(this.options);n.addExternalEntities(this.externalEntities);const s=n.parseXml(t);return this.options.preserveOrder||s===void 0?s:dr(s,this.options)}addEntity(t,r){if(r.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(t.indexOf("&")!==-1||t.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(r==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[t]=r}};const mr=`
`;function vr(e,t){let r="";return t.format&&t.indentBy.length>0&&(r=mr),Ye(e,t,"",r)}function Ye(e,t,r,n){let s="",i=!1;for(let a=0;a<e.length;a++){const u=e[a],o=xr(u);if(o===void 0)continue;let h="";if(r.length===0?h=o:h=`${r}.${o}`,o===t.textNodeName){let v=u[o];br(h,t)||(v=t.tagValueProcessor(o,v),v=Le(v,t)),i&&(s+=n),s+=v,i=!1;continue}else if(o===t.cdataPropName){i&&(s+=n),s+=`<![CDATA[${u[o][0][t.textNodeName]}]]>`,i=!1;continue}else if(o===t.commentPropName){s+=n+`<!--${u[o][0][t.textNodeName]}-->`,i=!0;continue}else if(o[0]==="?"){const v=$e(u[":@"],t),g=o==="?xml"?"":n;let N=u[o][0][t.textNodeName];N=N.length!==0?" "+N:"",s+=g+`<${o}${N}${v}?>`,i=!0;continue}let c=n;c!==""&&(c+=t.indentBy);const p=$e(u[":@"],t),d=n+`<${o}${p}`,x=Ye(u[o],t,h,c);t.unpairedTags.indexOf(o)!==-1?t.suppressUnpairedNode?s+=d+">":s+=d+"/>":(!x||x.length===0)&&t.suppressEmptyNode?s+=d+"/>":x&&x.endsWith(">")?s+=d+`>${x}${n}</${o}>`:(s+=d+">",x&&n!==""&&(x.includes("/>")||x.includes("</"))?s+=n+t.indentBy+x+n:s+=x,s+=`</${o}>`),i=!0}return s}function xr(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];if(e.hasOwnProperty(n)&&n!==":@")return n}}function $e(e,t){let r="";if(e&&!t.ignoreAttributes)for(let n in e){if(!e.hasOwnProperty(n))continue;let s=t.attributeValueProcessor(n,e[n]);s=Le(s,t),s===!0&&t.suppressBooleanAttributes?r+=` ${n.substr(t.attributeNamePrefix.length)}`:r+=` ${n.substr(t.attributeNamePrefix.length)}="${s}"`}return r}function br(e,t){e=e.substr(0,e.length-t.textNodeName.length-1);let r=e.substr(e.lastIndexOf(".")+1);for(let n in t.stopNodes)if(t.stopNodes[n]===e||t.stopNodes[n]==="*."+r)return!0;return!1}function Le(e,t){if(e&&e.length>0&&t.processEntities)for(let r=0;r<t.entities.length;r++){const n=t.entities[r];e=e.replace(n.regex,n.val)}return e}var Nr=vr;const yr=Nr,Er=Oe,_r={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function j(e){this.options=Object.assign({},_r,e),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=Er(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=Pr),this.processTextOrObjNode=wr,this.options.format?(this.indentate=Mr,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}j.prototype.build=function(e){return this.options.preserveOrder?yr(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0,[]).val)},j.prototype.j2x=function(e,t,r){let n="",s="";const i=r.join(".");for(let a in e)if(Object.prototype.hasOwnProperty.call(e,a))if(typeof e[a]>"u")this.isAttribute(a)&&(s+="");else if(e[a]===null)this.isAttribute(a)?s+="":a[0]==="?"?s+=this.indentate(t)+"<"+a+"?"+this.tagEndChar:s+=this.indentate(t)+"<"+a+"/"+this.tagEndChar;else if(e[a]instanceof Date)s+=this.buildTextValNode(e[a],a,"",t);else if(typeof e[a]!="object"){const u=this.isAttribute(a);if(u&&!this.ignoreAttributesFn(u,i))n+=this.buildAttrPairStr(u,""+e[a]);else if(!u)if(a===this.options.textNodeName){let o=this.options.tagValueProcessor(a,""+e[a]);s+=this.replaceEntitiesValue(o)}else s+=this.buildTextValNode(e[a],a,"",t)}else if(Array.isArray(e[a])){const u=e[a].length;let o="",h="";for(let c=0;c<u;c++){const p=e[a][c];if(!(typeof p>"u"))if(p===null)a[0]==="?"?s+=this.indentate(t)+"<"+a+"?"+this.tagEndChar:s+=this.indentate(t)+"<"+a+"/"+this.tagEndChar;else if(typeof p=="object")if(this.options.oneListGroup){const d=this.j2x(p,t+1,r.concat(a));o+=d.val,this.options.attributesGroupName&&p.hasOwnProperty(this.options.attributesGroupName)&&(h+=d.attrStr)}else o+=this.processTextOrObjNode(p,a,t,r);else if(this.options.oneListGroup){let d=this.options.tagValueProcessor(a,p);d=this.replaceEntitiesValue(d),o+=d}else o+=this.buildTextValNode(p,a,"",t)}this.options.oneListGroup&&(o=this.buildObjectNode(o,a,h,t)),s+=o}else if(this.options.attributesGroupName&&a===this.options.attributesGroupName){const u=Object.keys(e[a]),o=u.length;for(let h=0;h<o;h++)n+=this.buildAttrPairStr(u[h],""+e[a][u[h]])}else s+=this.processTextOrObjNode(e[a],a,t,r);return{attrStr:n,val:s}},j.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&t==="true"?" "+e:" "+e+'="'+t+'"'};function wr(e,t,r,n){const s=this.j2x(e,r+1,n.concat(t));return e[this.options.textNodeName]!==void 0&&Object.keys(e).length===1?this.buildTextValNode(e[this.options.textNodeName],t,s.attrStr,r):this.buildObjectNode(s.val,t,s.attrStr,r)}j.prototype.buildObjectNode=function(e,t,r,n){if(e==="")return t[0]==="?"?this.indentate(n)+"<"+t+r+"?"+this.tagEndChar:this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar;{let s="</"+t+this.tagEndChar,i="";return t[0]==="?"&&(i="?",s=""),(r||r==="")&&e.indexOf("<")===-1?this.indentate(n)+"<"+t+r+i+">"+e+s:this.options.commentPropName!==!1&&t===this.options.commentPropName&&i.length===0?this.indentate(n)+`<!--${e}-->`+this.newLine:this.indentate(n)+"<"+t+r+i+this.tagEndChar+e+this.indentate(n)+s}},j.prototype.closeTag=function(e){let t="";return this.options.unpairedTags.indexOf(e)!==-1?this.options.suppressUnpairedNode||(t="/"):this.options.suppressEmptyNode?t="/":t=`></${e}`,t},j.prototype.buildTextValNode=function(e,t,r,n){if(this.options.cdataPropName!==!1&&t===this.options.cdataPropName)return this.indentate(n)+`<![CDATA[${e}]]>`+this.newLine;if(this.options.commentPropName!==!1&&t===this.options.commentPropName)return this.indentate(n)+`<!--${e}-->`+this.newLine;if(t[0]==="?")return this.indentate(n)+"<"+t+r+"?"+this.tagEndChar;{let s=this.options.tagValueProcessor(t,e);return s=this.replaceEntitiesValue(s),s===""?this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar:this.indentate(n)+"<"+t+r+">"+s+"</"+t+this.tagEndChar}},j.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const r=this.options.entities[t];e=e.replace(r.regex,r.val)}return e};function Mr(e){return this.options.indentBy.repeat(e)}function Pr(e){return e.startsWith(this.options.attributeNamePrefix)&&e!==this.options.textNodeName?e.substr(this.attrPrefixLen):!1}var Tr=j,Ar={XMLParser:gr,XMLValidator:ce,XMLBuilder:Tr},J={},z={};Object.defineProperty(z,"__esModule",{value:!0}),z.vsub=z.vlen=z.vlen2=void 0;function Be(e){return e.x*e.x+e.y*e.y}z.vlen2=Be;function Cr(e){return Math.sqrt(Be(e))}z.vlen=Cr;function Or(e,t){return{x:e.x-t.x,y:e.y-t.y}}z.vsub=Or;var ae={};class Ir{constructor(t=[],r=Sr){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:n}=this,s=r[t];for(;t>0;){const i=t-1>>1,a=r[i];if(n(s,a)>=0)break;r[t]=a,t=i}r[t]=s}_down(t){const{data:r,compare:n}=this,s=this.length>>1,i=r[t];for(;t<s;){let a=(t<<1)+1,u=r[a];const o=a+1;if(o<this.length&&n(r[o],u)<0&&(a=o,u=r[o]),n(u,i)>=0)break;r[t]=u,t=a}r[t]=i}}function Sr(e,t){return e<t?-1:e>t?1:0}var Xr=Object.freeze({__proto__:null,default:Ir}),Yr=et(Xr),$r=W&&W.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ae,"__esModule",{value:!0}),ae.knn=void 0;const Lr=$r(Yr);function Br(e,t,r,n,s,i){let a=e.data,u=[],o=e.toBBox,h,c,p,d,x=new Lr.default(void 0,kr);for(;a;){for(h=0;h<a.children.length;h++)c=a.children[h],p=Fr(t,r,a.leaf?o(c):c),(!i||p<=i*i)&&x.push({node:c,isItem:a.leaf,dist:p});for(;x.length&&x.peek().isItem;)if(d=x.pop().node,(!s||s(d))&&u.push(d),n&&u.length===n)return u;a=x.pop(),a&&(a=a.node)}return u}ae.knn=Br;function kr(e,t){return e.dist-t.dist}function Fr(e,t,r){var n=ke(e,r.minX,r.maxX),s=ke(t,r.minY,r.maxY);return n*n+s*s}function ke(e,t,r){return e<t?t-e:e<=r?0:e-r}var Fe={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(W,function(){function r(f,l,m,y,E){(function b(_,M,T,P,C){for(;P>T;){if(P-T>600){var A=P-T+1,I=M-T+1,R=Math.log(A),Y=.5*Math.exp(2*R/3),$=.5*Math.sqrt(R*Y*(A-Y)/A)*(I-A/2<0?-1:1),L=Math.max(T,Math.floor(M-I*Y/A+$)),F=Math.min(P,Math.floor(M+(A-I)*Y/A+$));b(_,M,L,F,C)}var G=_[M],V=T,O=P;for(n(_,T,M),C(_[P],G)>0&&n(_,T,P);V<O;){for(n(_,V,O),V++,O--;C(_[V],G)<0;)V++;for(;C(_[O],G)>0;)O--}C(_[T],G)===0?n(_,T,O):n(_,++O,P),O<=M&&(T=O+1),M<=O&&(P=O-1)}})(f,l,m||0,y||f.length-1,E||s)}function n(f,l,m){var y=f[l];f[l]=f[m],f[m]=y}function s(f,l){return f<l?-1:f>l?1:0}var i=function(f){f===void 0&&(f=9),this._maxEntries=Math.max(4,f),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function a(f,l,m){if(!m)return l.indexOf(f);for(var y=0;y<l.length;y++)if(m(f,l[y]))return y;return-1}function u(f,l){o(f,0,f.children.length,l,f)}function o(f,l,m,y,E){E||(E=N(null)),E.minX=1/0,E.minY=1/0,E.maxX=-1/0,E.maxY=-1/0;for(var b=l;b<m;b++){var _=f.children[b];h(E,f.leaf?y(_):_)}return E}function h(f,l){return f.minX=Math.min(f.minX,l.minX),f.minY=Math.min(f.minY,l.minY),f.maxX=Math.max(f.maxX,l.maxX),f.maxY=Math.max(f.maxY,l.maxY),f}function c(f,l){return f.minX-l.minX}function p(f,l){return f.minY-l.minY}function d(f){return(f.maxX-f.minX)*(f.maxY-f.minY)}function x(f){return f.maxX-f.minX+(f.maxY-f.minY)}function v(f,l){return f.minX<=l.minX&&f.minY<=l.minY&&l.maxX<=f.maxX&&l.maxY<=f.maxY}function g(f,l){return l.minX<=f.maxX&&l.minY<=f.maxY&&l.maxX>=f.minX&&l.maxY>=f.minY}function N(f){return{children:f,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function w(f,l,m,y,E){for(var b=[l,m];b.length;)if(!((m=b.pop())-(l=b.pop())<=y)){var _=l+Math.ceil((m-l)/y/2)*y;r(f,_,l,m,E),b.push(l,_,_,m)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(f){var l=this.data,m=[];if(!g(f,l))return m;for(var y=this.toBBox,E=[];l;){for(var b=0;b<l.children.length;b++){var _=l.children[b],M=l.leaf?y(_):_;g(f,M)&&(l.leaf?m.push(_):v(f,M)?this._all(_,m):E.push(_))}l=E.pop()}return m},i.prototype.collides=function(f){var l=this.data;if(!g(f,l))return!1;for(var m=[];l;){for(var y=0;y<l.children.length;y++){var E=l.children[y],b=l.leaf?this.toBBox(E):E;if(g(f,b)){if(l.leaf||v(f,b))return!0;m.push(E)}}l=m.pop()}return!1},i.prototype.load=function(f){if(!f||!f.length)return this;if(f.length<this._minEntries){for(var l=0;l<f.length;l++)this.insert(f[l]);return this}var m=this._build(f.slice(),0,f.length-1,0);if(this.data.children.length)if(this.data.height===m.height)this._splitRoot(this.data,m);else{if(this.data.height<m.height){var y=this.data;this.data=m,m=y}this._insert(m,this.data.height-m.height-1,!0)}else this.data=m;return this},i.prototype.insert=function(f){return f&&this._insert(f,this.data.height-1),this},i.prototype.clear=function(){return this.data=N([]),this},i.prototype.remove=function(f,l){if(!f)return this;for(var m,y,E,b=this.data,_=this.toBBox(f),M=[],T=[];b||M.length;){if(b||(b=M.pop(),y=M[M.length-1],m=T.pop(),E=!0),b.leaf){var P=a(f,b.children,l);if(P!==-1)return b.children.splice(P,1),M.push(b),this._condense(M),this}E||b.leaf||!v(b,_)?y?(m++,b=y.children[m],E=!1):b=null:(M.push(b),T.push(m),m=0,y=b,b=b.children[0])}return this},i.prototype.toBBox=function(f){return f},i.prototype.compareMinX=function(f,l){return f.minX-l.minX},i.prototype.compareMinY=function(f,l){return f.minY-l.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(f){return this.data=f,this},i.prototype._all=function(f,l){for(var m=[];f;)f.leaf?l.push.apply(l,f.children):m.push.apply(m,f.children),f=m.pop();return l},i.prototype._build=function(f,l,m,y){var E,b=m-l+1,_=this._maxEntries;if(b<=_)return u(E=N(f.slice(l,m+1)),this.toBBox),E;y||(y=Math.ceil(Math.log(b)/Math.log(_)),_=Math.ceil(b/Math.pow(_,y-1))),(E=N([])).leaf=!1,E.height=y;var M=Math.ceil(b/_),T=M*Math.ceil(Math.sqrt(_));w(f,l,m,T,this.compareMinX);for(var P=l;P<=m;P+=T){var C=Math.min(P+T-1,m);w(f,P,C,M,this.compareMinY);for(var A=P;A<=C;A+=M){var I=Math.min(A+M-1,C);E.children.push(this._build(f,A,I,y-1))}}return u(E,this.toBBox),E},i.prototype._chooseSubtree=function(f,l,m,y){for(;y.push(l),!l.leaf&&y.length-1!==m;){for(var E=1/0,b=1/0,_=void 0,M=0;M<l.children.length;M++){var T=l.children[M],P=d(T),C=(A=f,I=T,(Math.max(I.maxX,A.maxX)-Math.min(I.minX,A.minX))*(Math.max(I.maxY,A.maxY)-Math.min(I.minY,A.minY))-P);C<b?(b=C,E=P<E?P:E,_=T):C===b&&P<E&&(E=P,_=T)}l=_||l.children[0]}var A,I;return l},i.prototype._insert=function(f,l,m){var y=m?f:this.toBBox(f),E=[],b=this._chooseSubtree(y,this.data,l,E);for(b.children.push(f),h(b,y);l>=0&&E[l].children.length>this._maxEntries;)this._split(E,l),l--;this._adjustParentBBoxes(y,E,l)},i.prototype._split=function(f,l){var m=f[l],y=m.children.length,E=this._minEntries;this._chooseSplitAxis(m,E,y);var b=this._chooseSplitIndex(m,E,y),_=N(m.children.splice(b,m.children.length-b));_.height=m.height,_.leaf=m.leaf,u(m,this.toBBox),u(_,this.toBBox),l?f[l-1].children.push(_):this._splitRoot(m,_)},i.prototype._splitRoot=function(f,l){this.data=N([f,l]),this.data.height=f.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(f,l,m){for(var y,E,b,_,M,T,P,C=1/0,A=1/0,I=l;I<=m-l;I++){var R=o(f,0,I,this.toBBox),Y=o(f,I,m,this.toBBox),$=(E=R,b=Y,_=void 0,M=void 0,T=void 0,P=void 0,_=Math.max(E.minX,b.minX),M=Math.max(E.minY,b.minY),T=Math.min(E.maxX,b.maxX),P=Math.min(E.maxY,b.maxY),Math.max(0,T-_)*Math.max(0,P-M)),L=d(R)+d(Y);$<C?(C=$,y=I,A=L<A?L:A):$===C&&L<A&&(A=L,y=I)}return y||m-l},i.prototype._chooseSplitAxis=function(f,l,m){var y=f.leaf?this.compareMinX:c,E=f.leaf?this.compareMinY:p;this._allDistMargin(f,l,m,y)<this._allDistMargin(f,l,m,E)&&f.children.sort(y)},i.prototype._allDistMargin=function(f,l,m,y){f.children.sort(y);for(var E=this.toBBox,b=o(f,0,l,E),_=o(f,m-l,m,E),M=x(b)+x(_),T=l;T<m-l;T++){var P=f.children[T];h(b,f.leaf?E(P):P),M+=x(b)}for(var C=m-l-1;C>=l;C--){var A=f.children[C];h(_,f.leaf?E(A):A),M+=x(_)}return M},i.prototype._adjustParentBBoxes=function(f,l,m){for(var y=m;y>=0;y--)h(l[y],f)},i.prototype._condense=function(f){for(var l=f.length-1,m=void 0;l>=0;l--)f[l].children.length===0?l>0?(m=f[l-1].children).splice(m.indexOf(f[l]),1):this.clear():u(f[l],this.toBBox)},i})})(Fe);var Rr=Fe.exports,Vr=W&&W.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(J,"__esModule",{value:!0});var Re=J.reorder=Ge=J.elideShorterThan=qe=J.merge=void 0;const Ve=z,qr=ae,Gr=Vr(Rr);function jr(e,t){return e.slice(e.findIndex(r=>!t(r)))}function zr(e,t=.5){if(e.length===0)return[];const r=t*t,n=e.slice(),s=[n.shift()];for(;n.length;){const i=s[s.length-1],a=n.shift(),u=i[i.length-1],o=a[0],h=u.x-o.x,c=u.y-o.y;h*h+c*c<=r?s[s.length-1]=s[s.length-1].concat(jr(a,d=>{const x=u.x-d.x,v=u.y-d.y;return x*x+v*v<=r})):s.push(a)}return s}var qe=J.merge=zr;function Ur(e){if(e.length<=1)return 0;let t=0,r=e[0];for(let n=1;n<e.length;n++)t+=Ve.vlen(Ve.vsub(r,e[n])),r=e[n];return t}function Wr(e,t){return e.filter(r=>Ur(r)>=t)}var Ge=J.elideShorterThan=Wr;function*Hr(e,t){for(let r=e;r<t;r++)yield r}function Zr(e){if(e.length===0)return e;const t=u=>u%2===0?e[u/2|0][0]:e[u/2|0][e[u/2|0].length-1];class r extends Gr.default{toBBox(o){const{x:h,y:c}=t(o);return{minX:h,minY:c,maxX:h,maxY:c}}compareMinX(o,h){return t(o).x-t(h).x}compareMinY(o,h){return t(o).y-t(h).y}}const n=new r;n.load([...Hr(2,e.length*2)]);const s=[];s.push(e[0]);let i=t(1),a=e.length*2-2;for(;a;){const[u]=qr.knn(n,i.x,i.y,1),o=u/2|0;n.remove(o*2),n.remove(o*2+1),s.push(u%2===0?e[o]:e[o].slice().reverse()),i=t(u%2===0?u+1:u-1),a-=2}return s}Re=J.reorder=Zr;var ue={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},Jr=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279];function Qr(e){return e===10||e===13||e===8232||e===8233||e===32||e===9||e===11||e===12||e===160||e>=5760&&Jr.indexOf(e)>=0}function Kr(e){switch(e|32){case 109:case 122:case 108:case 104:case 118:case 99:case 115:case 113:case 116:case 97:case 114:return!0}return!1}function Dr(e){return(e|32)===97}function Q(e){return e>=48&&e<=57}function en(e){return e>=48&&e<=57||e===43||e===45||e===46}function tn(e){this.index=0,this.path=e,this.max=e.length,this.result=[],this.param=0,this.err="",this.segmentStart=0,this.data=[]}function fe(e){for(;e.index<e.max&&Qr(e.path.charCodeAt(e.index));)e.index++}function rn(e){var t=e.path.charCodeAt(e.index);if(t===48){e.param=0,e.index++;return}if(t===49){e.param=1,e.index++;return}e.err="SvgPath: arc flag can be 0 or 1 only (at pos "+e.index+")"}function nn(e){var t=e.index,r=t,n=e.max,s=!1,i=!1,a=!1,u=!1,o;if(r>=n){e.err="SvgPath: missed param (at pos "+r+")";return}if(o=e.path.charCodeAt(r),(o===43||o===45)&&(r++,o=r<n?e.path.charCodeAt(r):0),!Q(o)&&o!==46){e.err="SvgPath: param should start with 0..9 or `.` (at pos "+r+")";return}if(o!==46){if(s=o===48,r++,o=r<n?e.path.charCodeAt(r):0,s&&r<n&&o&&Q(o)){e.err="SvgPath: numbers started with `0` such as `09` are illegal (at pos "+t+")";return}for(;r<n&&Q(e.path.charCodeAt(r));)r++,i=!0;o=r<n?e.path.charCodeAt(r):0}if(o===46){for(u=!0,r++;Q(e.path.charCodeAt(r));)r++,a=!0;o=r<n?e.path.charCodeAt(r):0}if(o===101||o===69){if(u&&!i&&!a){e.err="SvgPath: invalid float exponent (at pos "+r+")";return}if(r++,o=r<n?e.path.charCodeAt(r):0,(o===43||o===45)&&r++,r<n&&Q(e.path.charCodeAt(r)))for(;r<n&&Q(e.path.charCodeAt(r));)r++;else{e.err="SvgPath: invalid float exponent (at pos "+r+")";return}}e.index=r,e.param=parseFloat(e.path.slice(t,r))+0}function me(e){var t,r;t=e.path[e.segmentStart],r=t.toLowerCase();var n=e.data;if(r==="m"&&n.length>2&&(e.result.push([t,n[0],n[1]]),n=n.slice(2),r="l",t=t==="m"?"l":"L"),r==="r")e.result.push([t].concat(n));else for(;n.length>=ue[r]&&(e.result.push([t].concat(n.splice(0,ue[r]))),!!ue[r]););}function sn(e){var t=e.max,r,n,s,i,a;if(e.segmentStart=e.index,r=e.path.charCodeAt(e.index),n=Dr(r),!Kr(r)){e.err="SvgPath: bad command "+e.path[e.index]+" (at pos "+e.index+")";return}if(i=ue[e.path[e.index].toLowerCase()],e.index++,fe(e),e.data=[],!i){me(e);return}for(s=!1;;){for(a=i;a>0;a--){if(n&&(a===3||a===4)?rn(e):nn(e),e.err.length){me(e);return}e.data.push(e.param),fe(e),s=!1,e.index<t&&e.path.charCodeAt(e.index)===44&&(e.index++,fe(e),s=!0)}if(!s&&(e.index>=e.max||!en(e.path.charCodeAt(e.index))))break}me(e)}var on=function(t){var r=new tn(t),n=r.max;for(fe(r);r.index<n&&!r.err.length;)sn(r);return r.result.length&&("mM".indexOf(r.result[0][0])<0?(r.err="SvgPath: string should start with `M` or `m`",r.result=[]):r.result[0][0]="M"),{err:r.err,segments:r.result}};function an(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}function q(){if(!(this instanceof q))return new q;this.queue=[],this.cache=null}q.prototype.matrix=function(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===1&&e[4]===0&&e[5]===0?this:(this.cache=null,this.queue.push(e),this)},q.prototype.translate=function(e,t){return(e!==0||t!==0)&&(this.cache=null,this.queue.push([1,0,0,1,e,t])),this},q.prototype.scale=function(e,t){return(e!==1||t!==1)&&(this.cache=null,this.queue.push([e,0,0,t,0,0])),this},q.prototype.rotate=function(e,t,r){var n,s,i;return e!==0&&(this.translate(t,r),n=e*Math.PI/180,s=Math.cos(n),i=Math.sin(n),this.queue.push([s,i,-i,s,0,0]),this.cache=null,this.translate(-t,-r)),this},q.prototype.skewX=function(e){return e!==0&&(this.cache=null,this.queue.push([1,0,Math.tan(e*Math.PI/180),1,0,0])),this},q.prototype.skewY=function(e){return e!==0&&(this.cache=null,this.queue.push([1,Math.tan(e*Math.PI/180),0,1,0,0])),this},q.prototype.toArray=function(){if(this.cache)return this.cache;if(!this.queue.length)return this.cache=[1,0,0,1,0,0],this.cache;if(this.cache=this.queue[0],this.queue.length===1)return this.cache;for(var e=1;e<this.queue.length;e++)this.cache=an(this.cache,this.queue[e]);return this.cache},q.prototype.calc=function(e,t,r){var n;return this.queue.length?(this.cache||(this.cache=this.toArray()),n=this.cache,[e*n[0]+t*n[2]+(r?0:n[4]),e*n[1]+t*n[3]+(r?0:n[5])]):[e,t]};var je=q,un=je,fn={matrix:!0,scale:!0,rotate:!0,translate:!0,skewX:!0,skewY:!0},hn=/\s*(matrix|translate|scale|rotate|skewX|skewY)\s*\(\s*(.+?)\s*\)[\s,]*/,cn=/[\s,]+/,ln=function(t){var r=new un,n,s;return t.split(hn).forEach(function(i){if(i.length){if(typeof fn[i]<"u"){n=i;return}switch(s=i.split(cn).map(function(a){return+a||0}),n){case"matrix":s.length===6&&r.matrix(s);return;case"scale":s.length===1?r.scale(s[0],s[0]):s.length===2&&r.scale(s[0],s[1]);return;case"rotate":s.length===1?r.rotate(s[0],0,0):s.length===3&&r.rotate(s[0],s[1],s[2]);return;case"translate":s.length===1?r.translate(s[0],0):s.length===2&&r.translate(s[0],s[1]);return;case"skewX":s.length===1&&r.skewX(s[0]);return;case"skewY":s.length===1&&r.skewY(s[0]);return}}}),r},re=Math.PI*2;function ze(e,t,r,n){var s=e*n-t*r<0?-1:1,i=e*r+t*n;return i>1&&(i=1),i<-1&&(i=-1),s*Math.acos(i)}function dn(e,t,r,n,s,i,a,u,o,h){var c=h*(e-r)/2+o*(t-n)/2,p=-o*(e-r)/2+h*(t-n)/2,d=a*a,x=u*u,v=c*c,g=p*p,N=d*x-d*g-x*v;N<0&&(N=0),N/=d*g+x*v,N=Math.sqrt(N)*(s===i?-1:1);var w=N*a/u*p,f=N*-u/a*c,l=h*w-o*f+(e+r)/2,m=o*w+h*f+(t+n)/2,y=(c-w)/a,E=(p-f)/u,b=(-c-w)/a,_=(-p-f)/u,M=ze(1,0,y,E),T=ze(y,E,b,_);return i===0&&T>0&&(T-=re),i===1&&T<0&&(T+=re),[l,m,M,T]}function pn(e,t){var r=1.3333333333333333*Math.tan(t/4),n=Math.cos(e),s=Math.sin(e),i=Math.cos(e+t),a=Math.sin(e+t);return[n,s,n-s*r,s+n*r,i+a*r,a-i*r,i,a]}var gn=function(t,r,n,s,i,a,u,o,h){var c=Math.sin(h*re/360),p=Math.cos(h*re/360),d=p*(t-n)/2+c*(r-s)/2,x=-c*(t-n)/2+p*(r-s)/2;if(d===0&&x===0)return[];if(u===0||o===0)return[];u=Math.abs(u),o=Math.abs(o);var v=d*d/(u*u)+x*x/(o*o);v>1&&(u*=Math.sqrt(v),o*=Math.sqrt(v));var g=dn(t,r,n,s,i,a,u,o,c,p),N=[],w=g[2],f=g[3],l=Math.max(Math.ceil(Math.abs(f)/(re/4)),1);f/=l;for(var m=0;m<l;m++)N.push(pn(w,f)),w+=f;return N.map(function(y){for(var E=0;E<y.length;E+=2){var b=y[E+0],_=y[E+1];b*=u,_*=o;var M=p*b-c*_,T=c*b+p*_;y[E+0]=M+g[0],y[E+1]=T+g[1]}return y})},ne=1e-10,Ue=Math.PI/180;function ie(e,t,r){if(!(this instanceof ie))return new ie(e,t,r);this.rx=e,this.ry=t,this.ax=r}ie.prototype.transform=function(e){var t=Math.cos(this.ax*Ue),r=Math.sin(this.ax*Ue),n=[this.rx*(e[0]*t+e[2]*r),this.rx*(e[1]*t+e[3]*r),this.ry*(-e[0]*r+e[2]*t),this.ry*(-e[1]*r+e[3]*t)],s=n[0]*n[0]+n[2]*n[2],i=n[1]*n[1]+n[3]*n[3],a=((n[0]-n[3])*(n[0]-n[3])+(n[2]+n[1])*(n[2]+n[1]))*((n[0]+n[3])*(n[0]+n[3])+(n[2]-n[1])*(n[2]-n[1])),u=(s+i)/2;if(a<ne*u)return this.rx=this.ry=Math.sqrt(u),this.ax=0,this;var o=n[0]*n[1]+n[2]*n[3];a=Math.sqrt(a);var h=u+a/2,c=u-a/2;return this.ax=Math.abs(o)<ne&&Math.abs(h-i)<ne?90:Math.atan(Math.abs(o)>Math.abs(h-i)?(h-s)/o:o/(h-i))*180/Math.PI,this.ax>=0?(this.rx=Math.sqrt(h),this.ry=Math.sqrt(c)):(this.ax+=90,this.rx=Math.sqrt(c),this.ry=Math.sqrt(h)),this},ie.prototype.isDegenerate=function(){return this.rx<ne*this.ry||this.ry<ne*this.rx};var mn=ie,vn=on,xn=ln,U=je,bn=gn,Nn=mn;function S(e){if(!(this instanceof S))return new S(e);var t=vn(e);this.segments=t.segments,this.err=t.err,this.__stack=[]}S.from=function(e){if(typeof e=="string")return new S(e);if(e instanceof S){var t=new S("");return t.err=e.err,t.segments=e.segments.map(function(r){return r.slice()}),t.__stack=e.__stack.map(function(r){return U().matrix(r.toArray())}),t}throw new Error("SvgPath.from: invalid param type "+e)},S.prototype.__matrix=function(e){var t=this,r;e.queue.length&&this.iterate(function(n,s,i,a){var u,o,h,c;switch(n[0]){case"v":u=e.calc(0,n[1],!0),o=u[0]===0?["v",u[1]]:["l",u[0],u[1]];break;case"V":u=e.calc(i,n[1],!1),o=u[0]===e.calc(i,a,!1)[0]?["V",u[1]]:["L",u[0],u[1]];break;case"h":u=e.calc(n[1],0,!0),o=u[1]===0?["h",u[0]]:["l",u[0],u[1]];break;case"H":u=e.calc(n[1],a,!1),o=u[1]===e.calc(i,a,!1)[1]?["H",u[0]]:["L",u[0],u[1]];break;case"a":case"A":var p=e.toArray(),d=Nn(n[1],n[2],n[3]).transform(p);if(p[0]*p[3]-p[1]*p[2]<0&&(n[5]=n[5]?"0":"1"),u=e.calc(n[6],n[7],n[0]==="a"),n[0]==="A"&&n[6]===i&&n[7]===a||n[0]==="a"&&n[6]===0&&n[7]===0){o=[n[0]==="a"?"l":"L",u[0],u[1]];break}d.isDegenerate()?o=[n[0]==="a"?"l":"L",u[0],u[1]]:o=[n[0],d.rx,d.ry,d.ax,n[4],n[5],u[0],u[1]];break;case"m":c=s>0,u=e.calc(n[1],n[2],c),o=["m",u[0],u[1]];break;default:for(h=n[0],o=[h],c=h.toLowerCase()===h,r=1;r<n.length;r+=2)u=e.calc(n[r],n[r+1],c),o.push(u[0],u[1])}t.segments[s]=o},!0)},S.prototype.__evaluateStack=function(){var e,t;if(this.__stack.length){if(this.__stack.length===1){this.__matrix(this.__stack[0]),this.__stack=[];return}for(e=U(),t=this.__stack.length;--t>=0;)e.matrix(this.__stack[t].toArray());this.__matrix(e),this.__stack=[]}},S.prototype.toString=function(){var e="",t="",r=!1;this.__evaluateStack();for(var n=0,s=this.segments.length;n<s;n++){var i=this.segments[n],a=i[0];a!==t||a==="m"||a==="M"?(a==="m"&&t==="z"&&(e+=" "),e+=a,r=!1):r=!0;for(var u=1;u<i.length;u++){var o=i[u];u===1?r&&o>=0&&(e+=" "):o>=0&&(e+=" "),e+=o}t=a}return e},S.prototype.translate=function(e,t){return this.__stack.push(U().translate(e,t||0)),this},S.prototype.scale=function(e,t){return this.__stack.push(U().scale(e,!t&&t!==0?e:t)),this},S.prototype.rotate=function(e,t,r){return this.__stack.push(U().rotate(e,t||0,r||0)),this},S.prototype.skewX=function(e){return this.__stack.push(U().skewX(e)),this},S.prototype.skewY=function(e){return this.__stack.push(U().skewY(e)),this},S.prototype.matrix=function(e){return this.__stack.push(U().matrix(e)),this},S.prototype.transform=function(e){return e.trim()?(this.__stack.push(xn(e)),this):this},S.prototype.round=function(e){var t=0,r=0,n=0,s=0,i;return e=e||0,this.__evaluateStack(),this.segments.forEach(function(a){var u=a[0].toLowerCase()===a[0];switch(a[0]){case"H":case"h":u&&(a[1]+=n),n=a[1]-a[1].toFixed(e),a[1]=+a[1].toFixed(e);return;case"V":case"v":u&&(a[1]+=s),s=a[1]-a[1].toFixed(e),a[1]=+a[1].toFixed(e);return;case"Z":case"z":n=t,s=r;return;case"M":case"m":u&&(a[1]+=n,a[2]+=s),n=a[1]-a[1].toFixed(e),s=a[2]-a[2].toFixed(e),t=n,r=s,a[1]=+a[1].toFixed(e),a[2]=+a[2].toFixed(e);return;case"A":case"a":u&&(a[6]+=n,a[7]+=s),n=a[6]-a[6].toFixed(e),s=a[7]-a[7].toFixed(e),a[1]=+a[1].toFixed(e),a[2]=+a[2].toFixed(e),a[3]=+a[3].toFixed(e+2),a[6]=+a[6].toFixed(e),a[7]=+a[7].toFixed(e);return;default:i=a.length,u&&(a[i-2]+=n,a[i-1]+=s),n=a[i-2]-a[i-2].toFixed(e),s=a[i-1]-a[i-1].toFixed(e),a.forEach(function(o,h){h&&(a[h]=+a[h].toFixed(e))});return}}),this},S.prototype.iterate=function(e,t){var r=this.segments,n={},s=!1,i=0,a=0,u=0,o=0,h,c,p;if(t||this.__evaluateStack(),r.forEach(function(d,x){var v=e(d,x,i,a);Array.isArray(v)&&(n[x]=v,s=!0);var g=d[0]===d[0].toLowerCase();switch(d[0]){case"m":case"M":i=d[1]+(g?i:0),a=d[2]+(g?a:0),u=i,o=a;return;case"h":case"H":i=d[1]+(g?i:0);return;case"v":case"V":a=d[1]+(g?a:0);return;case"z":case"Z":i=u,a=o;return;default:i=d[d.length-2]+(g?i:0),a=d[d.length-1]+(g?a:0)}}),!s)return this;for(p=[],h=0;h<r.length;h++)if(typeof n[h]<"u")for(c=0;c<n[h].length;c++)p.push(n[h][c]);else p.push(r[h]);return this.segments=p,this},S.prototype.abs=function(){return this.iterate(function(e,t,r,n){var s=e[0],i=s.toUpperCase(),a;if(s!==i)switch(e[0]=i,s){case"v":e[1]+=n;return;case"a":e[6]+=r,e[7]+=n;return;default:for(a=1;a<e.length;a++)e[a]+=a%2?r:n}},!0),this},S.prototype.rel=function(){return this.iterate(function(e,t,r,n){var s=e[0],i=s.toLowerCase(),a;if(s!==i&&!(t===0&&s==="M"))switch(e[0]=i,s){case"V":e[1]-=n;return;case"A":e[6]-=r,e[7]-=n;return;default:for(a=1;a<e.length;a++)e[a]-=a%2?r:n}},!0),this},S.prototype.unarc=function(){return this.iterate(function(e,t,r,n){var s,i,a,u=[],o=e[0];return o!=="A"&&o!=="a"?null:(o==="a"?(i=r+e[6],a=n+e[7]):(i=e[6],a=e[7]),s=bn(r,n,i,a,e[4],e[5],e[1],e[2],e[3]),s.length===0?[[e[0]==="a"?"l":"L",e[6],e[7]]]:(s.forEach(function(h){u.push(["C",h[2],h[3],h[4],h[5],h[6],h[7]])}),u))}),this},S.prototype.unshort=function(){var e=this.segments,t,r,n,s,i;return this.iterate(function(a,u,o,h){var c=a[0],p=c.toUpperCase(),d;u&&(p==="T"?(d=c==="t",n=e[u-1],n[0]==="Q"?(t=n[1]-o,r=n[2]-h):n[0]==="q"?(t=n[1]-n[3],r=n[2]-n[4]):(t=0,r=0),s=-t,i=-r,d||(s+=o,i+=h),e[u]=[d?"q":"Q",s,i,a[1],a[2]]):p==="S"&&(d=c==="s",n=e[u-1],n[0]==="C"?(t=n[3]-o,r=n[4]-h):n[0]==="c"?(t=n[3]-n[5],r=n[4]-n[6]):(t=0,r=0),s=-t,i=-r,d||(s+=o,i+=h),e[u]=[d?"c":"C",s,i,a[1],a[2],a[3],a[4]]))}),this};var yn=S,En=yn,_n=ve(En);function We(e){return[e[0],e[1]]}function k(e,t){return[e,t]}var wn=function(t){t=t||{};var r=typeof t.recursion=="number"?t.recursion:8,n=typeof t.epsilon=="number"?t.epsilon:11920929e-14,s=typeof t.pathEpsilon=="number"?t.pathEpsilon:1,i=typeof t.angleEpsilon=="number"?t.angleEpsilon:.01,a=t.angleTolerance||0,u=t.cuspLimit||0;return function(p,d,x,v,g,N){N||(N=[]),g=typeof g=="number"?g:1;var w=s/g;return w*=w,o(p,d,x,v,N,w),N};function o(c,p,d,x,v,g){v.push(We(c));var N=c[0],w=c[1],f=p[0],l=p[1],m=d[0],y=d[1],E=x[0],b=x[1];h(N,w,f,l,m,y,E,b,v,g,0),v.push(We(x))}function h(c,p,d,x,v,g,N,w,f,l,m){if(!(m>r)){var y=Math.PI,E=(c+d)/2,b=(p+x)/2,_=(d+v)/2,M=(x+g)/2,T=(v+N)/2,P=(g+w)/2,C=(E+_)/2,A=(b+M)/2,I=(_+T)/2,R=(M+P)/2,Y=(C+I)/2,$=(A+R)/2;if(m>0){var L=N-c,F=w-p,G=Math.abs((d-N)*F-(x-w)*L),V=Math.abs((v-N)*F-(g-w)*L),O,D;if(G>n&&V>n){if((G+V)*(G+V)<=l*(L*L+F*F)){if(a<i){f.push(k(Y,$));return}var De=Math.atan2(g-x,v-d);if(O=Math.abs(De-Math.atan2(x-p,d-c)),D=Math.abs(Math.atan2(w-g,N-v)-De),O>=y&&(O=2*y-O),D>=y&&(D=2*y-D),O+D<a){f.push(k(Y,$));return}if(u!==0){if(O>u){f.push(k(d,x));return}if(D>u){f.push(k(v,g));return}}}}else if(G>n){if(G*G<=l*(L*L+F*F)){if(a<i){f.push(k(Y,$));return}if(O=Math.abs(Math.atan2(g-x,v-d)-Math.atan2(x-p,d-c)),O>=y&&(O=2*y-O),O<a){f.push(k(d,x)),f.push(k(v,g));return}if(u!==0&&O>u){f.push(k(d,x));return}}}else if(V>n){if(V*V<=l*(L*L+F*F)){if(a<i){f.push(k(Y,$));return}if(O=Math.abs(Math.atan2(w-g,N-v)-Math.atan2(g-x,v-d)),O>=y&&(O=2*y-O),O<a){f.push(k(d,x)),f.push(k(v,g));return}if(u!==0&&O>u){f.push(k(v,g));return}}}else if(L=Y-(c+N)/2,F=$-(p+w)/2,L*L+F*F<=l){f.push(k(Y,$));return}}h(c,p,E,b,C,A,Y,$,f,l,m+1),h(Y,$,I,R,T,P,N,w,f,l,m+1)}}},Mn=ve(wn);const Pn=Mn({recursion:8,pathEpsilon:.1});function Tn(e,t){const{grid:r}=t;if(r.enabled){const n=t.width-t.marginX*2,s=t.height-t.marginY*2,i=n*r.cols,a=s*r.rows,u=0,o=0,{pathList:h}=He(e,{...t,width:i,height:a,marginX:u,marginY:o}),c=Cn(h,n,s,t),p={minX:u,maxX:t.width-u,minY:o,maxY:t.height-o};return c.map(d=>({pathList:d,bounds:p}))}else return[He(e,t)]}function An(e,t){const{parentWidth:r,parentHeight:n,rotation:s}=t;let i=[];return e.forEach(a=>{const u=In(a);if(u){const o=_n.from(u).unarc().unshort().abs().iterate((x,v,g,N)=>{switch(x[0]){case"H":return[["L",x[1],N]];case"V":return[["L",g,x[1]]];case"Q":{const[f,l,m,y]=x.slice(1),E=g+2*(f-g)/3,b=N+2*(l-N)/3,_=m+2*(f-m)/3,M=y+2*(l-y)/3;return[["C",E,b,_,M,m,y]]}default:return[x]}}).transform(a.transform);s!==0&&o.rotate(s,r*.5,n*.5);const h=[];let c=[],p=null,d=null;o.iterate((x,v,g,N)=>{const w=x[0];switch(w){case"M":{c.length>0&&h.push(c),c=[x[1],x[2]],p=[x[1],x[2]];break}case"L":{c.push(x[1],x[2]);break}case"C":{const[f,l,m,y,E,b]=x.slice(1),_=Pn([g,N],[f,l],[m,y],[E,b]).flat();d==="M"?c=[..._]:c.push(..._);break}case"Z":{p&&c.push(p[0],p[1]);break}default:console.warn("Encountered unknown command during path parsing:",w)}d=w}),c.length>0&&h.push(c),h.forEach(x=>{const v=[];for(let g=0;g<x.length;g+=2)v.push({x:x[g],y:x[g+1]});i.push(v)})}}),i}function He(e,t){const r=structuredClone(e),{parentWidth:n,parentHeight:s,width:i,height:a,marginX:u,marginY:o,alignment:h,rotation:c,useBoundingBox:p}=t,d={minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0};r.forEach(E=>{E.forEach(b=>{d.minX=Math.min(b.x,d.minX),d.maxX=Math.max(b.x,d.maxX),d.minY=Math.min(b.y,d.minY),d.maxY=Math.max(b.y,d.maxY)})});let x=0,v=0,g=0,N=0;if(p)x=d.maxX-d.minX,v=d.maxY-d.minY,g=-d.minX,N=-d.minY;else{const E=c*Math.PI/180,b=Math.abs(Math.sin(E)),_=Math.abs(Math.cos(E));x=n*_+s*b,v=n*b+s*_,g=(x-n)*.5,N=(v-s)*.5}if(x===0||v===0)throw new Error("Could not determine SVG dimensions");const w=i-u*2,f=a-o*2,l=Math.min(w/x,f/v),m=(w-x*l)*.5*h,y=(f-v*l)*.5*h;return r.forEach(E=>{E.forEach(b=>{b.x=(b.x+g)*l+m+u,b.y=(b.y+N)*l+y+o})}),d.minX=(d.minX+g)*l+m+u,d.minY=(d.minY+N)*l+y+o,d.maxX=(d.maxX+g)*l+m+u,d.maxY=(d.maxY+N)*l+y+o,{pathList:r,bounds:d}}function Cn(e,t,r,n){const{grid:s,marginX:i,marginY:a}=n,{rows:u,cols:o}=s,h=t*o,c=r*u;let p=structuredClone(e),d=[];for(let x=0;x<u;x++)for(let v=0;v<o;v++){let g=[],N=[],w=p.shift();const f=v*t,l=x*r,m=f+t,y=l+r,E={minX:f,minY:l,maxX:m,maxY:y};for(;w;){let b=!1,_=0,M=null;w.forEach((P,C)=>{if(P.x<0||P.x>h||P.y<0||P.y>c)throw new Error(`Invalid point found during path division: ${P.x}, ${P.y}`);const A=P.x>=f&&P.x<m&&P.y>=l&&P.y<y;if(A!==b){if(C>0){let I,R;A?(I=P,R=w[C-1]):(I=w[C-1],R=P);const Y=On(I,R,E),$=w.slice(_,C).concat(Y);M&&$.unshift(M),A?N.push($):g.push($),M={...Y}}b=A,_=C}});const T=w.slice(_);M&&T.unshift(M),b?g.push(T):N.push(T),w=p.shift()}g.forEach(b=>{b.forEach(_=>{_.x=_.x-f+i,_.y=_.y-l+a})}),d.push(g),p=N}return d}function On(e,t,r){const{minX:n,minY:s,maxX:i,maxY:a}=r,{x:u,y:o}=e,{x:h,y:c}=t,p=h-u,d=c-o;let x=0,v=1,g,N,w;for(let f=0;f<4;f++){if(f===0&&(g=-p,N=-(n-u)),f===1&&(g=p,N=i-u),f===2&&(g=-d,N=-(s-o)),f===3&&(g=d,N=a-o),w=N/g,g===0&&N<0)return null;if(g<0){if(w>v)return null;w>x&&(x=w)}else if(g>0){if(w<x)return null;w<v&&(v=w)}}return{x:u+v*p,y:o+v*d}}function In(e){switch(e.tag){case"path":return e.d;case"rect":return Sn(e);case"circle":return Xn(e);case"ellipse":return Yn(e);case"line":return $n(e);case"polygon":return Ln(e);case"polyline":return Bn(e);default:return null}}function he(e,t){return t.map(r=>Number(e[r]))}function K(e){return e.join(" ")}function Sn(e){const[t,r,n,s,i,a]=he(e,["x","y","width","height","rx","ry"]);if(i||a){let u=i||a,o=a||i;return u*2>n&&(u-=(u*2-n)/2),o*2>s&&(o-=(o*2-s)/2),K(["M",t+u,r,"h",n-u*2,"s",u,0,u,o,"v",s-o*2,"s",0,o,-u,o,"h",-n+u*2,"s",-u,0,-u,-o,"v",-s+o*2,"s",0,-o,u,-o])}else return K(["M",t,r,"h",n,"v",s,"H",t,"Z"])}function Xn(e){const[t,r,n]=he(e,["cx","cy","r"]);return K(["M",t-n,r,"a",n,n,0,1,0,2*n,0,"a",n,n,0,1,0,-2*n,0])}function Yn(e){const[t,r,n,s]=he(e,["cx","cy","rx","ry"]);return K(["M",t-n,r,"a",n,s,0,1,0,2*n,0,"a",n,s,0,1,0,-2*n,0])}function $n(e){const[t,r,n,s]=he(e,["x1","x2","y1","y2"]);return K(["M",t,n,"L",r,s])}function Ln(e){return Ze(e).concat("Z")}function Bn(e){return Ze(e)}function Ze(e){const{points:t=""}=e,r=t.trim().split(/[ ,]+/),n=[];for(let s=0;s<r.length;s+=2)n.push(s===0?"M":"L",[Number(r[s]),Number(r[s+1])]);return K(n)}const kn=["svg","g","a"],Fn=["rect","circle","ellipse","path","line","polyline","polygon"],Rn=new Ar.XMLParser({ignoreDeclaration:!0,ignoreAttributes:!1,attributeNamePrefix:""});function Vn(e,t){const{width:r,height:n,marginX:s,marginY:i,grid:a,alignment:u,rotation:o,useBoundingBox:h,postProcessing:c}=t,{svg:p}=Rn.parse(e);if(!p)throw new Error("Root SVG node not found");const{viewBox:d,translation:x}=Ke(p),v=Je(p,x),g=d.width,N=d.height,w={parentWidth:g,parentHeight:N,width:r,height:n,marginX:s,marginY:i,grid:a,alignment:u,rotation:o,useBoundingBox:h},f=An(v,w),l=Tn(f,w);return l.forEach(m=>{c.merge&&(m.pathList=qe(m.pathList,c.mergeTolerance)),c.filterShort&&(m.pathList=Ge(m.pathList,c.filterShortLength)),c.reorder&&(m.pathList=Re(m.pathList)),c.randomizeStart&&(m.pathList=qn(m.pathList,c.randomizeStartTolerance))}),l}function Je(e,t=""){const r=we(e.style)??{},n=se(r.transform,e.transform);return Qe(e,r)?[]:Object.entries(e).reduce((s,[i,a])=>{const u=kn.includes(i),o=Fn.includes(i);if(u||o){const h=Array.isArray(a)?a:[a];if(u){let c="";if(e.tag==="svg"){const{translation:p}=Ke(e);c=se(t,p,n)}else c=se(t,n);h.forEach(p=>{s.push(...Je(p,c))})}else h.forEach(c=>{const p=we(c.style)??{},d=se(p.transform,c.transform),x=se(t,n,d);Qe(c,p)||s.push({...c,tag:i,transform:x})})}return s},[])}function se(...e){return e.filter(Boolean).join(" ")}function Qe(e,t){return e.display==="none"||e.visibility==="hidden"||t.display==="none"||t.visibility==="hidden"}function Ke(e){let t=0,r=0,n=NaN,s=NaN,i="";if(!e.viewBox)e.width&&e.height&&(n=Number(e.width.match(/\d*/)),s=Number(e.height.match(/\d*/)));else{const a=e.viewBox.split(" ").map(u=>Number(u));t=a[0],r=a[1],n=a[2],s=a[3]}if(isNaN(n)||isNaN(s))throw new Error("Could not determine view box dimensions.");return(t!==0||r!==0)&&!isNaN(t)&&!isNaN(r)&&(i=`translate(${t}, ${r})`),{viewBox:{minX:t,minY:r,width:n,height:s},translation:i}}function qn(e,t){return e.map(r=>{const n=r.length;if(Gn(r[0].x,r[0].y,r[n-1].x,r[n-1].y)<t){let i=Math.floor(Math.random()*n);if(i%2!==0&&i++,i>0&&i<n-1){const a=r[i];return r.slice(i).concat(r.slice(0,i)).concat(a)}}return r})}function Gn(e,t,r,n){return Math.hypot(e-r,t-n)}const jn="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let zn=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=jn[r[e]&63];return t};function Un(e,t,r){const{width:n,height:s,marginX:i,marginY:a}=r;let u="",o="",h={x:0,y:s};e.length>0&&(e.forEach(N=>{o+=` M${h.x},${h.y} L${N[0].x},${N[0].y}`,u+=` M${N[0].x},${N[0].y}`;for(let w=1;w<N.length;w++)u+=` L${N[w].x},${N[w].y}`;h.x=N[N.length-1].x,h.y=N[N.length-1].y}),u=u.trim(),o=o.trim());const c=[`M${i},${a}`,`L${n-i},${a}`,`L${n-i},${s-a}`,`L${i},${s-a}`,`L${i},${a}`].join(""),{minX:p,minY:d,maxX:x,maxY:v}=t,g=[`M${p},${d}`,`L${x},${d}`,`L${x},${v}`,`L${p},${v}`,`L${p},${d}`].join("");return{downPath:u,upPath:o,marginsPath:c,boundsPath:g,width:n,height:s,id:zn()}}onmessage=e=>{try{const{svg:t,options:r}=JSON.parse(e.data),n=Vn(t,r);postMessage(JSON.stringify({isError:!1,result:{pathGrid:n,previews:n.map(({pathList:s,bounds:i})=>Un(s,i,r)),options:r}}))}catch(t){let r="Unknown error";t instanceof Error?r=t.message:typeof t=="string"&&(r=t),console.error(t),postMessage(JSON.stringify({isError:!0,errorMessage:r}))}}})();
